{
  "version": 3,
  "sources": ["../src/parser.js", "../src/shortcuts.js", "../src/themes.js", "../src/styles.js", "../node_modules/markdown-actions/src/core/formats.js", "../node_modules/markdown-actions/src/debug.js", "../node_modules/markdown-actions/src/core/insertion.js", "../node_modules/markdown-actions/src/core/selection.js", "../node_modules/markdown-actions/src/operations/block.js", "../node_modules/markdown-actions/src/operations/list.js", "../node_modules/markdown-actions/src/core/detection.js", "../node_modules/markdown-actions/src/index.js", "../src/toolbar.js", "../src/link-tooltip.js", "../src/icons.js", "../src/toolbar-buttons.js", "../src/overtype.js"],
  "sourcesContent": ["/**\r\n * MarkdownParser - Parses markdown into HTML while preserving character alignment\r\n *\r\n * Key principles:\r\n * - Every character must occupy the exact same position as in the textarea\r\n * - No font-size changes, no padding/margin on inline elements\r\n * - Markdown tokens remain visible but styled\r\n */\r\nexport class MarkdownParser {\r\n  // Track link index for anchor naming\r\n  static linkIndex = 0;\r\n\r\n  // Global code highlighter function\r\n  static codeHighlighter = null;\r\n\r\n  // Custom syntax processor function\r\n  static customSyntax = null;\r\n\r\n  /**\r\n   * Reset link index (call before parsing a new document)\r\n   */\r\n  static resetLinkIndex() {\r\n    this.linkIndex = 0;\r\n  }\r\n\r\n  /**\r\n   * Set global code highlighter function\r\n   * @param {Function|null} highlighter - Function that takes (code, language) and returns highlighted HTML\r\n   */\r\n  static setCodeHighlighter(highlighter) {\r\n    this.codeHighlighter = highlighter;\r\n  }\r\n\r\n  /**\r\n   * Set custom syntax processor function\r\n   * @param {Function|null} processor - Function that takes (html) and returns modified HTML\r\n   */\r\n  static setCustomSyntax(processor) {\r\n    this.customSyntax = processor;\r\n  }\r\n\r\n  /**\r\n   * Apply custom syntax processor to parsed HTML\r\n   * @param {string} html - Parsed HTML line\r\n   * @returns {string} HTML with custom syntax applied\r\n   */\r\n  static applyCustomSyntax(html) {\r\n    if (this.customSyntax) {\r\n      return this.customSyntax(html);\r\n    }\r\n    return html;\r\n  }\r\n\r\n  /**\r\n   * Escape HTML special characters\r\n   * @param {string} text - Raw text to escape\r\n   * @returns {string} Escaped HTML-safe text\r\n   */\r\n  static escapeHtml(text) {\r\n    const map = {\r\n      '&': '&amp;',\r\n      '<': '&lt;',\r\n      '>': '&gt;',\r\n      '\"': '&quot;',\r\n      \"'\": '&#39;'\r\n    };\r\n    return text.replace(/[&<>\"']/g, m => map[m]);\r\n  }\r\n\r\n  /**\r\n   * Preserve leading spaces as non-breaking spaces\r\n   * @param {string} html - HTML string\r\n   * @param {string} originalLine - Original line with spaces\r\n   * @returns {string} HTML with preserved indentation\r\n   */\r\n  static preserveIndentation(html, originalLine) {\r\n    const leadingSpaces = originalLine.match(/^(\\s*)/)[1];\r\n    const indentation = leadingSpaces.replace(/ /g, '&nbsp;');\r\n    return html.replace(/^\\s*/, indentation);\r\n  }\r\n\r\n  /**\r\n   * Parse headers (h1-h3 only)\r\n   * @param {string} html - HTML line to parse\r\n   * @returns {string} Parsed HTML with header styling\r\n   */\r\n  static parseHeader(html) {\r\n    return html.replace(/^(#{1,3})\\s(.+)$/, (match, hashes, content) => {\r\n      const level = hashes.length;\r\n      return `<h${level}><span class=\"syntax-marker\">${hashes} </span>${content}</h${level}>`;\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Parse horizontal rules\r\n   * @param {string} html - HTML line to parse\r\n   * @returns {string|null} Parsed horizontal rule or null\r\n   */\r\n  static parseHorizontalRule(html) {\r\n    if (html.match(/^(-{3,}|\\*{3,}|_{3,})$/)) {\r\n      return `<div><span class=\"hr-marker\">${html}</span></div>`;\r\n    }\r\n    return null;\r\n  }\r\n\r\n  /**\r\n   * Parse blockquotes\r\n   * @param {string} html - HTML line to parse\r\n   * @returns {string} Parsed blockquote\r\n   */\r\n  static parseBlockquote(html) {\r\n    return html.replace(/^&gt; (.+)$/, (match, content) => {\r\n      return `<span class=\"blockquote\"><span class=\"syntax-marker\">&gt;</span> ${content}</span>`;\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Parse bullet lists\r\n   * @param {string} html - HTML line to parse\r\n   * @returns {string} Parsed bullet list item\r\n   */\r\n  static parseBulletList(html) {\r\n    return html.replace(/^((?:&nbsp;)*)([-*+])\\s(.+)$/, (match, indent, marker, content) => {\r\n      return `${indent}<li class=\"bullet-list\"><span class=\"syntax-marker\">${marker} </span>${content}</li>`;\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Parse task lists (GitHub Flavored Markdown checkboxes)\r\n   * @param {string} html - HTML line to parse\r\n   * @param {boolean} isPreviewMode - Whether to render actual checkboxes (preview) or keep syntax visible (normal)\r\n   * @returns {string} Parsed task list item\r\n   */\r\n  static parseTaskList(html, isPreviewMode = false) {\r\n    return html.replace(/^((?:&nbsp;)*)-\\s+\\[([ xX])\\]\\s+(.+)$/, (match, indent, checked, content) => {\r\n      if (isPreviewMode) {\r\n        // Preview mode: render actual checkbox\r\n        const isChecked = checked.toLowerCase() === 'x';\r\n        return `${indent}<li class=\"task-list\"><input type=\"checkbox\" ${isChecked ? 'checked' : ''}> ${content}</li>`;\r\n      } else {\r\n        // Normal mode: keep syntax visible for alignment\r\n        return `${indent}<li class=\"task-list\"><span class=\"syntax-marker\">- [${checked}] </span>${content}</li>`;\r\n      }\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Parse numbered lists\r\n   * @param {string} html - HTML line to parse\r\n   * @returns {string} Parsed numbered list item\r\n   */\r\n  static parseNumberedList(html) {\r\n    return html.replace(/^((?:&nbsp;)*)(\\d+\\.)\\s(.+)$/, (match, indent, marker, content) => {\r\n      return `${indent}<li class=\"ordered-list\"><span class=\"syntax-marker\">${marker} </span>${content}</li>`;\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Parse code blocks (markers only)\r\n   * @param {string} html - HTML line to parse\r\n   * @returns {string|null} Parsed code fence or null\r\n   */\r\n  static parseCodeBlock(html) {\r\n    // The line must start with three backticks and have no backticks after subsequent text\r\n    const codeFenceRegex = /^`{3}[^`]*$/;\r\n    if (codeFenceRegex.test(html)) {\r\n      return `<div><span class=\"code-fence\">${html}</span></div>`;\r\n    }\r\n    return null;\r\n  }\r\n\r\n  /**\r\n   * Parse bold text\r\n   * @param {string} html - HTML with potential bold markdown\r\n   * @returns {string} HTML with bold styling\r\n   */\r\n  static parseBold(html) {\r\n    html = html.replace(/\\*\\*(.+?)\\*\\*/g, '<strong><span class=\"syntax-marker\">**</span>$1<span class=\"syntax-marker\">**</span></strong>');\r\n    html = html.replace(/__(.+?)__/g, '<strong><span class=\"syntax-marker\">__</span>$1<span class=\"syntax-marker\">__</span></strong>');\r\n    return html;\r\n  }\r\n\r\n  /**\r\n   * Parse italic text\r\n   * Note: Uses lookbehind assertions - requires modern browsers\r\n   * @param {string} html - HTML with potential italic markdown\r\n   * @returns {string} HTML with italic styling\r\n   */\r\n  static parseItalic(html) {\r\n    // Single asterisk - must not be adjacent to other asterisks\r\n    // Also must not be inside a syntax-marker span (to avoid matching bullet list markers)\r\n    html = html.replace(/(?<![\\*>])\\*(?!\\*)(.+?)(?<!\\*)\\*(?!\\*)/g, '<em><span class=\"syntax-marker\">*</span>$1<span class=\"syntax-marker\">*</span></em>');\r\n\r\n    // Single underscore - must be at word boundaries to avoid matching inside words\r\n    // This prevents matching underscores in the middle of words like \"bold_with_underscore\"\r\n    html = html.replace(/(?<=^|\\s)_(?!_)(.+?)(?<!_)_(?!_)(?=\\s|$)/g, '<em><span class=\"syntax-marker\">_</span>$1<span class=\"syntax-marker\">_</span></em>');\r\n\r\n    return html;\r\n  }\r\n\r\n  /**\r\n   * Parse strikethrough text\r\n   * Supports both single (~) and double (~~) tildes, but rejects 3+ tildes\r\n   * @param {string} html - HTML with potential strikethrough markdown\r\n   * @returns {string} HTML with strikethrough styling\r\n   */\r\n  static parseStrikethrough(html) {\r\n    // Double tilde strikethrough: ~~text~~ (but not if part of 3+ tildes)\r\n    html = html.replace(/(?<!~)~~(?!~)(.+?)(?<!~)~~(?!~)/g, '<del><span class=\"syntax-marker\">~~</span>$1<span class=\"syntax-marker\">~~</span></del>');\r\n    // Single tilde strikethrough: ~text~ (but not if part of 2+ tildes on either side)\r\n    html = html.replace(/(?<!~)~(?!~)(.+?)(?<!~)~(?!~)/g, '<del><span class=\"syntax-marker\">~</span>$1<span class=\"syntax-marker\">~</span></del>');\r\n    return html;\r\n  }\r\n\r\n  /**\r\n   * Parse inline code\r\n   * @param {string} html - HTML with potential code markdown\r\n   * @returns {string} HTML with code styling\r\n   */\r\n  static parseInlineCode(html) {\r\n    // Must have equal number of backticks before and after inline code\r\n    //\r\n    // Regex explainer:\r\n    // (?<!`): A negative lookbehind ensuring the opening backticks are not preceded by another backtick.\r\n    // (`+): A capturing group that matches and remembers the opening sequence of one or more backticks. This is Group 1.\r\n    // ((?:(?!\\1).)+?): A capturing group that greedily matches any character that is not the exact sequence of backticks captured in Group 1. This is Group 2.\r\n    // (\\1): A backreference to Group 1, ensuring the closing sequence has the exact same number of backticks as the opening sequence. This is Group 3.\r\n    // (?!`): A negative lookahead ensuring the closing backticks are not followed by another backtick.\r\n    return html.replace(/(?<!`)(`+)(?!`)((?:(?!\\1).)+?)(\\1)(?!`)/g, '<code><span class=\"syntax-marker\">$1</span>$2<span class=\"syntax-marker\">$3</span></code>');\r\n  }\r\n\r\n  /**\r\n   * Sanitize URL to prevent XSS attacks\r\n   * @param {string} url - URL to sanitize\r\n   * @returns {string} Safe URL or '#' if dangerous\r\n   */\r\n  static sanitizeUrl(url) {\r\n    // Trim whitespace and convert to lowercase for protocol check\r\n    const trimmed = url.trim();\r\n    const lower = trimmed.toLowerCase();\r\n\r\n    // Allow safe protocols\r\n    const safeProtocols = [\r\n      'http://',\r\n      'https://',\r\n      'mailto:',\r\n      'ftp://',\r\n      'ftps://'\r\n    ];\r\n\r\n    // Check if URL starts with a safe protocol\r\n    const hasSafeProtocol = safeProtocols.some(protocol => lower.startsWith(protocol));\r\n\r\n    // Allow relative URLs (starting with / or # or no protocol)\r\n    const isRelative = trimmed.startsWith('/') ||\r\n                      trimmed.startsWith('#') ||\r\n                      trimmed.startsWith('?') ||\r\n                      trimmed.startsWith('.') ||\r\n                      (!trimmed.includes(':') && !trimmed.includes('//'));\r\n\r\n    // If safe protocol or relative URL, return as-is\r\n    if (hasSafeProtocol || isRelative) {\r\n      return url;\r\n    }\r\n\r\n    // Block dangerous protocols (javascript:, data:, vbscript:, etc.)\r\n    return '#';\r\n  }\r\n\r\n  /**\r\n   * Parse links\r\n   * @param {string} html - HTML with potential link markdown\r\n   * @returns {string} HTML with link styling\r\n   */\r\n  static parseLinks(html) {\r\n    return html.replace(/\\[(.+?)\\]\\((.+?)\\)/g, (match, text, url) => {\r\n      const anchorName = `--link-${this.linkIndex++}`;\r\n      // Sanitize URL to prevent XSS attacks\r\n      const safeUrl = this.sanitizeUrl(url);\r\n      // Use real href - pointer-events handles click prevention in normal mode\r\n      return `<a href=\"${safeUrl}\" style=\"anchor-name: ${anchorName}\"><span class=\"syntax-marker\">[</span>${text}<span class=\"syntax-marker url-part\">](${url})</span></a>`;\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Identify and protect sanctuaries (code and links) before parsing\r\n   * @param {string} text - Text with potential markdown\r\n   * @returns {Object} Object with protected text and sanctuary map\r\n   */\r\n  static identifyAndProtectSanctuaries(text) {\r\n    const sanctuaries = new Map();\r\n    let sanctuaryCounter = 0;\r\n    let protectedText = text;\r\n    \r\n    // Create a map to track protected regions (URLs should not be processed)\r\n    const protectedRegions = [];\r\n    \r\n    // First, find all links and mark their URL regions as protected\r\n    const linkRegex = /\\[([^\\]]+)\\]\\(([^)]+)\\)/g;\r\n    let linkMatch;\r\n    while ((linkMatch = linkRegex.exec(text)) !== null) {\r\n      // Calculate the exact position of the URL part\r\n      // linkMatch.index is the start of the match\r\n      // We need to find where \"](\" starts, then add 2 to get URL start\r\n      const bracketPos = linkMatch.index + linkMatch[0].indexOf('](');\r\n      const urlStart = bracketPos + 2;\r\n      const urlEnd = urlStart + linkMatch[2].length;\r\n      protectedRegions.push({ start: urlStart, end: urlEnd });\r\n    }\r\n    \r\n    // Now protect inline code, but skip if it's inside a protected region (URL)\r\n    const codeRegex = /(?<!`)(`+)(?!`)((?:(?!\\1).)+?)(\\1)(?!`)/g;\r\n    let codeMatch;\r\n    const codeMatches = [];\r\n    \r\n    while ((codeMatch = codeRegex.exec(text)) !== null) {\r\n      const codeStart = codeMatch.index;\r\n      const codeEnd = codeMatch.index + codeMatch[0].length;\r\n      \r\n      // Check if this code is inside a protected URL region\r\n      const inProtectedRegion = protectedRegions.some(region => \r\n        codeStart >= region.start && codeEnd <= region.end\r\n      );\r\n      \r\n      if (!inProtectedRegion) {\r\n        codeMatches.push({\r\n          match: codeMatch[0],\r\n          index: codeMatch.index,\r\n          openTicks: codeMatch[1],\r\n          content: codeMatch[2],\r\n          closeTicks: codeMatch[3]\r\n        });\r\n      }\r\n    }\r\n    \r\n    // Replace code matches from end to start to preserve indices\r\n    codeMatches.sort((a, b) => b.index - a.index);\r\n    codeMatches.forEach(codeInfo => {\r\n      const placeholder = `\\uE000${sanctuaryCounter++}\\uE001`;\r\n      sanctuaries.set(placeholder, {\r\n        type: 'code',\r\n        original: codeInfo.match,\r\n        openTicks: codeInfo.openTicks,\r\n        content: codeInfo.content,\r\n        closeTicks: codeInfo.closeTicks\r\n      });\r\n      protectedText = protectedText.substring(0, codeInfo.index) + \r\n                     placeholder + \r\n                     protectedText.substring(codeInfo.index + codeInfo.match.length);\r\n    });\r\n    \r\n    // Then protect links - they can contain sanctuary placeholders for code but not raw code\r\n    protectedText = protectedText.replace(/\\[([^\\]]+)\\]\\(([^)]+)\\)/g, (match, linkText, url) => {\r\n      const placeholder = `\\uE000${sanctuaryCounter++}\\uE001`;\r\n      sanctuaries.set(placeholder, {\r\n        type: 'link',\r\n        original: match,\r\n        linkText,\r\n        url\r\n      });\r\n      return placeholder;\r\n    });\r\n    \r\n    return { protectedText, sanctuaries };\r\n  }\r\n  \r\n  /**\r\n   * Restore and transform sanctuaries back to HTML\r\n   * @param {string} html - HTML with sanctuary placeholders\r\n   * @param {Map} sanctuaries - Map of sanctuaries to restore\r\n   * @returns {string} HTML with sanctuaries restored and transformed\r\n   */\r\n  static restoreAndTransformSanctuaries(html, sanctuaries) {\r\n    // Sort sanctuary placeholders by position to restore in order\r\n    const placeholders = Array.from(sanctuaries.keys()).sort((a, b) => {\r\n      const indexA = html.indexOf(a);\r\n      const indexB = html.indexOf(b);\r\n      return indexA - indexB;\r\n    });\r\n    \r\n    placeholders.forEach(placeholder => {\r\n      const sanctuary = sanctuaries.get(placeholder);\r\n      let replacement;\r\n      \r\n      if (sanctuary.type === 'code') {\r\n        // Transform code sanctuary to HTML\r\n        replacement = `<code><span class=\"syntax-marker\">${sanctuary.openTicks}</span>${sanctuary.content}<span class=\"syntax-marker\">${sanctuary.closeTicks}</span></code>`;\r\n      } else if (sanctuary.type === 'link') {\r\n        // For links, we need to process the link text for markdown\r\n        let processedLinkText = sanctuary.linkText;\r\n        \r\n        // First restore any sanctuary placeholders that were already in the link text\r\n        // (e.g., inline code that was protected before the link)\r\n        sanctuaries.forEach((innerSanctuary, innerPlaceholder) => {\r\n          if (processedLinkText.includes(innerPlaceholder)) {\r\n            if (innerSanctuary.type === 'code') {\r\n              const codeHtml = `<code><span class=\"syntax-marker\">${innerSanctuary.openTicks}</span>${innerSanctuary.content}<span class=\"syntax-marker\">${innerSanctuary.closeTicks}</span></code>`;\r\n              processedLinkText = processedLinkText.replace(innerPlaceholder, codeHtml);\r\n            }\r\n          }\r\n        });\r\n        \r\n        // Now parse other markdown in the link text (bold, italic, etc)\r\n        processedLinkText = this.parseStrikethrough(processedLinkText);\r\n        processedLinkText = this.parseBold(processedLinkText);\r\n        processedLinkText = this.parseItalic(processedLinkText);\r\n        \r\n        // Transform link sanctuary to HTML\r\n        // URL should NOT be processed for markdown - use it as-is\r\n        const anchorName = `--link-${this.linkIndex++}`;\r\n        const safeUrl = this.sanitizeUrl(sanctuary.url);\r\n        replacement = `<a href=\"${safeUrl}\" style=\"anchor-name: ${anchorName}\"><span class=\"syntax-marker\">[</span>${processedLinkText}<span class=\"syntax-marker url-part\">](${sanctuary.url})</span></a>`;\r\n      }\r\n      \r\n      html = html.replace(placeholder, replacement);\r\n    });\r\n    \r\n    return html;\r\n  }\r\n  \r\n  /**\r\n   * Parse all inline elements in correct order\r\n   * @param {string} text - Text with potential inline markdown\r\n   * @returns {string} HTML with all inline styling\r\n   */\r\n  static parseInlineElements(text) {\r\n    // Step 1: Identify and protect sanctuaries (code and links)\r\n    const { protectedText, sanctuaries } = this.identifyAndProtectSanctuaries(text);\r\n    \r\n    // Step 2: Parse other inline elements on protected text\r\n    let html = protectedText;\r\n    html = this.parseStrikethrough(html);\r\n    html = this.parseBold(html);\r\n    html = this.parseItalic(html);\r\n    \r\n    // Step 3: Restore and transform sanctuaries\r\n    html = this.restoreAndTransformSanctuaries(html, sanctuaries);\r\n    \r\n    return html;\r\n  }\r\n\r\n  /**\r\n   * Parse a single line of markdown\r\n   * @param {string} line - Raw markdown line\r\n   * @returns {string} Parsed HTML line\r\n   */\r\n  static parseLine(line, isPreviewMode = false) {\r\n    let html = this.escapeHtml(line);\r\n\r\n    // Preserve indentation\r\n    html = this.preserveIndentation(html, line);\r\n\r\n    // Check for block elements first\r\n    const horizontalRule = this.parseHorizontalRule(html);\r\n    if (horizontalRule) return horizontalRule;\r\n\r\n    const codeBlock = this.parseCodeBlock(html);\r\n    if (codeBlock) return codeBlock;\r\n\r\n    // Parse block elements\r\n    html = this.parseHeader(html);\r\n    html = this.parseBlockquote(html);\r\n    html = this.parseTaskList(html, isPreviewMode);  // Check task lists before regular bullet lists\r\n    html = this.parseBulletList(html);\r\n    html = this.parseNumberedList(html);\r\n\r\n    // Parse inline elements\r\n    html = this.parseInlineElements(html);\r\n\r\n    // Wrap in div to maintain line structure\r\n    if (html.trim() === '') {\r\n      // Intentionally use &nbsp; for empty lines to maintain vertical spacing\r\n      // This causes a 0->1 character count difference but preserves visual alignment\r\n      return '<div>&nbsp;</div>';\r\n    }\r\n\r\n    return `<div>${html}</div>`;\r\n  }\r\n\r\n  /**\r\n   * Parse full markdown text\r\n   * @param {string} text - Full markdown text\r\n   * @param {number} activeLine - Currently active line index (optional)\r\n   * @param {boolean} showActiveLineRaw - Show raw markdown on active line\r\n   * @param {Function} instanceHighlighter - Instance-specific code highlighter (optional, overrides global if provided)\r\n   * @returns {string} Parsed HTML\r\n   */\r\n  static parse(text, activeLine = -1, showActiveLineRaw = false, instanceHighlighter, isPreviewMode = false) {\r\n    // Reset link counter for each parse\r\n    this.resetLinkIndex();\r\n\r\n    const lines = text.split('\\n');\r\n    let inCodeBlock = false;\r\n\r\n    const parsedLines = lines.map((line, index) => {\r\n      // Show raw markdown on active line if requested\r\n      if (showActiveLineRaw && index === activeLine) {\r\n        const content = this.escapeHtml(line) || '&nbsp;';\r\n        return `<div class=\"raw-line\">${content}</div>`;\r\n      }\r\n\r\n      // Check if this line is a code fence\r\n      const codeFenceRegex = /^```[^`]*$/;\r\n      if (codeFenceRegex.test(line)) {\r\n        inCodeBlock = !inCodeBlock;\r\n        // Parse fence markers normally to get styled output\r\n        return this.applyCustomSyntax(this.parseLine(line, isPreviewMode));\r\n      }\r\n\r\n      // If we're inside a code block, don't parse as markdown\r\n      if (inCodeBlock) {\r\n        const escaped = this.escapeHtml(line);\r\n        const indented = this.preserveIndentation(escaped, line);\r\n        return `<div>${indented || '&nbsp;'}</div>`;\r\n      }\r\n\r\n      // Otherwise, parse the markdown normally\r\n      return this.applyCustomSyntax(this.parseLine(line, isPreviewMode));\r\n    });\r\n\r\n    // Join without newlines to prevent extra spacing\r\n    const html = parsedLines.join('');\r\n\r\n    // Apply post-processing for list consolidation\r\n    return this.postProcessHTML(html, instanceHighlighter);\r\n  }\r\n\r\n  /**\r\n   * Post-process HTML to consolidate lists and code blocks\r\n   * @param {string} html - HTML to post-process\r\n   * @param {Function} instanceHighlighter - Instance-specific code highlighter (optional, overrides global if provided)\r\n   * @returns {string} Post-processed HTML with consolidated lists and code blocks\r\n   */\r\n  static postProcessHTML(html, instanceHighlighter) {\r\n    // Check if we're in a browser environment\r\n    if (typeof document === 'undefined' || !document) {\r\n      // In Node.js environment - do manual post-processing\r\n      return this.postProcessHTMLManual(html, instanceHighlighter);\r\n    }\r\n\r\n    // Parse HTML string into DOM\r\n    const container = document.createElement('div');\r\n    container.innerHTML = html;\r\n\r\n    let currentList = null;\r\n    let listType = null;\r\n    let currentCodeBlock = null;\r\n    let inCodeBlock = false;\r\n\r\n    // Process all direct children - need to be careful with live NodeList\r\n    const children = Array.from(container.children);\r\n\r\n    for (let i = 0; i < children.length; i++) {\r\n      const child = children[i];\r\n\r\n      // Skip if child was already processed/removed\r\n      if (!child.parentNode) continue;\r\n\r\n      // Check for code fence start/end\r\n      const codeFence = child.querySelector('.code-fence');\r\n      if (codeFence) {\r\n        const fenceText = codeFence.textContent;\r\n        if (fenceText.startsWith('```')) {\r\n          if (!inCodeBlock) {\r\n            // Start of code block - keep fence visible, then add pre/code\r\n            inCodeBlock = true;\r\n\r\n            // Create the code block that will follow the fence\r\n            currentCodeBlock = document.createElement('pre');\r\n            const codeElement = document.createElement('code');\r\n            currentCodeBlock.appendChild(codeElement);\r\n            currentCodeBlock.className = 'code-block';\r\n\r\n            // Extract language if present\r\n            const lang = fenceText.slice(3).trim();\r\n            if (lang) {\r\n              codeElement.className = `language-${lang}`;\r\n            }\r\n\r\n            // Insert code block after the fence div (don't remove the fence)\r\n            container.insertBefore(currentCodeBlock, child.nextSibling);\r\n\r\n            // Store reference to the code element for adding content\r\n            currentCodeBlock._codeElement = codeElement;\r\n            currentCodeBlock._language = lang;\r\n            currentCodeBlock._codeContent = '';\r\n            continue;\r\n          } else {\r\n            // End of code block - apply highlighting if needed\r\n            // Use instance highlighter if provided, otherwise fall back to global highlighter\r\n            const highlighter = instanceHighlighter || this.codeHighlighter;\r\n            if (currentCodeBlock && highlighter && currentCodeBlock._codeContent) {\r\n              try {\r\n                const result = highlighter(\r\n                  currentCodeBlock._codeContent,\r\n                  currentCodeBlock._language || ''\r\n                );\r\n\r\n                // Check if result is a Promise (async highlighter)\r\n                if (result && typeof result.then === 'function') {\r\n                  console.warn('Async highlighters are not supported in parse() because it returns an HTML string. The caller creates new DOM elements from that string, breaking references to the elements we would update. Use synchronous highlighters only.');\r\n                  // Keep the plain text fallback that was already set\r\n                } else {\r\n                  // Synchronous highlighter\r\n                  // Verify highlighter returned non-empty string\r\n                  if (result && typeof result === 'string' && result.trim()) {\r\n                    currentCodeBlock._codeElement.innerHTML = result;\r\n                  }\r\n                  // else: keep the plain text fallback that was already set\r\n                }\r\n              } catch (error) {\r\n                console.warn('Code highlighting failed:', error);\r\n                // Keep the plain text content as fallback\r\n              }\r\n            }\r\n\r\n            inCodeBlock = false;\r\n            currentCodeBlock = null;\r\n            continue;\r\n          }\r\n        }\r\n      }\r\n\r\n      // Check if we're in a code block - any div that's not a code fence\r\n      if (inCodeBlock && currentCodeBlock && child.tagName === 'DIV' && !child.querySelector('.code-fence')) {\r\n        const codeElement = currentCodeBlock._codeElement || currentCodeBlock.querySelector('code');\r\n        // Add the line content to the code block content (for highlighting)\r\n        if (currentCodeBlock._codeContent.length > 0) {\r\n          currentCodeBlock._codeContent += '\\n';\r\n        }\r\n        // Get the actual text content, preserving spaces\r\n        const lineText = child.textContent.replace(/\\u00A0/g, ' '); // \\u00A0 is nbsp\r\n        currentCodeBlock._codeContent += lineText;\r\n\r\n        // Also add to the code element (fallback if no highlighter)\r\n        if (codeElement.textContent.length > 0) {\r\n          codeElement.textContent += '\\n';\r\n        }\r\n        codeElement.textContent += lineText;\r\n        child.remove();\r\n        continue;\r\n      }\r\n\r\n      // Check if this div contains a list item\r\n      let listItem = null;\r\n      if (child.tagName === 'DIV') {\r\n        // Look for li inside the div\r\n        listItem = child.querySelector('li');\r\n      }\r\n\r\n      if (listItem) {\r\n        const isBullet = listItem.classList.contains('bullet-list');\r\n        const isOrdered = listItem.classList.contains('ordered-list');\r\n\r\n        if (!isBullet && !isOrdered) {\r\n          currentList = null;\r\n          listType = null;\r\n          continue;\r\n        }\r\n\r\n        const newType = isBullet ? 'ul' : 'ol';\r\n\r\n        // Start new list or continue current\r\n        if (!currentList || listType !== newType) {\r\n          currentList = document.createElement(newType);\r\n          container.insertBefore(currentList, child);\r\n          listType = newType;\r\n        }\r\n\r\n        // Extract and preserve indentation from the div before moving the list item\r\n        const indentationNodes = [];\r\n        for (const node of child.childNodes) {\r\n          if (node.nodeType === 3 && node.textContent.match(/^\\u00A0+$/)) {\r\n            // This is a text node containing only non-breaking spaces (indentation)\r\n            indentationNodes.push(node.cloneNode(true));\r\n          } else if (node === listItem) {\r\n            break; // Stop when we reach the list item\r\n          }\r\n        }\r\n\r\n        // Add indentation to the list item\r\n        indentationNodes.forEach(node => {\r\n          listItem.insertBefore(node, listItem.firstChild);\r\n        });\r\n\r\n        // Move the list item to the current list\r\n        currentList.appendChild(listItem);\r\n\r\n        // Remove the now-empty div wrapper\r\n        child.remove();\r\n      } else {\r\n        // Non-list element ends current list\r\n        currentList = null;\r\n        listType = null;\r\n      }\r\n    }\r\n\r\n    return container.innerHTML;\r\n  }\r\n\r\n  /**\r\n   * Manual post-processing for Node.js environments (without DOM)\r\n   * @param {string} html - HTML to post-process\r\n   * @param {Function} instanceHighlighter - Instance-specific code highlighter (optional, overrides global if provided)\r\n   * @returns {string} Post-processed HTML\r\n   */\r\n  static postProcessHTMLManual(html, instanceHighlighter) {\r\n    let processed = html;\r\n\r\n    // Process unordered lists\r\n    processed = processed.replace(/((?:<div>(?:&nbsp;)*<li class=\"bullet-list\">.*?<\\/li><\\/div>\\s*)+)/gs, (match) => {\r\n      const divs = match.match(/<div>(?:&nbsp;)*<li class=\"bullet-list\">.*?<\\/li><\\/div>/gs) || [];\r\n      if (divs.length > 0) {\r\n        const items = divs.map(div => {\r\n          // Extract indentation and list item\r\n          const indentMatch = div.match(/<div>((?:&nbsp;)*)<li/);\r\n          const listItemMatch = div.match(/<li class=\"bullet-list\">.*?<\\/li>/);\r\n\r\n          if (indentMatch && listItemMatch) {\r\n            const indentation = indentMatch[1];\r\n            const listItem = listItemMatch[0];\r\n            // Insert indentation at the start of the list item content\r\n            return listItem.replace(/<li class=\"bullet-list\">/, `<li class=\"bullet-list\">${indentation}`);\r\n          }\r\n          return listItemMatch ? listItemMatch[0] : '';\r\n        }).filter(Boolean);\r\n\r\n        return '<ul>' + items.join('') + '</ul>';\r\n      }\r\n      return match;\r\n    });\r\n\r\n    // Process ordered lists\r\n    processed = processed.replace(/((?:<div>(?:&nbsp;)*<li class=\"ordered-list\">.*?<\\/li><\\/div>\\s*)+)/gs, (match) => {\r\n      const divs = match.match(/<div>(?:&nbsp;)*<li class=\"ordered-list\">.*?<\\/li><\\/div>/gs) || [];\r\n      if (divs.length > 0) {\r\n        const items = divs.map(div => {\r\n          // Extract indentation and list item\r\n          const indentMatch = div.match(/<div>((?:&nbsp;)*)<li/);\r\n          const listItemMatch = div.match(/<li class=\"ordered-list\">.*?<\\/li>/);\r\n\r\n          if (indentMatch && listItemMatch) {\r\n            const indentation = indentMatch[1];\r\n            const listItem = listItemMatch[0];\r\n            // Insert indentation at the start of the list item content\r\n            return listItem.replace(/<li class=\"ordered-list\">/, `<li class=\"ordered-list\">${indentation}`);\r\n          }\r\n          return listItemMatch ? listItemMatch[0] : '';\r\n        }).filter(Boolean);\r\n\r\n        return '<ol>' + items.join('') + '</ol>';\r\n      }\r\n      return match;\r\n    });\r\n\r\n    // Process code blocks - KEEP the fence markers for alignment AND use semantic pre/code\r\n    const codeBlockRegex = /<div><span class=\"code-fence\">(```[^<]*)<\\/span><\\/div>(.*?)<div><span class=\"code-fence\">(```)<\\/span><\\/div>/gs;\r\n    processed = processed.replace(codeBlockRegex, (match, openFence, content, closeFence) => {\r\n      // Extract the content between fences\r\n      const lines = content.match(/<div>(.*?)<\\/div>/gs) || [];\r\n      const codeContent = lines.map(line => {\r\n        // Extract text from each div - content is already escaped\r\n        const text = line.replace(/<div>(.*?)<\\/div>/s, '$1')\r\n          .replace(/&nbsp;/g, ' ');\r\n        return text;\r\n      }).join('\\n');\r\n\r\n      // Extract language from the opening fence\r\n      const lang = openFence.slice(3).trim();\r\n      const langClass = lang ? ` class=\"language-${lang}\"` : '';\r\n\r\n      // Apply code highlighting if available\r\n      let highlightedContent = codeContent;\r\n      // Use instance highlighter if provided, otherwise fall back to global highlighter\r\n      const highlighter = instanceHighlighter || this.codeHighlighter;\r\n      if (highlighter) {\r\n        try {\r\n          // CRITICAL: Decode HTML entities before passing to highlighter\r\n          // In the DOM path, textContent automatically decodes entities.\r\n          // In the manual path, we need to decode explicitly to avoid double-escaping.\r\n          const decodedCode = codeContent\r\n            .replace(/&quot;/g, '\"')\r\n            .replace(/&#39;/g, \"'\")\r\n            .replace(/&lt;/g, '<')\r\n            .replace(/&gt;/g, '>')\r\n            .replace(/&amp;/g, '&');  // Must be last to avoid double-decoding\r\n\r\n          const result = highlighter(decodedCode, lang);\r\n\r\n          // Check if result is a Promise (async highlighter)\r\n          // Note: In Node.js context, we can't easily defer rendering, so we warn\r\n          if (result && typeof result.then === 'function') {\r\n            console.warn('Async highlighters are not supported in Node.js (non-DOM) context. Use synchronous highlighters for server-side rendering.');\r\n            // Fall back to escaped content\r\n          } else {\r\n            // Synchronous highlighter - verify returned non-empty string\r\n            if (result && typeof result === 'string' && result.trim()) {\r\n              highlightedContent = result;\r\n            }\r\n            // else: keep the escaped codeContent as fallback\r\n          }\r\n        } catch (error) {\r\n          console.warn('Code highlighting failed:', error);\r\n          // Fall back to original content\r\n        }\r\n      }\r\n\r\n      // Keep fence markers visible as separate divs, with pre/code block between them\r\n      let result = `<div><span class=\"code-fence\">${openFence}</span></div>`;\r\n      // Use highlighted content if available, otherwise use escaped content\r\n      result += `<pre class=\"code-block\"><code${langClass}>${highlightedContent}</code></pre>`;\r\n      result += `<div><span class=\"code-fence\">${closeFence}</span></div>`;\r\n\r\n      return result;\r\n    });\r\n\r\n    return processed;\r\n  }\r\n\r\n  /**\r\n   * List pattern definitions\r\n   */\r\n  static LIST_PATTERNS = {\r\n    bullet: /^(\\s*)([-*+])\\s+(.*)$/,\r\n    numbered: /^(\\s*)(\\d+)\\.\\s+(.*)$/,\r\n    checkbox: /^(\\s*)-\\s+\\[([ x])\\]\\s+(.*)$/\r\n  };\r\n\r\n  /**\r\n   * Get list context at cursor position\r\n   * @param {string} text - Full text content\r\n   * @param {number} cursorPosition - Current cursor position\r\n   * @returns {Object} List context information\r\n   */\r\n  static getListContext(text, cursorPosition) {\r\n    // Find the line containing the cursor\r\n    const lines = text.split('\\n');\r\n    let currentPos = 0;\r\n    let lineIndex = 0;\r\n    let lineStart = 0;\r\n\r\n    for (let i = 0; i < lines.length; i++) {\r\n      const lineLength = lines[i].length;\r\n      if (currentPos + lineLength >= cursorPosition) {\r\n        lineIndex = i;\r\n        lineStart = currentPos;\r\n        break;\r\n      }\r\n      currentPos += lineLength + 1; // +1 for newline\r\n    }\r\n\r\n    const currentLine = lines[lineIndex];\r\n    const lineEnd = lineStart + currentLine.length;\r\n\r\n    // Check for checkbox first (most specific)\r\n    const checkboxMatch = currentLine.match(this.LIST_PATTERNS.checkbox);\r\n    if (checkboxMatch) {\r\n      return {\r\n        inList: true,\r\n        listType: 'checkbox',\r\n        indent: checkboxMatch[1],\r\n        marker: '-',\r\n        checked: checkboxMatch[2] === 'x',\r\n        content: checkboxMatch[3],\r\n        lineStart,\r\n        lineEnd,\r\n        markerEndPos: lineStart + checkboxMatch[1].length + checkboxMatch[2].length + 5 // indent + \"- [ ] \"\r\n      };\r\n    }\r\n\r\n    // Check for bullet list\r\n    const bulletMatch = currentLine.match(this.LIST_PATTERNS.bullet);\r\n    if (bulletMatch) {\r\n      return {\r\n        inList: true,\r\n        listType: 'bullet',\r\n        indent: bulletMatch[1],\r\n        marker: bulletMatch[2],\r\n        content: bulletMatch[3],\r\n        lineStart,\r\n        lineEnd,\r\n        markerEndPos: lineStart + bulletMatch[1].length + bulletMatch[2].length + 1 // indent + marker + space\r\n      };\r\n    }\r\n\r\n    // Check for numbered list\r\n    const numberedMatch = currentLine.match(this.LIST_PATTERNS.numbered);\r\n    if (numberedMatch) {\r\n      return {\r\n        inList: true,\r\n        listType: 'numbered',\r\n        indent: numberedMatch[1],\r\n        marker: parseInt(numberedMatch[2]),\r\n        content: numberedMatch[3],\r\n        lineStart,\r\n        lineEnd,\r\n        markerEndPos: lineStart + numberedMatch[1].length + numberedMatch[2].length + 2 // indent + number + \". \"\r\n      };\r\n    }\r\n\r\n    // Not in a list\r\n    return {\r\n      inList: false,\r\n      listType: null,\r\n      indent: '',\r\n      marker: null,\r\n      content: currentLine,\r\n      lineStart,\r\n      lineEnd,\r\n      markerEndPos: lineStart\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Create a new list item based on context\r\n   * @param {Object} context - List context from getListContext\r\n   * @returns {string} New list item text\r\n   */\r\n  static createNewListItem(context) {\r\n    switch (context.listType) {\r\n      case 'bullet':\r\n        return `${context.indent}${context.marker} `;\r\n      case 'numbered':\r\n        return `${context.indent}${context.marker + 1}. `;\r\n      case 'checkbox':\r\n        return `${context.indent}- [ ] `;\r\n      default:\r\n        return '';\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Renumber all numbered lists in text\r\n   * @param {string} text - Text containing numbered lists\r\n   * @returns {string} Text with renumbered lists\r\n   */\r\n  static renumberLists(text) {\r\n    const lines = text.split('\\n');\r\n    const numbersByIndent = new Map();\r\n    let inList = false;\r\n\r\n    const result = lines.map(line => {\r\n      const match = line.match(this.LIST_PATTERNS.numbered);\r\n\r\n      if (match) {\r\n        const indent = match[1];\r\n        const indentLevel = indent.length;\r\n        const content = match[3];\r\n\r\n        // If we weren't in a list or indent changed, reset lower levels\r\n        if (!inList) {\r\n          numbersByIndent.clear();\r\n        }\r\n\r\n        // Get the next number for this indent level\r\n        const currentNumber = (numbersByIndent.get(indentLevel) || 0) + 1;\r\n        numbersByIndent.set(indentLevel, currentNumber);\r\n\r\n        // Clear deeper indent levels\r\n        for (const [level] of numbersByIndent) {\r\n          if (level > indentLevel) {\r\n            numbersByIndent.delete(level);\r\n          }\r\n        }\r\n\r\n        inList = true;\r\n        return `${indent}${currentNumber}. ${content}`;\r\n      } else {\r\n        // Not a numbered list item\r\n        if (line.trim() === '' || !line.match(/^\\s/)) {\r\n          // Empty line or non-indented line breaks the list\r\n          inList = false;\r\n          numbersByIndent.clear();\r\n        }\r\n        return line;\r\n      }\r\n    });\r\n\r\n    return result.join('\\n');\r\n  }\r\n}\r\n", "/**\r\n * Keyboard shortcuts handler for OverType editor\r\n * Delegates to editor.performAction for consistent behavior\r\n */\r\n\r\n/**\r\n * ShortcutsManager - Handles keyboard shortcuts for the editor\r\n */\r\nexport class ShortcutsManager {\r\n  constructor(editor) {\r\n    this.editor = editor;\r\n  }\r\n\r\n  /**\r\n   * Handle keydown events - called by OverType\r\n   * @param {KeyboardEvent} event - The keyboard event\r\n   * @returns {boolean} Whether the event was handled\r\n   */\r\n  handleKeydown(event) {\r\n    const isMac = navigator.platform.toLowerCase().includes('mac');\r\n    const modKey = isMac ? event.metaKey : event.ctrlKey;\r\n\r\n    if (!modKey) return false;\r\n\r\n    let actionId = null;\r\n\r\n    switch (event.key.toLowerCase()) {\r\n      case 'b':\r\n        if (!event.shiftKey) actionId = 'toggleBold';\r\n        break;\r\n      case 'i':\r\n        if (!event.shiftKey) actionId = 'toggleItalic';\r\n        break;\r\n      case 'k':\r\n        if (!event.shiftKey) actionId = 'insertLink';\r\n        break;\r\n      case '7':\r\n        if (event.shiftKey) actionId = 'toggleNumberedList';\r\n        break;\r\n      case '8':\r\n        if (event.shiftKey) actionId = 'toggleBulletList';\r\n        break;\r\n    }\r\n\r\n    if (actionId) {\r\n      event.preventDefault();\r\n      this.editor.performAction(actionId, event);\r\n      return true;\r\n    }\r\n\r\n    return false;\r\n  }\r\n\r\n  /**\r\n   * Cleanup\r\n   */\r\n  destroy() {\r\n    // Nothing to clean up since we don't add our own listener\r\n  }\r\n}\r\n", "/**\r\n * Built-in themes for OverType editor\r\n * Each theme provides a complete color palette for the editor\r\n */\r\n\r\n/**\r\n * Solar theme - Light, warm and bright\r\n */\r\nexport const solar = {\r\n  name: 'solar',\r\n  colors: {\r\n    bgPrimary: '#faf0ca',        // Lemon Chiffon - main background\r\n    bgSecondary: '#ffffff',      // White - editor background\r\n    text: '#0d3b66',             // Yale Blue - main text\r\n    textPrimary: '#0d3b66',      // Yale Blue - primary text (same as text)\r\n    textSecondary: '#5a7a9b',    // Muted blue - secondary text\r\n    h1: '#f95738',               // Tomato - h1 headers\r\n    h2: '#ee964b',               // Sandy Brown - h2 headers\r\n    h3: '#3d8a51',               // Forest green - h3 headers\r\n    strong: '#ee964b',           // Sandy Brown - bold text\r\n    em: '#f95738',               // Tomato - italic text\r\n    del: '#ee964b',              // Sandy Brown - deleted text (same as strong)\r\n    link: '#0d3b66',             // Yale Blue - links\r\n    code: '#0d3b66',             // Yale Blue - inline code\r\n    codeBg: 'rgba(244, 211, 94, 0.4)', // Naples Yellow with transparency\r\n    blockquote: '#5a7a9b',       // Muted blue - blockquotes\r\n    hr: '#5a7a9b',               // Muted blue - horizontal rules\r\n    syntaxMarker: 'rgba(13, 59, 102, 0.52)', // Yale Blue with transparency\r\n    syntax: '#999999',           // Gray - syntax highlighting fallback\r\n    cursor: '#f95738',           // Tomato - cursor\r\n    selection: 'rgba(244, 211, 94, 0.4)', // Naples Yellow with transparency\r\n    listMarker: '#ee964b',       // Sandy Brown - list markers\r\n    rawLine: '#5a7a9b',          // Muted blue - raw line indicators\r\n    border: '#e0e0e0',           // Light gray - borders\r\n    hoverBg: '#f0f0f0',          // Very light gray - hover backgrounds\r\n    primary: '#0d3b66',          // Yale Blue - primary accent\r\n    // Toolbar colors\r\n    toolbarBg: '#ffffff',        // White - toolbar background\r\n    toolbarIcon: '#0d3b66',      // Yale Blue - icon color\r\n    toolbarHover: '#f5f5f5',     // Light gray - hover background\r\n    toolbarActive: '#faf0ca',    // Lemon Chiffon - active button background\r\n  }\r\n};\r\n\r\n/**\r\n * Cave theme - Dark ocean depths\r\n */\r\nexport const cave = {\r\n  name: 'cave',\r\n  colors: {\r\n    bgPrimary: '#141E26',        // Deep ocean - main background\r\n    bgSecondary: '#1D2D3E',      // Darker charcoal - editor background\r\n    text: '#c5dde8',             // Light blue-gray - main text\r\n    textPrimary: '#c5dde8',      // Light blue-gray - primary text (same as text)\r\n    textSecondary: '#9fcfec',    // Brighter blue - secondary text\r\n    h1: '#d4a5ff',               // Rich lavender - h1 headers\r\n    h2: '#f6ae2d',               // Hunyadi Yellow - h2 headers\r\n    h3: '#9fcfec',               // Brighter blue - h3 headers\r\n    strong: '#f6ae2d',           // Hunyadi Yellow - bold text\r\n    em: '#9fcfec',               // Brighter blue - italic text\r\n    del: '#f6ae2d',              // Hunyadi Yellow - deleted text (same as strong)\r\n    link: '#9fcfec',             // Brighter blue - links\r\n    code: '#c5dde8',             // Light blue-gray - inline code\r\n    codeBg: '#1a232b',           // Very dark blue - code background\r\n    blockquote: '#9fcfec',       // Brighter blue - same as italic\r\n    hr: '#c5dde8',               // Light blue-gray - horizontal rules\r\n    syntaxMarker: 'rgba(159, 207, 236, 0.73)', // Brighter blue semi-transparent\r\n    syntax: '#7a8c98',           // Muted gray-blue - syntax highlighting fallback\r\n    cursor: '#f26419',           // Orange Pantone - cursor\r\n    selection: 'rgba(51, 101, 138, 0.4)', // Lapis Lazuli with transparency\r\n    listMarker: '#f6ae2d',       // Hunyadi Yellow - list markers\r\n    rawLine: '#9fcfec',          // Brighter blue - raw line indicators\r\n    border: '#2a3f52',           // Dark blue-gray - borders\r\n    hoverBg: '#243546',          // Slightly lighter charcoal - hover backgrounds\r\n    primary: '#9fcfec',          // Brighter blue - primary accent\r\n    // Toolbar colors for dark theme\r\n    toolbarBg: '#1D2D3E',        // Darker charcoal - toolbar background\r\n    toolbarIcon: '#c5dde8',      // Light blue-gray - icon color\r\n    toolbarHover: '#243546',     // Slightly lighter charcoal - hover background\r\n    toolbarActive: '#2a3f52',    // Even lighter - active button background\r\n  }\r\n};\r\n\r\n/**\r\n * Auto theme - Automatically switches between solar and cave based on system preference\r\n * This is a special marker theme that triggers automatic theme switching\r\n */\r\nexport const auto = {\r\n  name: 'auto',\r\n  // The auto theme doesn't have its own colors; it uses solar or cave dynamically\r\n  colors: solar.colors  // Default to solar colors for initial render\r\n};\r\n\r\n/**\r\n * Default themes registry\r\n */\r\nexport const themes = {\r\n  solar,\r\n  cave,\r\n  auto,\r\n  // Aliases for backward compatibility\r\n  light: solar,\r\n  dark: cave\r\n};\r\n\r\n/**\r\n * Get theme by name or return custom theme object\r\n * @param {string|Object} theme - Theme name or custom theme object\r\n * @returns {Object} Theme configuration\r\n */\r\nexport function getTheme(theme) {\r\n  if (typeof theme === 'string') {\r\n    const themeObj = themes[theme] || themes.solar;\r\n    // Preserve the requested theme name (important for 'light' and 'dark' aliases)\r\n    return { ...themeObj, name: theme };\r\n  }\r\n  return theme;\r\n}\r\n\r\n/**\r\n * Resolve auto theme to actual theme based on system color scheme preference\r\n * @param {string} themeName - Theme name to resolve\r\n * @returns {string} Resolved theme name ('solar' or 'cave' if auto, otherwise the original name)\r\n */\r\nexport function resolveAutoTheme(themeName) {\r\n  if (themeName !== 'auto') {\r\n    return themeName;\r\n  }\r\n\r\n  // Check for system dark mode preference\r\n  const isDarkMode = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;\r\n  return isDarkMode ? 'cave' : 'solar';\r\n}\r\n\r\n/**\r\n * Get the current system color scheme preference\r\n * @returns {string} 'dark' or 'light'\r\n */\r\nexport function getSystemColorScheme() {\r\n  const isDarkMode = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;\r\n  return isDarkMode ? 'dark' : 'light';\r\n}\r\n\r\n/**\r\n * Apply theme colors to CSS variables\r\n * @param {Object} colors - Theme colors object\r\n * @returns {string} CSS custom properties string\r\n */\r\nexport function themeToCSSVars(colors) {\r\n  const vars = [];\r\n  for (const [key, value] of Object.entries(colors)) {\r\n    // Convert camelCase to kebab-case\r\n    const varName = key.replace(/([A-Z])/g, '-$1').toLowerCase();\r\n    vars.push(`--${varName}: ${value};`);\r\n  }\r\n  return vars.join('\\n');\r\n}\r\n\r\n/**\r\n * Merge custom colors with base theme\r\n * @param {Object} baseTheme - Base theme object\r\n * @param {Object} customColors - Custom color overrides\r\n * @returns {Object} Merged theme object\r\n */\r\nexport function mergeTheme(baseTheme, customColors = {}) {\r\n  return {\r\n    ...baseTheme,\r\n    colors: {\r\n      ...baseTheme.colors,\r\n      ...customColors\r\n    }\r\n  };\r\n}", "/**\r\n * CSS styles for OverType editor\r\n * Embedded in JavaScript to ensure single-file distribution\r\n */\r\n\r\nimport { themeToCSSVars } from './themes.js';\r\n\r\n/**\r\n * Generate the complete CSS for the editor\r\n * @param {Object} options - Configuration options\r\n * @returns {string} Complete CSS string\r\n */\r\nexport function generateStyles(options = {}) {\r\n  const {\r\n    fontSize = '14px',\r\n    lineHeight = 1.6,\r\n    /* System-first, guaranteed monospaced; avoids Android 'ui-monospace' pitfalls */\r\n    fontFamily = '\"SF Mono\", SFMono-Regular, Menlo, Monaco, \"Cascadia Code\", Consolas, \"Roboto Mono\", \"Noto Sans Mono\", \"Droid Sans Mono\", \"Ubuntu Mono\", \"DejaVu Sans Mono\", \"Liberation Mono\", \"Courier New\", Courier, monospace',\r\n    padding = '20px',\r\n    theme = null,\r\n    mobile = {}\r\n  } = options;\r\n\r\n  // Generate mobile overrides\r\n  const mobileStyles = Object.keys(mobile).length > 0 ? `\r\n    @media (max-width: 640px) {\r\n      .overtype-wrapper .overtype-input,\r\n      .overtype-wrapper .overtype-preview {\r\n        ${Object.entries(mobile)\r\n          .map(([prop, val]) => {\r\n            const cssProp = prop.replace(/([A-Z])/g, '-$1').toLowerCase();\r\n            return `${cssProp}: ${val} !important;`;\r\n          })\r\n          .join('\\n        ')}\r\n      }\r\n    }\r\n  ` : '';\r\n\r\n  // Generate theme variables if provided\r\n  const themeVars = theme && theme.colors ? themeToCSSVars(theme.colors) : '';\r\n\r\n  return `\r\n    /* OverType Editor Styles */\r\n    \r\n    /* Middle-ground CSS Reset - Prevent parent styles from leaking in */\r\n    .overtype-container * {\r\n      /* Box model - these commonly leak */\r\n      margin: 0 !important;\r\n      padding: 0 !important;\r\n      border: 0 !important;\r\n      \r\n      /* Layout - these can break our layout */\r\n      /* Don't reset position - it breaks dropdowns */\r\n      float: none !important;\r\n      clear: none !important;\r\n      \r\n      /* Typography - only reset decorative aspects */\r\n      text-decoration: none !important;\r\n      text-transform: none !important;\r\n      letter-spacing: normal !important;\r\n      \r\n      /* Visual effects that can interfere */\r\n      box-shadow: none !important;\r\n      text-shadow: none !important;\r\n      \r\n      /* Ensure box-sizing is consistent */\r\n      box-sizing: border-box !important;\r\n      \r\n      /* Keep inheritance for these */\r\n      /* font-family, color, line-height, font-size - inherit */\r\n    }\r\n    \r\n    /* Container base styles after reset */\r\n    .overtype-container {\r\n      display: flex !important;\r\n      flex-direction: column !important;\r\n      width: 100% !important;\r\n      height: 100% !important;\r\n      position: relative !important; /* Override reset - needed for absolute children */\r\n      overflow: visible !important; /* Allow dropdown to overflow container */\r\n      font-family: -apple-system, BlinkMacSystemFont, \"Segoe UI\", Roboto, sans-serif !important;\r\n      text-align: left !important;\r\n      ${themeVars ? `\r\n      /* Theme Variables */\r\n      ${themeVars}` : ''}\r\n    }\r\n    \r\n    /* Force left alignment for all elements in the editor */\r\n    .overtype-container .overtype-wrapper * {\r\n      text-align: left !important;\r\n    }\r\n    \r\n    /* Auto-resize mode styles */\r\n    .overtype-container.overtype-auto-resize {\r\n      height: auto !important;\r\n    }\r\n\r\n    .overtype-container.overtype-auto-resize .overtype-wrapper {\r\n      flex: 0 0 auto !important; /* Don't grow/shrink, use explicit height */\r\n      height: auto !important;\r\n      min-height: 60px !important;\r\n      overflow: visible !important;\r\n    }\r\n    \r\n    .overtype-wrapper {\r\n      position: relative !important; /* Override reset - needed for absolute children */\r\n      width: 100% !important;\r\n      flex: 1 1 0 !important; /* Grow to fill remaining space, with flex-basis: 0 */\r\n      min-height: 60px !important; /* Minimum usable height */\r\n      overflow: hidden !important;\r\n      background: var(--bg-secondary, #ffffff) !important;\r\n      z-index: 1; /* Below toolbar and dropdown */\r\n    }\r\n\r\n    /* Critical alignment styles - must be identical for both layers */\r\n    .overtype-wrapper .overtype-input,\r\n    .overtype-wrapper .overtype-preview {\r\n      /* Positioning - must be identical */\r\n      position: absolute !important; /* Override reset - required for overlay */\r\n      top: 0 !important;\r\n      left: 0 !important;\r\n      width: 100% !important;\r\n      height: 100% !important;\r\n      \r\n      /* Font properties - any difference breaks alignment */\r\n      font-family: ${fontFamily} !important;\r\n      font-variant-ligatures: none !important; /* keep metrics stable for code */\r\n      font-size: var(--instance-font-size, ${fontSize}) !important;\r\n      line-height: var(--instance-line-height, ${lineHeight}) !important;\r\n      font-weight: normal !important;\r\n      font-style: normal !important;\r\n      font-variant: normal !important;\r\n      font-stretch: normal !important;\r\n      font-kerning: none !important;\r\n      font-feature-settings: normal !important;\r\n      \r\n      /* Box model - must match exactly */\r\n      padding: var(--instance-padding, ${padding}) !important;\r\n      margin: 0 !important;\r\n      border: none !important;\r\n      outline: none !important;\r\n      box-sizing: border-box !important;\r\n      \r\n      /* Text layout - critical for character positioning */\r\n      white-space: pre-wrap !important;\r\n      word-wrap: break-word !important;\r\n      word-break: normal !important;\r\n      overflow-wrap: break-word !important;\r\n      tab-size: 2 !important;\r\n      -moz-tab-size: 2 !important;\r\n      text-align: left !important;\r\n      text-indent: 0 !important;\r\n      letter-spacing: normal !important;\r\n      word-spacing: normal !important;\r\n      \r\n      /* Text rendering */\r\n      text-transform: none !important;\r\n      text-rendering: auto !important;\r\n      -webkit-font-smoothing: auto !important;\r\n      -webkit-text-size-adjust: 100% !important;\r\n      \r\n      /* Direction and writing */\r\n      direction: ltr !important;\r\n      writing-mode: horizontal-tb !important;\r\n      unicode-bidi: normal !important;\r\n      text-orientation: mixed !important;\r\n      \r\n      /* Visual effects that could shift perception */\r\n      text-shadow: none !important;\r\n      filter: none !important;\r\n      transform: none !important;\r\n      zoom: 1 !important;\r\n      \r\n      /* Vertical alignment */\r\n      vertical-align: baseline !important;\r\n      \r\n      /* Size constraints */\r\n      min-width: 0 !important;\r\n      min-height: 0 !important;\r\n      max-width: none !important;\r\n      max-height: none !important;\r\n      \r\n      /* Overflow */\r\n      overflow-y: auto !important;\r\n      overflow-x: auto !important;\r\n      /* overscroll-behavior removed to allow scroll-through to parent */\r\n      scrollbar-width: auto !important;\r\n      scrollbar-gutter: auto !important;\r\n      \r\n      /* Animation/transition - disabled to prevent movement */\r\n      animation: none !important;\r\n      transition: none !important;\r\n    }\r\n\r\n    /* Input layer styles */\r\n    .overtype-wrapper .overtype-input {\r\n      /* Layer positioning */\r\n      z-index: 1 !important;\r\n      \r\n      /* Text visibility */\r\n      color: transparent !important;\r\n      caret-color: var(--cursor, #f95738) !important;\r\n      background-color: transparent !important;\r\n      \r\n      /* Textarea-specific */\r\n      resize: none !important;\r\n      appearance: none !important;\r\n      -webkit-appearance: none !important;\r\n      -moz-appearance: none !important;\r\n      \r\n      /* Prevent mobile zoom on focus */\r\n      touch-action: manipulation !important;\r\n      \r\n      /* Disable autofill and spellcheck */\r\n      autocomplete: off !important;\r\n      autocorrect: off !important;\r\n      autocapitalize: off !important;\r\n      spellcheck: false !important;\r\n    }\r\n\r\n    .overtype-wrapper .overtype-input::selection {\r\n      background-color: var(--selection, rgba(244, 211, 94, 0.4));\r\n    }\r\n\r\n    /* Preview layer styles */\r\n    .overtype-wrapper .overtype-preview {\r\n      /* Layer positioning */\r\n      z-index: 0 !important;\r\n      pointer-events: none !important;\r\n      color: var(--text, #0d3b66) !important;\r\n      background-color: transparent !important;\r\n      \r\n      /* Prevent text selection */\r\n      user-select: none !important;\r\n      -webkit-user-select: none !important;\r\n      -moz-user-select: none !important;\r\n      -ms-user-select: none !important;\r\n    }\r\n\r\n    /* Defensive styles for preview child divs */\r\n    .overtype-wrapper .overtype-preview div {\r\n      /* Reset any inherited styles */\r\n      margin: 0 !important;\r\n      padding: 0 !important;\r\n      border: none !important;\r\n      text-align: left !important;\r\n      text-indent: 0 !important;\r\n      display: block !important;\r\n      position: static !important;\r\n      transform: none !important;\r\n      min-height: 0 !important;\r\n      max-height: none !important;\r\n      line-height: inherit !important;\r\n      font-size: inherit !important;\r\n      font-family: inherit !important;\r\n    }\r\n\r\n    /* Markdown element styling - NO SIZE CHANGES */\r\n    .overtype-wrapper .overtype-preview .header {\r\n      font-weight: bold !important;\r\n    }\r\n\r\n    /* Header colors */\r\n    .overtype-wrapper .overtype-preview .h1 { \r\n      color: var(--h1, #f95738) !important; \r\n    }\r\n    .overtype-wrapper .overtype-preview .h2 { \r\n      color: var(--h2, #ee964b) !important; \r\n    }\r\n    .overtype-wrapper .overtype-preview .h3 { \r\n      color: var(--h3, #3d8a51) !important; \r\n    }\r\n\r\n    /* Semantic headers - flatten in edit mode */\r\n    .overtype-wrapper .overtype-preview h1,\r\n    .overtype-wrapper .overtype-preview h2,\r\n    .overtype-wrapper .overtype-preview h3 {\r\n      font-size: inherit !important;\r\n      font-weight: bold !important;\r\n      margin: 0 !important;\r\n      padding: 0 !important;\r\n      display: inline !important;\r\n      line-height: inherit !important;\r\n    }\r\n\r\n    /* Header colors for semantic headers */\r\n    .overtype-wrapper .overtype-preview h1 { \r\n      color: var(--h1, #f95738) !important; \r\n    }\r\n    .overtype-wrapper .overtype-preview h2 { \r\n      color: var(--h2, #ee964b) !important; \r\n    }\r\n    .overtype-wrapper .overtype-preview h3 { \r\n      color: var(--h3, #3d8a51) !important; \r\n    }\r\n\r\n    /* Lists - remove styling in edit mode */\r\n    .overtype-wrapper .overtype-preview ul,\r\n    .overtype-wrapper .overtype-preview ol {\r\n      list-style: none !important;\r\n      margin: 0 !important;\r\n      padding: 0 !important;\r\n      display: block !important; /* Lists need to be block for line breaks */\r\n    }\r\n\r\n    .overtype-wrapper .overtype-preview li {\r\n      display: block !important; /* Each item on its own line */\r\n      margin: 0 !important;\r\n      padding: 0 !important;\r\n      /* Don't set list-style here - let ul/ol control it */\r\n    }\r\n\r\n    /* Bold text */\r\n    .overtype-wrapper .overtype-preview strong {\r\n      color: var(--strong, #ee964b) !important;\r\n      font-weight: bold !important;\r\n    }\r\n\r\n    /* Italic text */\r\n    .overtype-wrapper .overtype-preview em {\r\n      color: var(--em, #f95738) !important;\r\n      text-decoration-color: var(--em, #f95738) !important;\r\n      text-decoration-thickness: 1px !important;\r\n      font-style: italic !important;\r\n    }\r\n\r\n    /* Strikethrough text */\r\n    .overtype-wrapper .overtype-preview del {\r\n      color: var(--del, #ee964b) !important;\r\n      text-decoration: line-through !important;\r\n      text-decoration-color: var(--del, #ee964b) !important;\r\n      text-decoration-thickness: 1px !important;\r\n    }\r\n\r\n    /* Inline code */\r\n    .overtype-wrapper .overtype-preview code {\r\n      background: var(--code-bg, rgba(244, 211, 94, 0.4)) !important;\r\n      color: var(--code, #0d3b66) !important;\r\n      padding: 0 !important;\r\n      border-radius: 2px !important;\r\n      font-family: inherit !important;\r\n      font-size: inherit !important;\r\n      line-height: inherit !important;\r\n      font-weight: normal !important;\r\n    }\r\n\r\n    /* Code blocks - consolidated pre blocks */\r\n    .overtype-wrapper .overtype-preview pre {\r\n      padding: 0 !important;\r\n      margin: 0 !important;\r\n      border-radius: 4px !important;\r\n      overflow-x: auto !important;\r\n    }\r\n    \r\n    /* Code block styling in normal mode - yellow background */\r\n    .overtype-wrapper .overtype-preview pre.code-block {\r\n      background: var(--code-bg, rgba(244, 211, 94, 0.4)) !important;\r\n      white-space: break-spaces !important; /* Prevent horizontal scrollbar that breaks alignment */\r\n    }\r\n\r\n    /* Code inside pre blocks - remove background */\r\n    .overtype-wrapper .overtype-preview pre code {\r\n      background: transparent !important;\r\n      color: var(--code, #0d3b66) !important;\r\n      font-family: ${fontFamily} !important; /* Match textarea font exactly for alignment */\r\n    }\r\n\r\n    /* Blockquotes */\r\n    .overtype-wrapper .overtype-preview .blockquote {\r\n      color: var(--blockquote, #5a7a9b) !important;\r\n      padding: 0 !important;\r\n      margin: 0 !important;\r\n      border: none !important;\r\n    }\r\n\r\n    /* Links */\r\n    .overtype-wrapper .overtype-preview a {\r\n      color: var(--link, #0d3b66) !important;\r\n      text-decoration: underline !important;\r\n      font-weight: normal !important;\r\n    }\r\n\r\n    .overtype-wrapper .overtype-preview a:hover {\r\n      text-decoration: underline !important;\r\n      color: var(--link, #0d3b66) !important;\r\n    }\r\n\r\n    /* Lists - no list styling */\r\n    .overtype-wrapper .overtype-preview ul,\r\n    .overtype-wrapper .overtype-preview ol {\r\n      list-style: none !important;\r\n      margin: 0 !important;\r\n      padding: 0 !important;\r\n    }\r\n\r\n\r\n    /* Horizontal rules */\r\n    .overtype-wrapper .overtype-preview hr {\r\n      border: none !important;\r\n      color: var(--hr, #5a7a9b) !important;\r\n      margin: 0 !important;\r\n      padding: 0 !important;\r\n    }\r\n\r\n    .overtype-wrapper .overtype-preview .hr-marker {\r\n      color: var(--hr, #5a7a9b) !important;\r\n      opacity: 0.6 !important;\r\n    }\r\n\r\n    /* Code fence markers - with background when not in code block */\r\n    .overtype-wrapper .overtype-preview .code-fence {\r\n      color: var(--code, #0d3b66) !important;\r\n      background: var(--code-bg, rgba(244, 211, 94, 0.4)) !important;\r\n    }\r\n    \r\n    /* Code block lines - background for entire code block */\r\n    .overtype-wrapper .overtype-preview .code-block-line {\r\n      background: var(--code-bg, rgba(244, 211, 94, 0.4)) !important;\r\n    }\r\n    \r\n    /* Remove background from code fence when inside code block line */\r\n    .overtype-wrapper .overtype-preview .code-block-line .code-fence {\r\n      background: transparent !important;\r\n    }\r\n\r\n    /* Raw markdown line */\r\n    .overtype-wrapper .overtype-preview .raw-line {\r\n      color: var(--raw-line, #5a7a9b) !important;\r\n      font-style: normal !important;\r\n      font-weight: normal !important;\r\n    }\r\n\r\n    /* Syntax markers */\r\n    .overtype-wrapper .overtype-preview .syntax-marker {\r\n      color: var(--syntax-marker, rgba(13, 59, 102, 0.52)) !important;\r\n      opacity: 0.7 !important;\r\n    }\r\n\r\n    /* List markers */\r\n    .overtype-wrapper .overtype-preview .list-marker {\r\n      color: var(--list-marker, #ee964b) !important;\r\n    }\r\n\r\n    /* Stats bar */\r\n    \r\n    /* Stats bar - positioned by flexbox */\r\n    .overtype-stats {\r\n      height: 40px !important;\r\n      padding: 0 20px !important;\r\n      background: #f8f9fa !important;\r\n      border-top: 1px solid #e0e0e0 !important;\r\n      display: flex !important;\r\n      justify-content: space-between !important;\r\n      align-items: center !important;\r\n      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif !important;\r\n      font-size: 0.85rem !important;\r\n      color: #666 !important;\r\n      flex-shrink: 0 !important; /* Don't shrink */\r\n      z-index: 10001 !important; /* Above link tooltip */\r\n      position: relative !important; /* Enable z-index */\r\n    }\r\n    \r\n    /* Dark theme stats bar */\r\n    .overtype-container[data-theme=\"cave\"] .overtype-stats {\r\n      background: var(--bg-secondary, #1D2D3E) !important;\r\n      border-top: 1px solid rgba(197, 221, 232, 0.1) !important;\r\n      color: var(--text, #c5dde8) !important;\r\n    }\r\n    \r\n    .overtype-stats .overtype-stat {\r\n      display: flex !important;\r\n      align-items: center !important;\r\n      gap: 5px !important;\r\n      white-space: nowrap !important;\r\n    }\r\n    \r\n    .overtype-stats .live-dot {\r\n      width: 8px !important;\r\n      height: 8px !important;\r\n      background: #4caf50 !important;\r\n      border-radius: 50% !important;\r\n      animation: overtype-pulse 2s infinite !important;\r\n    }\r\n    \r\n    @keyframes overtype-pulse {\r\n      0%, 100% { opacity: 1; transform: scale(1); }\r\n      50% { opacity: 0.6; transform: scale(1.2); }\r\n    }\r\n    \r\n\r\n    /* Toolbar Styles */\r\n    .overtype-toolbar {\r\n      display: flex !important;\r\n      align-items: center !important;\r\n      gap: 4px !important;\r\n      padding: 8px !important; /* Override reset */\r\n      background: var(--toolbar-bg, var(--bg-primary, #f8f9fa)) !important; /* Override reset */\r\n      border-bottom: 1px solid var(--toolbar-border, transparent) !important; /* Override reset */\r\n      overflow-x: auto !important; /* Allow horizontal scrolling */\r\n      overflow-y: hidden !important; /* Hide vertical overflow */\r\n      -webkit-overflow-scrolling: touch !important;\r\n      flex-shrink: 0 !important;\r\n      height: auto !important;\r\n      position: relative !important; /* Override reset */\r\n      z-index: 100 !important; /* Ensure toolbar is above wrapper */\r\n      scrollbar-width: thin; /* Thin scrollbar on Firefox */\r\n    }\r\n    \r\n    /* Thin scrollbar styling */\r\n    .overtype-toolbar::-webkit-scrollbar {\r\n      height: 4px;\r\n    }\r\n    \r\n    .overtype-toolbar::-webkit-scrollbar-track {\r\n      background: transparent;\r\n    }\r\n    \r\n    .overtype-toolbar::-webkit-scrollbar-thumb {\r\n      background: rgba(0, 0, 0, 0.2);\r\n      border-radius: 2px;\r\n    }\r\n\r\n    .overtype-toolbar-button {\r\n      display: flex;\r\n      align-items: center;\r\n      justify-content: center;\r\n      width: 32px;\r\n      height: 32px;\r\n      padding: 0;\r\n      border: none;\r\n      border-radius: 6px;\r\n      background: transparent;\r\n      color: var(--toolbar-icon, var(--text-secondary, #666));\r\n      cursor: pointer;\r\n      transition: all 0.2s ease;\r\n      flex-shrink: 0;\r\n    }\r\n\r\n    .overtype-toolbar-button svg {\r\n      width: 20px;\r\n      height: 20px;\r\n      fill: currentColor;\r\n    }\r\n\r\n    .overtype-toolbar-button:hover {\r\n      background: var(--toolbar-hover, var(--bg-secondary, #e9ecef));\r\n      color: var(--toolbar-icon, var(--text-primary, #333));\r\n    }\r\n\r\n    .overtype-toolbar-button:active {\r\n      transform: scale(0.95);\r\n    }\r\n\r\n    .overtype-toolbar-button.active {\r\n      background: var(--toolbar-active, var(--primary, #007bff));\r\n      color: var(--toolbar-icon, var(--text-primary, #333));\r\n    }\r\n\r\n    .overtype-toolbar-button:disabled {\r\n      opacity: 0.5;\r\n      cursor: not-allowed;\r\n    }\r\n\r\n    .overtype-toolbar-separator {\r\n      width: 1px;\r\n      height: 24px;\r\n      background: var(--border, #e0e0e0);\r\n      margin: 0 4px;\r\n      flex-shrink: 0;\r\n    }\r\n\r\n    /* Adjust wrapper when toolbar is present */\r\n    /* Mobile toolbar adjustments */\r\n    @media (max-width: 640px) {\r\n      .overtype-toolbar {\r\n        padding: 6px;\r\n        gap: 2px;\r\n      }\r\n\r\n      .overtype-toolbar-button {\r\n        width: 36px;\r\n        height: 36px;\r\n      }\r\n\r\n      .overtype-toolbar-separator {\r\n        margin: 0 2px;\r\n      }\r\n    }\r\n    \r\n    /* Plain mode - hide preview and show textarea text */\r\n    .overtype-container[data-mode=\"plain\"] .overtype-preview {\r\n      display: none !important;\r\n    }\r\n    \r\n    .overtype-container[data-mode=\"plain\"] .overtype-input {\r\n      color: var(--text, #0d3b66) !important;\r\n      /* Use system font stack for better plain text readability */\r\n      font-family: -apple-system, BlinkMacSystemFont, \"Segoe UI\", Roboto, \r\n                   \"Helvetica Neue\", Arial, sans-serif !important;\r\n    }\r\n    \r\n    /* Ensure textarea remains transparent in overlay mode */\r\n    .overtype-container:not([data-mode=\"plain\"]) .overtype-input {\r\n      color: transparent !important;\r\n    }\r\n\r\n    /* Dropdown menu styles */\r\n    .overtype-toolbar-button {\r\n      position: relative !important; /* Override reset - needed for dropdown */\r\n    }\r\n\r\n    .overtype-toolbar-button.dropdown-active {\r\n      background: var(--toolbar-active, var(--hover-bg, #f0f0f0));\r\n    }\r\n\r\n    .overtype-dropdown-menu {\r\n      position: fixed !important; /* Fixed positioning relative to viewport */\r\n      background: var(--bg-secondary, white) !important; /* Override reset */\r\n      border: 1px solid var(--border, #e0e0e0) !important; /* Override reset */\r\n      border-radius: 6px;\r\n      box-shadow: 0 2px 8px rgba(0,0,0,0.1) !important; /* Override reset */\r\n      z-index: 10000; /* Very high z-index to ensure visibility */\r\n      min-width: 150px;\r\n      padding: 4px 0 !important; /* Override reset */\r\n      /* Position will be set via JavaScript based on button position */\r\n    }\r\n\r\n    .overtype-dropdown-item {\r\n      display: flex;\r\n      align-items: center;\r\n      width: 100%;\r\n      padding: 8px 12px;\r\n      border: none;\r\n      background: none;\r\n      text-align: left;\r\n      cursor: pointer;\r\n      font-size: 14px;\r\n      color: var(--text, #333);\r\n      font-family: -apple-system, BlinkMacSystemFont, \"Segoe UI\", Roboto, sans-serif;\r\n    }\r\n\r\n    .overtype-dropdown-item:hover {\r\n      background: var(--hover-bg, #f0f0f0);\r\n    }\r\n\r\n    .overtype-dropdown-item.active {\r\n      font-weight: 600;\r\n    }\r\n\r\n    .overtype-dropdown-check {\r\n      width: 16px;\r\n      margin-right: 8px;\r\n      color: var(--h1, #007bff);\r\n    }\r\n\r\n    .overtype-dropdown-icon {\r\n      width: 20px;\r\n      margin-right: 8px;\r\n      text-align: center;\r\n    }\r\n\r\n    /* Preview mode styles */\r\n    .overtype-container[data-mode=\"preview\"] .overtype-input {\r\n      display: none !important;\r\n    }\r\n\r\n    .overtype-container[data-mode=\"preview\"] .overtype-preview {\r\n      pointer-events: auto !important;\r\n      user-select: text !important;\r\n      cursor: text !important;\r\n    }\r\n\r\n    /* Hide syntax markers in preview mode */\r\n    .overtype-container[data-mode=\"preview\"] .syntax-marker {\r\n      display: none !important;\r\n    }\r\n    \r\n    /* Hide URL part of links in preview mode - extra specificity */\r\n    .overtype-container[data-mode=\"preview\"] .syntax-marker.url-part,\r\n    .overtype-container[data-mode=\"preview\"] .url-part {\r\n      display: none !important;\r\n    }\r\n    \r\n    /* Hide all syntax markers inside links too */\r\n    .overtype-container[data-mode=\"preview\"] a .syntax-marker {\r\n      display: none !important;\r\n    }\r\n\r\n    /* Headers - restore proper sizing in preview mode */\r\n    .overtype-container[data-mode=\"preview\"] .overtype-wrapper .overtype-preview h1, \r\n    .overtype-container[data-mode=\"preview\"] .overtype-wrapper .overtype-preview h2, \r\n    .overtype-container[data-mode=\"preview\"] .overtype-wrapper .overtype-preview h3 {\r\n      font-family: -apple-system, BlinkMacSystemFont, \"Segoe UI\", Roboto, sans-serif !important;\r\n      font-weight: 600 !important;\r\n      margin: 0 !important;\r\n      display: block !important;\r\n      color: inherit !important; /* Use parent text color */\r\n      line-height: 1 !important; /* Tight line height for headings */\r\n    }\r\n    \r\n    .overtype-container[data-mode=\"preview\"] .overtype-wrapper .overtype-preview h1 { \r\n      font-size: 2em !important; \r\n    }\r\n    \r\n    .overtype-container[data-mode=\"preview\"] .overtype-wrapper .overtype-preview h2 { \r\n      font-size: 1.5em !important; \r\n    }\r\n    \r\n    .overtype-container[data-mode=\"preview\"] .overtype-wrapper .overtype-preview h3 { \r\n      font-size: 1.17em !important; \r\n    }\r\n\r\n    /* Lists - restore list styling in preview mode */\r\n    .overtype-container[data-mode=\"preview\"] .overtype-wrapper .overtype-preview ul {\r\n      display: block !important;\r\n      list-style: disc !important;\r\n      padding-left: 2em !important;\r\n      margin: 1em 0 !important;\r\n    }\r\n\r\n    .overtype-container[data-mode=\"preview\"] .overtype-wrapper .overtype-preview ol {\r\n      display: block !important;\r\n      list-style: decimal !important;\r\n      padding-left: 2em !important;\r\n      margin: 1em 0 !important;\r\n    }\r\n    \r\n    .overtype-container[data-mode=\"preview\"] .overtype-wrapper .overtype-preview li {\r\n      display: list-item !important;\r\n      margin: 0 !important;\r\n      padding: 0 !important;\r\n    }\r\n\r\n    /* Task list checkboxes - only in preview mode */\r\n    .overtype-container[data-mode=\"preview\"] .overtype-wrapper .overtype-preview li.task-list {\r\n      list-style: none !important;\r\n      position: relative !important;\r\n    }\r\n\r\n    .overtype-container[data-mode=\"preview\"] .overtype-wrapper .overtype-preview li.task-list input[type=\"checkbox\"] {\r\n      margin-right: 0.5em !important;\r\n      cursor: default !important;\r\n      vertical-align: middle !important;\r\n    }\r\n\r\n    /* Task list in normal mode - keep syntax visible */\r\n    .overtype-container:not([data-mode=\"preview\"]) .overtype-wrapper .overtype-preview li.task-list {\r\n      list-style: none !important;\r\n    }\r\n\r\n    .overtype-container:not([data-mode=\"preview\"]) .overtype-wrapper .overtype-preview li.task-list .syntax-marker {\r\n      color: var(--syntax, #999999) !important;\r\n      font-weight: normal !important;\r\n    }\r\n\r\n    /* Links - make clickable in preview mode */\r\n    .overtype-container[data-mode=\"preview\"] .overtype-wrapper .overtype-preview a {\r\n      pointer-events: auto !important;\r\n      cursor: pointer !important;\r\n      color: var(--link, #0066cc) !important;\r\n      text-decoration: underline !important;\r\n    }\r\n\r\n    /* Code blocks - proper pre/code styling in preview mode */\r\n    .overtype-container[data-mode=\"preview\"] .overtype-wrapper .overtype-preview pre.code-block {\r\n      background: #2d2d2d !important;\r\n      color: #f8f8f2 !important;\r\n      padding: 1.2em !important;\r\n      border-radius: 3px !important;\r\n      overflow-x: auto !important;\r\n      margin: 0 !important;\r\n      display: block !important;\r\n    }\r\n    \r\n    /* Cave theme code block background in preview mode */\r\n    .overtype-container[data-theme=\"cave\"][data-mode=\"preview\"] .overtype-wrapper .overtype-preview pre.code-block {\r\n      background: #11171F !important;\r\n    }\r\n\r\n    .overtype-container[data-mode=\"preview\"] .overtype-wrapper .overtype-preview pre.code-block code {\r\n      background: transparent !important;\r\n      color: inherit !important;\r\n      padding: 0 !important;\r\n      font-family: ${fontFamily} !important;\r\n      font-size: 0.9em !important;\r\n      line-height: 1.4 !important;\r\n    }\r\n\r\n    /* Hide old code block lines and fences in preview mode */\r\n    .overtype-container[data-mode=\"preview\"] .overtype-wrapper .overtype-preview .code-block-line {\r\n      display: none !important;\r\n    }\r\n\r\n    .overtype-container[data-mode=\"preview\"] .overtype-wrapper .overtype-preview .code-fence {\r\n      display: none !important;\r\n    }\r\n\r\n    /* Blockquotes - enhanced styling in preview mode */\r\n    .overtype-container[data-mode=\"preview\"] .overtype-wrapper .overtype-preview .blockquote {\r\n      display: block !important;\r\n      border-left: 4px solid var(--blockquote, #ddd) !important;\r\n      padding-left: 1em !important;\r\n      margin: 1em 0 !important;\r\n      font-style: italic !important;\r\n    }\r\n\r\n    /* Typography improvements in preview mode */\r\n    .overtype-container[data-mode=\"preview\"] .overtype-wrapper .overtype-preview {\r\n      font-family: Georgia, 'Times New Roman', serif !important;\r\n      font-size: 16px !important;\r\n      line-height: 1.8 !important;\r\n      color: var(--text, #333) !important; /* Consistent text color */\r\n    }\r\n\r\n    /* Inline code in preview mode - keep monospace */\r\n    .overtype-container[data-mode=\"preview\"] .overtype-wrapper .overtype-preview code {\r\n      font-family: ${fontFamily} !important;\r\n      font-size: 0.9em !important;\r\n      background: rgba(135, 131, 120, 0.15) !important;\r\n      padding: 0.2em 0.4em !important;\r\n      border-radius: 3px !important;\r\n    }\r\n\r\n    /* Strong and em elements in preview mode */\r\n    .overtype-container[data-mode=\"preview\"] .overtype-wrapper .overtype-preview strong {\r\n      font-weight: 700 !important;\r\n      color: inherit !important; /* Use parent text color */\r\n    }\r\n\r\n    .overtype-container[data-mode=\"preview\"] .overtype-wrapper .overtype-preview em {\r\n      font-style: italic !important;\r\n      color: inherit !important; /* Use parent text color */\r\n    }\r\n\r\n    /* HR in preview mode */\r\n    .overtype-container[data-mode=\"preview\"] .overtype-wrapper .overtype-preview .hr-marker {\r\n      display: block !important;\r\n      border-top: 2px solid var(--hr, #ddd) !important;\r\n      text-indent: -9999px !important;\r\n      height: 2px !important;\r\n    }\r\n\r\n    /* Link Tooltip - Base styles (all browsers) */\r\n    .overtype-link-tooltip {\r\n      /* Visual styles that work for both positioning methods */\r\n      background: #333 !important;\r\n      color: white !important;\r\n      padding: 6px 10px !important;\r\n      border-radius: 16px !important;\r\n      font-size: 12px !important;\r\n      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif !important;\r\n      display: none !important;\r\n      z-index: 10000 !important;\r\n      cursor: pointer !important;\r\n      box-shadow: 0 2px 8px rgba(0,0,0,0.3) !important;\r\n      max-width: 300px !important;\r\n      white-space: nowrap !important;\r\n      overflow: hidden !important;\r\n      text-overflow: ellipsis !important;\r\n\r\n      /* Base positioning for Floating UI fallback */\r\n      position: absolute;\r\n    }\r\n\r\n    .overtype-link-tooltip.visible {\r\n      display: flex !important;\r\n    }\r\n\r\n    /* CSS Anchor Positioning (modern browsers only) */\r\n    @supports (position-anchor: --x) and (position-area: center) {\r\n      .overtype-link-tooltip {\r\n        /* Only anchor positioning specific properties */\r\n        position-anchor: var(--target-anchor, --link-0);\r\n        position-area: block-end center;\r\n        margin-top: 8px !important;\r\n        position-try: most-width block-end inline-end, flip-inline, block-start center;\r\n        position-visibility: anchors-visible;\r\n      }\r\n    }\r\n\r\n    ${mobileStyles}\r\n  `;\r\n}", "/**\n * Format definitions for markdown syntax\n */\n\nexport const FORMATS = {\n  bold: {\n    prefix: '**',\n    suffix: '**',\n    trimFirst: true\n  },\n  italic: {\n    prefix: '_',\n    suffix: '_',\n    trimFirst: true\n  },\n  code: {\n    prefix: '`',\n    suffix: '`',\n    blockPrefix: '```',\n    blockSuffix: '```'\n  },\n  link: {\n    prefix: '[',\n    suffix: '](url)',\n    replaceNext: 'url',\n    scanFor: 'https?://'\n  },\n  bulletList: {\n    prefix: '- ',\n    multiline: true,\n    unorderedList: true\n  },\n  numberedList: {\n    prefix: '1. ',\n    multiline: true,\n    orderedList: true\n  },\n  quote: {\n    prefix: '> ',\n    multiline: true,\n    surroundWithNewlines: true\n  },\n  taskList: {\n    prefix: '- [ ] ',\n    multiline: true,\n    surroundWithNewlines: true\n  },\n  header1: { prefix: '# ' },\n  header2: { prefix: '## ' },\n  header3: { prefix: '### ' },\n  header4: { prefix: '#### ' },\n  header5: { prefix: '##### ' },\n  header6: { prefix: '###### ' }\n}\n\n/**\n * Default style configuration\n */\nexport function getDefaultStyle() {\n  return {\n    prefix: '',\n    suffix: '',\n    blockPrefix: '',\n    blockSuffix: '',\n    multiline: false,\n    replaceNext: '',\n    prefixSpace: false,\n    scanFor: '',\n    surroundWithNewlines: false,\n    orderedList: false,\n    unorderedList: false,\n    trimFirst: false\n  }\n}\n\n/**\n * Merge format with defaults\n */\nexport function mergeWithDefaults(format) {\n  return { ...getDefaultStyle(), ...format }\n}", "/**\n * Debug utilities for markdown-actions\n * Add console logging to track what's happening\n */\n\n// Debug mode flag - disabled by default\nlet debugMode = false;\n\n/**\n * Enable or disable debug mode\n * @param {boolean} enabled - Whether to enable debug mode\n */\nexport function setDebugMode(enabled) {\n  debugMode = enabled;\n}\n\n/**\n * Get current debug mode status\n * @returns {boolean} Whether debug mode is enabled\n */\nexport function getDebugMode() {\n  return debugMode;\n}\n\nexport function debugLog(funcName, message, data) {\n  // These will be completely removed by esbuild's drop: ['console'] in production\n  if (!debugMode) return;\n  \n  console.group(`\uD83D\uDD0D ${funcName}`);\n  console.log(message);\n  if (data) {\n    console.log('Data:', data);\n  }\n  console.groupEnd();\n}\n\nexport function debugSelection(textarea, label) {\n  // These will be completely removed by esbuild's drop: ['console'] in production\n  if (!debugMode) return;\n  \n  const selected = textarea.value.slice(textarea.selectionStart, textarea.selectionEnd);\n  console.group(`\uD83D\uDCCD Selection: ${label}`);\n  console.log('Position:', `${textarea.selectionStart}-${textarea.selectionEnd}`);\n  console.log('Selected text:', JSON.stringify(selected));\n  console.log('Length:', selected.length);\n  \n  // Show context around selection\n  const before = textarea.value.slice(Math.max(0, textarea.selectionStart - 10), textarea.selectionStart);\n  const after = textarea.value.slice(textarea.selectionEnd, Math.min(textarea.value.length, textarea.selectionEnd + 10));\n  console.log('Context:', JSON.stringify(before) + '[SELECTION]' + JSON.stringify(after));\n  console.groupEnd();\n}\n\nexport function debugResult(result) {\n  // These will be completely removed by esbuild's drop: ['console'] in production\n  if (!debugMode) return;\n  \n  console.group('\uD83D\uDCDD Result');\n  console.log('Text to insert:', JSON.stringify(result.text));\n  console.log('New selection:', `${result.selectionStart}-${result.selectionEnd}`);\n  console.groupEnd();\n}", "/**\n * Text insertion system with undo/redo support\n * Extracted and adapted from GitHub's markdown-toolbar-element\n */\n\nimport { getDebugMode } from '../debug.js'\n\nlet canInsertText = null\n\n/**\n * Insert text at current position with undo/redo support\n * @param {HTMLTextAreaElement} textarea - Target textarea\n * @param {Object} options - Text and selection options\n * @param {string} options.text - Text to insert\n * @param {number} [options.selectionStart] - New selection start\n * @param {number} [options.selectionEnd] - New selection end\n */\nexport function insertText(textarea, { text, selectionStart, selectionEnd }) {\n  const debugMode = getDebugMode();\n  \n  if (debugMode) {\n    console.group('\uD83D\uDD27 insertText');\n    console.log('Current selection:', `${textarea.selectionStart}-${textarea.selectionEnd}`);\n    console.log('Text to insert:', JSON.stringify(text));\n    console.log('New selection to set:', selectionStart, '-', selectionEnd);\n  }\n  \n  // Make sure the textarea is focused\n  textarea.focus();\n  \n  const originalSelectionStart = textarea.selectionStart\n  const originalSelectionEnd = textarea.selectionEnd\n  const before = textarea.value.slice(0, originalSelectionStart)\n  const after = textarea.value.slice(originalSelectionEnd)\n  \n  if (debugMode) {\n    console.log('Before text (last 20):', JSON.stringify(before.slice(-20)));\n    console.log('After text (first 20):', JSON.stringify(after.slice(0, 20)));\n    console.log('Selected text being replaced:', JSON.stringify(textarea.value.slice(originalSelectionStart, originalSelectionEnd)));\n  }\n  \n  // Store the original value to check if execCommand actually changed it\n  const originalValue = textarea.value\n\n  // Try execCommand for both insertions and replacements to preserve undo history\n  // execCommand('insertText') can handle replacing selected text\n  const hasSelection = originalSelectionStart !== originalSelectionEnd\n  \n  if (canInsertText === null || canInsertText === true) {\n    textarea.contentEditable = 'true'\n    try {\n      canInsertText = document.execCommand('insertText', false, text)\n      if (debugMode) console.log('execCommand returned:', canInsertText, 'for text with', text.split('\\n').length, 'lines');\n    } catch (error) {\n      canInsertText = false\n      if (debugMode) console.log('execCommand threw error:', error);\n    }\n    textarea.contentEditable = 'false'\n  }\n\n  if (debugMode) {\n    console.log('canInsertText before:', canInsertText);\n    console.log('execCommand result:', canInsertText);\n  }\n  \n  // Check if execCommand actually worked by comparing the value\n  if (canInsertText) {\n    const expectedValue = before + text + after\n    const actualValue = textarea.value\n    \n    if (debugMode) {\n      console.log('Expected length:', expectedValue.length);\n      console.log('Actual length:', actualValue.length);\n    }\n    \n    if (actualValue !== expectedValue) {\n      if (debugMode) {\n        console.log('execCommand changed the value but not as expected');\n        console.log('Expected:', JSON.stringify(expectedValue.slice(0, 100)));\n        console.log('Actual:', JSON.stringify(actualValue.slice(0, 100)));\n      }\n      // Don't set canInsertText to false here - execCommand did work\n      // We just need to not double-insert\n    }\n  }\n\n  if (!canInsertText) {\n    if (debugMode) console.log('Using manual insertion');\n    // Only do manual insertion if execCommand didn't change the value\n    if (textarea.value === originalValue) {\n      if (debugMode) console.log('Value unchanged, doing manual replacement');\n      try {\n        document.execCommand('ms-beginUndoUnit')\n      } catch (e) {\n        // Do nothing.\n      }\n      textarea.value = before + text + after\n      try {\n        document.execCommand('ms-endUndoUnit')\n      } catch (e) {\n        // Do nothing.\n      }\n      textarea.dispatchEvent(new CustomEvent('input', { bubbles: true, cancelable: true }))\n    } else {\n      if (debugMode) console.log('Value was changed by execCommand, skipping manual insertion');\n    }\n  }\n\n  if (debugMode) console.log('Setting selection range:', selectionStart, selectionEnd);\n  if (selectionStart != null && selectionEnd != null) {\n    textarea.setSelectionRange(selectionStart, selectionEnd)\n  } else {\n    textarea.setSelectionRange(originalSelectionStart, textarea.selectionEnd)\n  }\n  \n  if (debugMode) {\n    console.log('Final value length:', textarea.value.length);\n    console.groupEnd();\n  }\n}\n\n/**\n * Configure undo method\n * @param {'native' | 'manual' | 'auto'} method - Undo method to use\n */\nexport function setUndoMethod(method) {\n  switch (method) {\n    case 'native':\n      canInsertText = true\n      break\n    case 'manual':\n      canInsertText = false\n      break\n    case 'auto':\n      canInsertText = null\n      break\n  }\n}", "/**\n * Core selection utilities extracted and adapted from GitHub's markdown-toolbar-element\n */\n\n/**\n * Check if string contains multiple lines\n */\nexport function isMultipleLines(string) {\n  return string.trim().split('\\n').length > 1\n}\n\n/**\n * Find the start of the word at position i\n */\nexport function wordSelectionStart(text, i) {\n  let index = i\n  while (text[index] && text[index - 1] != null && !text[index - 1].match(/\\s/)) {\n    index--\n  }\n  return index\n}\n\n/**\n * Find the end of the word at position i\n */\nexport function wordSelectionEnd(text, i, multiline) {\n  let index = i\n  const breakpoint = multiline ? /\\n/ : /\\s/\n  while (text[index] && !text[index].match(breakpoint)) {\n    index++\n  }\n  return index\n}\n\n/**\n * Expand selection to line boundaries\n */\nexport function expandSelectionToLine(textarea) {\n  const lines = textarea.value.split('\\n')\n  let counter = 0\n  for (let index = 0; index < lines.length; index++) {\n    const lineLength = lines[index].length + 1\n    if (textarea.selectionStart >= counter && textarea.selectionStart < counter + lineLength) {\n      textarea.selectionStart = counter\n    }\n    if (textarea.selectionEnd >= counter && textarea.selectionEnd < counter + lineLength) {\n      // For the last line, don't go past the actual text length\n      if (index === lines.length - 1) {\n        textarea.selectionEnd = Math.min(counter + lines[index].length, textarea.value.length)\n      } else {\n        textarea.selectionEnd = counter + lineLength - 1\n      }\n    }\n    counter += lineLength\n  }\n}\n\n/**\n * Expand selected text with smart boundary detection\n */\nexport function expandSelectedText(textarea, prefixToUse, suffixToUse, multiline = false) {\n  if (textarea.selectionStart === textarea.selectionEnd) {\n    textarea.selectionStart = wordSelectionStart(textarea.value, textarea.selectionStart)\n    textarea.selectionEnd = wordSelectionEnd(textarea.value, textarea.selectionEnd, multiline)\n  } else {\n    const expandedSelectionStart = textarea.selectionStart - prefixToUse.length\n    const expandedSelectionEnd = textarea.selectionEnd + suffixToUse.length\n    const beginsWithPrefix = textarea.value.slice(expandedSelectionStart, textarea.selectionStart) === prefixToUse\n    const endsWithSuffix = textarea.value.slice(textarea.selectionEnd, expandedSelectionEnd) === suffixToUse\n    if (beginsWithPrefix && endsWithSuffix) {\n      textarea.selectionStart = expandedSelectionStart\n      textarea.selectionEnd = expandedSelectionEnd\n    }\n  }\n  return textarea.value.slice(textarea.selectionStart, textarea.selectionEnd)\n}\n\n/**\n * Calculate newlines needed to surround selected text\n */\nexport function newlinesToSurroundSelectedText(textarea) {\n  const beforeSelection = textarea.value.slice(0, textarea.selectionStart)\n  const afterSelection = textarea.value.slice(textarea.selectionEnd)\n\n  const breaksBefore = beforeSelection.match(/\\n*$/)\n  const breaksAfter = afterSelection.match(/^\\n*/)\n  const newlinesBeforeSelection = breaksBefore ? breaksBefore[0].length : 0\n  const newlinesAfterSelection = breaksAfter ? breaksAfter[0].length : 0\n\n  let newlinesToAppend = ''\n  let newlinesToPrepend = ''\n\n  if (beforeSelection.match(/\\S/) && newlinesBeforeSelection < 2) {\n    newlinesToAppend = '\\n'.repeat(2 - newlinesBeforeSelection)\n  }\n\n  if (afterSelection.match(/\\S/) && newlinesAfterSelection < 2) {\n    newlinesToPrepend = '\\n'.repeat(2 - newlinesAfterSelection)\n  }\n\n  return { newlinesToAppend, newlinesToPrepend }\n}\n\n/**\n * Utility to preserve selection during operations\n */\nexport function preserveSelection(textarea, callback) {\n  const start = textarea.selectionStart\n  const end = textarea.selectionEnd\n  const scrollTop = textarea.scrollTop\n  \n  callback()\n  \n  textarea.selectionStart = start\n  textarea.selectionEnd = end\n  textarea.scrollTop = scrollTop\n}\n\n/**\n * Apply a line-based operation with cursor preservation\n * This function handles expanding to line boundaries and preserving cursor position\n * @param {HTMLTextAreaElement} textarea - The textarea element\n * @param {Function} operation - The operation to perform (receives textarea and returns result)\n * @param {Object} options - Options for the operation\n * @param {string} options.prefix - The prefix being added/removed (for cursor adjustment)\n * @param {Function} options.adjustSelection - Custom selection adjustment function\n * @returns {Object} The result from the operation with adjusted cursor position\n */\nexport function applyLineOperation(textarea, operation, options = {}) {\n  // Save original cursor position AND selection before any expansion\n  const originalStart = textarea.selectionStart\n  const originalEnd = textarea.selectionEnd\n  const noInitialSelection = originalStart === originalEnd\n  \n  // Store the line start position to calculate offset later\n  const value = textarea.value\n  let lineStart = originalStart\n  \n  // Find start of the line containing the selection start\n  while (lineStart > 0 && value[lineStart - 1] !== '\\n') {\n    lineStart--\n  }\n  \n  // Expand selection to line boundaries for the operation\n  if (noInitialSelection) {\n    // Expand to current line when no selection\n    let lineEnd = originalStart\n    \n    // Find end of current line\n    while (lineEnd < value.length && value[lineEnd] !== '\\n') {\n      lineEnd++\n    }\n    \n    textarea.selectionStart = lineStart\n    textarea.selectionEnd = lineEnd\n  } else {\n    // For selections, expand to full lines\n    expandSelectionToLine(textarea)\n  }\n  \n  // Apply the operation\n  const result = operation(textarea)\n  \n  // Restore original selection/cursor with prefix adjustment\n  if (options.adjustSelection) {\n    // Use custom selection adjustment logic\n    const selectedText = textarea.value.slice(textarea.selectionStart, textarea.selectionEnd)\n    const isRemoving = selectedText.startsWith(options.prefix)\n    const adjusted = options.adjustSelection(isRemoving, originalStart, originalEnd, lineStart)\n    result.selectionStart = adjusted.start\n    result.selectionEnd = adjusted.end\n  } else if (options.prefix) {\n    // Use default prefix-based adjustment\n    const selectedText = textarea.value.slice(textarea.selectionStart, textarea.selectionEnd)\n    const isRemoving = selectedText.startsWith(options.prefix)\n    \n    if (noInitialSelection) {\n      // No selection - just restore cursor position\n      if (isRemoving) {\n        // When removing prefix, adjust cursor position\n        result.selectionStart = Math.max(originalStart - options.prefix.length, lineStart)\n        result.selectionEnd = result.selectionStart\n      } else {\n        // When adding prefix, adjust cursor position\n        result.selectionStart = originalStart + options.prefix.length\n        result.selectionEnd = result.selectionStart\n      }\n    } else {\n      // Had a selection - restore it with adjustment\n      if (isRemoving) {\n        // When removing prefix, shift selection back\n        result.selectionStart = Math.max(originalStart - options.prefix.length, lineStart)\n        result.selectionEnd = Math.max(originalEnd - options.prefix.length, lineStart)\n      } else {\n        // When adding prefix, shift selection forward\n        result.selectionStart = originalStart + options.prefix.length\n        result.selectionEnd = originalEnd + options.prefix.length\n      }\n    }\n  }\n  \n  return result\n}", "/**\n * Block-level text formatting operations\n * Handles inline formats like bold, italic, code, and links\n */\n\nimport { expandSelectedText, newlinesToSurroundSelectedText, isMultipleLines } from '../core/selection.js'\nimport { insertText } from '../core/insertion.js'\n\n/**\n * Apply block-level styling to selected text\n */\nexport function blockStyle(textarea, style) {\n  let newlinesToAppend\n  let newlinesToPrepend\n\n  const { prefix, suffix, blockPrefix, blockSuffix, replaceNext, prefixSpace, scanFor, surroundWithNewlines, trimFirst } = style\n  const originalSelectionStart = textarea.selectionStart\n  const originalSelectionEnd = textarea.selectionEnd\n\n  let selectedText = textarea.value.slice(textarea.selectionStart, textarea.selectionEnd)\n  let prefixToUse = isMultipleLines(selectedText) && blockPrefix && blockPrefix.length > 0 ? `${blockPrefix}\\n` : prefix\n  let suffixToUse = isMultipleLines(selectedText) && blockSuffix && blockSuffix.length > 0 ? `\\n${blockSuffix}` : suffix\n\n  if (prefixSpace) {\n    const beforeSelection = textarea.value[textarea.selectionStart - 1]\n    if (textarea.selectionStart !== 0 && beforeSelection != null && !beforeSelection.match(/\\s/)) {\n      prefixToUse = ` ${prefixToUse}`\n    }\n  }\n  \n  selectedText = expandSelectedText(textarea, prefixToUse, suffixToUse, style.multiline)\n  let selectionStart = textarea.selectionStart\n  let selectionEnd = textarea.selectionEnd\n  const hasReplaceNext = replaceNext && replaceNext.length > 0 && suffixToUse.indexOf(replaceNext) > -1 && selectedText.length > 0\n  \n  if (surroundWithNewlines) {\n    const ref = newlinesToSurroundSelectedText(textarea)\n    newlinesToAppend = ref.newlinesToAppend\n    newlinesToPrepend = ref.newlinesToPrepend\n    prefixToUse = newlinesToAppend + prefix\n    suffixToUse += newlinesToPrepend\n  }\n\n  // Check if we should remove formatting (toggle off)\n  if (selectedText.startsWith(prefixToUse) && selectedText.endsWith(suffixToUse)) {\n    const replacementText = selectedText.slice(prefixToUse.length, selectedText.length - suffixToUse.length)\n    if (originalSelectionStart === originalSelectionEnd) {\n      let position = originalSelectionStart - prefixToUse.length\n      position = Math.max(position, selectionStart)\n      position = Math.min(position, selectionStart + replacementText.length)\n      selectionStart = selectionEnd = position\n    } else {\n      selectionEnd = selectionStart + replacementText.length\n    }\n    return { text: replacementText, selectionStart, selectionEnd }\n  } else if (!hasReplaceNext) {\n    // Add formatting\n    let replacementText = prefixToUse + selectedText + suffixToUse\n    selectionStart = originalSelectionStart + prefixToUse.length\n    selectionEnd = originalSelectionEnd + prefixToUse.length\n    const whitespaceEdges = selectedText.match(/^\\s*|\\s*$/g)\n    if (trimFirst && whitespaceEdges) {\n      const leadingWhitespace = whitespaceEdges[0] || ''\n      const trailingWhitespace = whitespaceEdges[1] || ''\n      replacementText = leadingWhitespace + prefixToUse + selectedText.trim() + suffixToUse + trailingWhitespace\n      selectionStart += leadingWhitespace.length\n      selectionEnd -= trailingWhitespace.length\n    }\n    return { text: replacementText, selectionStart, selectionEnd }\n  } else if (scanFor && scanFor.length > 0 && selectedText.match(scanFor)) {\n    // Handle link/image with URL detection\n    suffixToUse = suffixToUse.replace(replaceNext, selectedText)\n    const replacementText = prefixToUse + suffixToUse\n    selectionStart = selectionEnd = selectionStart + prefixToUse.length\n    return { text: replacementText, selectionStart, selectionEnd }\n  } else {\n    // Handle link/image with placeholder\n    const replacementText = prefixToUse + selectedText + suffixToUse\n    selectionStart = selectionStart + prefixToUse.length + selectedText.length + suffixToUse.indexOf(replaceNext)\n    selectionEnd = selectionStart + replaceNext.length\n    return { text: replacementText, selectionStart, selectionEnd }\n  }\n}\n\n/**\n * Apply style to selected text in textarea\n */\nexport function styleSelectedText(textarea, style) {\n  const text = textarea.value.slice(textarea.selectionStart, textarea.selectionEnd)\n  \n  let result\n  if (style.orderedList || style.unorderedList) {\n    // Will be handled by list operations\n    return\n  } else if (style.multiline && isMultipleLines(text)) {\n    result = multilineStyle(textarea, style)\n  } else {\n    result = blockStyle(textarea, style)\n  }\n\n  insertText(textarea, result)\n}\n\n/**\n * Apply multiline styling (quotes, task lists, etc)\n * Note: This does NOT expand selection to line - that should be done by the caller if needed\n */\nexport function multilineStyle(textarea, style) {\n  const { prefix, suffix, surroundWithNewlines } = style\n  let text = textarea.value.slice(textarea.selectionStart, textarea.selectionEnd)\n  let selectionStart = textarea.selectionStart\n  let selectionEnd = textarea.selectionEnd\n  const lines = text.split('\\n')\n  \n  // Check if we need to undo (all lines have the format)\n  const undoStyle = lines.every(line => line.startsWith(prefix) && (!suffix || line.endsWith(suffix)))\n\n  if (undoStyle) {\n    // Remove the formatting\n    text = lines.map(line => {\n      let result = line.slice(prefix.length)\n      if (suffix) {\n        result = result.slice(0, result.length - suffix.length)\n      }\n      return result\n    }).join('\\n')\n    selectionEnd = selectionStart + text.length\n  } else {\n    // Apply the formatting\n    text = lines.map(line => prefix + line + (suffix || '')).join('\\n')\n    if (surroundWithNewlines) {\n      const { newlinesToAppend, newlinesToPrepend } = newlinesToSurroundSelectedText(textarea)\n      selectionStart += newlinesToAppend.length\n      selectionEnd = selectionStart + text.length\n      text = newlinesToAppend + text + newlinesToPrepend\n    }\n  }\n\n  return { text, selectionStart, selectionEnd }\n}", "/**\n * List operations for bullet and numbered lists\n */\n\nimport { expandSelectionToLine, newlinesToSurroundSelectedText, applyLineOperation } from '../core/selection.js'\nimport { insertText } from '../core/insertion.js'\n\n/**\n * Undo ordered list formatting\n */\nfunction undoOrderedListStyle(text) {\n  const lines = text.split('\\n')\n  const orderedListRegex = /^\\d+\\.\\s+/\n  const shouldUndoOrderedList = lines.every(line => orderedListRegex.test(line))\n  let result = lines\n  if (shouldUndoOrderedList) {\n    result = lines.map(line => line.replace(orderedListRegex, ''))\n  }\n\n  return {\n    text: result.join('\\n'),\n    processed: shouldUndoOrderedList\n  }\n}\n\n/**\n * Undo unordered list formatting\n */\nfunction undoUnorderedListStyle(text) {\n  const lines = text.split('\\n')\n  const unorderedListPrefix = '- '\n  const shouldUndoUnorderedList = lines.every(line => line.startsWith(unorderedListPrefix))\n  let result = lines\n  if (shouldUndoUnorderedList) {\n    result = lines.map(line => line.slice(unorderedListPrefix.length))\n  }\n\n  return {\n    text: result.join('\\n'),\n    processed: shouldUndoUnorderedList\n  }\n}\n\n/**\n * Make prefix for list item\n */\nfunction makePrefix(index, unorderedList) {\n  if (unorderedList) {\n    return '- '\n  } else {\n    return `${index + 1}. `\n  }\n}\n\n/**\n * Clear existing list style\n */\nfunction clearExistingListStyle(style, selectedText) {\n  let undoResult\n  let undoResultOppositeList\n  let pristineText\n  \n  if (style.orderedList) {\n    undoResult = undoOrderedListStyle(selectedText)\n    undoResultOppositeList = undoUnorderedListStyle(undoResult.text)\n    pristineText = undoResultOppositeList.text\n  } else {\n    undoResult = undoUnorderedListStyle(selectedText)\n    undoResultOppositeList = undoOrderedListStyle(undoResult.text)\n    pristineText = undoResultOppositeList.text\n  }\n  \n  return [undoResult, undoResultOppositeList, pristineText]\n}\n\n/**\n * Apply list styling to selected text\n */\nexport function listStyle(textarea, style) {\n  const noInitialSelection = textarea.selectionStart === textarea.selectionEnd\n  let selectionStart = textarea.selectionStart\n  let selectionEnd = textarea.selectionEnd\n\n  // Select whole line\n  expandSelectionToLine(textarea)\n\n  const selectedText = textarea.value.slice(textarea.selectionStart, textarea.selectionEnd)\n\n  // Clear any existing list formatting\n  const [undoResult, undoResultOppositeList, pristineText] = clearExistingListStyle(style, selectedText)\n\n  const prefixedLines = pristineText.split('\\n').map((value, index) => {\n    return `${makePrefix(index, style.unorderedList)}${value}`\n  })\n\n  const totalPrefixLength = prefixedLines.reduce((previousValue, _currentValue, currentIndex) => {\n    return previousValue + makePrefix(currentIndex, style.unorderedList).length\n  }, 0)\n\n  const totalPrefixLengthOppositeList = prefixedLines.reduce((previousValue, _currentValue, currentIndex) => {\n    return previousValue + makePrefix(currentIndex, !style.unorderedList).length\n  }, 0)\n\n  // If we're undoing the same list type, just return the pristine text\n  if (undoResult.processed) {\n    if (noInitialSelection) {\n      selectionStart = Math.max(selectionStart - makePrefix(0, style.unorderedList).length, 0)\n      selectionEnd = selectionStart\n    } else {\n      selectionStart = textarea.selectionStart\n      selectionEnd = textarea.selectionEnd - totalPrefixLength\n    }\n    return { text: pristineText, selectionStart, selectionEnd }\n  }\n\n  // Apply new list formatting\n  const { newlinesToAppend, newlinesToPrepend } = newlinesToSurroundSelectedText(textarea)\n  const text = newlinesToAppend + prefixedLines.join('\\n') + newlinesToPrepend\n\n  if (noInitialSelection) {\n    selectionStart = Math.max(selectionStart + makePrefix(0, style.unorderedList).length + newlinesToAppend.length, 0)\n    selectionEnd = selectionStart\n  } else {\n    if (undoResultOppositeList.processed) {\n      // Converting from one list type to another\n      selectionStart = Math.max(textarea.selectionStart + newlinesToAppend.length, 0)\n      selectionEnd = textarea.selectionEnd + newlinesToAppend.length + totalPrefixLength - totalPrefixLengthOppositeList\n    } else {\n      // Adding list formatting to plain text\n      selectionStart = Math.max(textarea.selectionStart + newlinesToAppend.length, 0)\n      selectionEnd = textarea.selectionEnd + newlinesToAppend.length + totalPrefixLength\n    }\n  }\n\n  return { text, selectionStart, selectionEnd }\n}\n\n/**\n * Apply list style to textarea\n */\nexport function applyListStyle(textarea, style) {\n  // Use applyLineOperation for consistent selection preservation\n  const result = applyLineOperation(\n    textarea,\n    (ta) => listStyle(ta, style),\n    {\n      // Custom selection adjustment for lists\n      adjustSelection: (isRemoving, selStart, selEnd, lineStart) => {\n        // Get the current line to check if we're removing\n        const currentLine = textarea.value.slice(lineStart, textarea.selectionEnd)\n        const orderedListRegex = /^\\d+\\.\\s+/\n        const unorderedListRegex = /^- /\n        \n        // Check if we're removing a list\n        const hasOrderedList = orderedListRegex.test(currentLine)\n        const hasUnorderedList = unorderedListRegex.test(currentLine)\n        const isRemovingCurrent = (style.orderedList && hasOrderedList) || (style.unorderedList && hasUnorderedList)\n        \n        if (selStart === selEnd) {\n          // No selection - cursor position\n          if (isRemovingCurrent) {\n            // Removing list - adjust cursor back\n            const prefixMatch = currentLine.match(style.orderedList ? orderedListRegex : unorderedListRegex)\n            const prefixLength = prefixMatch ? prefixMatch[0].length : 0\n            return {\n              start: Math.max(selStart - prefixLength, lineStart),\n              end: Math.max(selStart - prefixLength, lineStart)\n            }\n          } else if (hasOrderedList || hasUnorderedList) {\n            // Converting from one list type to another\n            const oldPrefixMatch = currentLine.match(hasOrderedList ? orderedListRegex : unorderedListRegex)\n            const oldPrefixLength = oldPrefixMatch ? oldPrefixMatch[0].length : 0\n            const newPrefixLength = style.unorderedList ? 2 : 3 // \"- \" or \"1. \"\n            const adjustment = newPrefixLength - oldPrefixLength\n            return {\n              start: selStart + adjustment,\n              end: selStart + adjustment\n            }\n          } else {\n            // Adding new list\n            const prefixLength = style.unorderedList ? 2 : 3 // \"- \" or \"1. \"\n            return {\n              start: selStart + prefixLength,\n              end: selStart + prefixLength\n            }\n          }\n        } else {\n          // Has selection - preserve it\n          if (isRemovingCurrent) {\n            // Removing current list type\n            const prefixMatch = currentLine.match(style.orderedList ? orderedListRegex : unorderedListRegex)\n            const prefixLength = prefixMatch ? prefixMatch[0].length : 0\n            return {\n              start: Math.max(selStart - prefixLength, lineStart),\n              end: Math.max(selEnd - prefixLength, lineStart)\n            }\n          } else if (hasOrderedList || hasUnorderedList) {\n            // Converting from one list type to another\n            const oldPrefixMatch = currentLine.match(hasOrderedList ? orderedListRegex : unorderedListRegex)\n            const oldPrefixLength = oldPrefixMatch ? oldPrefixMatch[0].length : 0\n            const newPrefixLength = style.unorderedList ? 2 : 3 // \"- \" or \"1. \"\n            const adjustment = newPrefixLength - oldPrefixLength\n            return {\n              start: selStart + adjustment,\n              end: selEnd + adjustment\n            }\n          } else {\n            // Adding new list\n            const prefixLength = style.unorderedList ? 2 : 3 // \"- \" or \"1. \"\n            return {\n              start: selStart + prefixLength,\n              end: selEnd + prefixLength\n            }\n          }\n        }\n      }\n    }\n  )\n  \n  insertText(textarea, result)\n}", "/**\n * Format detection utilities\n */\n\nimport { FORMATS } from './formats.js'\n\n/**\n * Check if text has a specific format applied\n */\nfunction hasFormatApplied(text, format) {\n  if (!format.prefix) return false\n  \n  if (format.suffix) {\n    return text.startsWith(format.prefix) && text.endsWith(format.suffix)\n  } else {\n    return text.startsWith(format.prefix)\n  }\n}\n\n/**\n * Get active formats at cursor position\n */\nexport function getActiveFormats(textarea) {\n  if (!textarea) return []\n  \n  const formats = []\n  const { selectionStart, selectionEnd, value } = textarea\n  \n  // Get current line for line-based formats\n  const lines = value.split('\\n')\n  let lineStart = 0\n  let currentLine = ''\n  \n  for (const line of lines) {\n    if (selectionStart >= lineStart && selectionStart <= lineStart + line.length) {\n      currentLine = line\n      break\n    }\n    lineStart += line.length + 1\n  }\n  \n  // Check line-based formats\n  if (currentLine.startsWith('- ')) {\n    if (currentLine.startsWith('- [ ] ') || currentLine.startsWith('- [x] ')) {\n      formats.push('task-list')\n    } else {\n      formats.push('bullet-list')\n    }\n  }\n  \n  if (/^\\d+\\.\\s/.test(currentLine)) {\n    formats.push('numbered-list')\n  }\n  \n  if (currentLine.startsWith('> ')) {\n    formats.push('quote')\n  }\n  \n  if (currentLine.startsWith('# ')) formats.push('header')\n  if (currentLine.startsWith('## ')) formats.push('header-2')\n  if (currentLine.startsWith('### ')) formats.push('header-3')\n  \n  // Check inline formats by looking around cursor\n  const lookBehind = Math.max(0, selectionStart - 10)\n  const lookAhead = Math.min(value.length, selectionEnd + 10)\n  const surrounding = value.slice(lookBehind, lookAhead)\n  \n  // Check for bold\n  if (surrounding.includes('**')) {\n    const beforeCursor = value.slice(Math.max(0, selectionStart - 100), selectionStart)\n    const afterCursor = value.slice(selectionEnd, Math.min(value.length, selectionEnd + 100))\n    const lastOpenBold = beforeCursor.lastIndexOf('**')\n    const nextCloseBold = afterCursor.indexOf('**')\n    if (lastOpenBold !== -1 && nextCloseBold !== -1) {\n      formats.push('bold')\n    }\n  }\n  \n  // Check for italic\n  if (surrounding.includes('_')) {\n    const beforeCursor = value.slice(Math.max(0, selectionStart - 100), selectionStart)\n    const afterCursor = value.slice(selectionEnd, Math.min(value.length, selectionEnd + 100))\n    const lastOpenItalic = beforeCursor.lastIndexOf('_')\n    const nextCloseItalic = afterCursor.indexOf('_')\n    if (lastOpenItalic !== -1 && nextCloseItalic !== -1) {\n      formats.push('italic')\n    }\n  }\n  \n  // Check for code\n  if (surrounding.includes('`')) {\n    const beforeCursor = value.slice(Math.max(0, selectionStart - 100), selectionStart)\n    const afterCursor = value.slice(selectionEnd, Math.min(value.length, selectionEnd + 100))\n    if (beforeCursor.includes('`') && afterCursor.includes('`')) {\n      formats.push('code')\n    }\n  }\n  \n  // Check for link\n  if (surrounding.includes('[') && surrounding.includes(']')) {\n    const beforeCursor = value.slice(Math.max(0, selectionStart - 100), selectionStart)\n    const afterCursor = value.slice(selectionEnd, Math.min(value.length, selectionEnd + 100))\n    const lastOpenBracket = beforeCursor.lastIndexOf('[')\n    const nextCloseBracket = afterCursor.indexOf(']')\n    if (lastOpenBracket !== -1 && nextCloseBracket !== -1) {\n      const afterBracket = value.slice(selectionEnd + nextCloseBracket + 1, selectionEnd + nextCloseBracket + 10)\n      if (afterBracket.startsWith('(')) {\n        formats.push('link')\n      }\n    }\n  }\n  \n  return formats\n}\n\n/**\n * Check if specific format is active at cursor\n */\nexport function hasFormat(textarea, format) {\n  const activeFormats = getActiveFormats(textarea)\n  return activeFormats.includes(format)\n}\n\n/**\n * Expand selection based on options\n */\nexport function expandSelection(textarea, options = {}) {\n  if (!textarea) return\n  \n  const { toWord, toLine, toFormat } = options\n  const { selectionStart, selectionEnd, value } = textarea\n  \n  if (toLine) {\n    // Find line boundaries\n    const lines = value.split('\\n')\n    let lineStart = 0\n    let lineEnd = 0\n    let currentPos = 0\n    \n    for (const line of lines) {\n      if (selectionStart >= currentPos && selectionStart <= currentPos + line.length) {\n        lineStart = currentPos\n        lineEnd = currentPos + line.length\n        break\n      }\n      currentPos += line.length + 1\n    }\n    \n    textarea.selectionStart = lineStart\n    textarea.selectionEnd = lineEnd\n  } else if (toWord && selectionStart === selectionEnd) {\n    // Find word boundaries\n    let start = selectionStart\n    let end = selectionEnd\n    \n    // Move start back to word boundary\n    while (start > 0 && !/\\s/.test(value[start - 1])) {\n      start--\n    }\n    \n    // Move end forward to word boundary\n    while (end < value.length && !/\\s/.test(value[end])) {\n      end++\n    }\n    \n    textarea.selectionStart = start\n    textarea.selectionEnd = end\n  }\n}", "/**\n * markdown-actions - Lightweight markdown toolbar functionality\n * Based on GitHub's markdown-toolbar-element\n */\n\nimport { FORMATS, mergeWithDefaults } from './core/formats.js'\nimport { insertText, setUndoMethod } from './core/insertion.js'\nimport { preserveSelection, isMultipleLines, expandSelectionToLine, applyLineOperation } from './core/selection.js'\nimport { blockStyle, multilineStyle } from './operations/block.js'\nimport { applyListStyle } from './operations/list.js'\nimport { getActiveFormats as getActive, hasFormat as has, expandSelection as expand } from './core/detection.js'\nimport { debugLog, debugSelection, debugResult, setDebugMode, getDebugMode } from './debug.js'\n\n/**\n * Toggle bold formatting\n */\nexport function toggleBold(textarea) {\n  if (!textarea || textarea.disabled || textarea.readOnly) return\n  \n  debugLog('toggleBold', 'Starting');\n  debugSelection(textarea, 'Before');\n  \n  const style = mergeWithDefaults(FORMATS.bold)\n  const result = blockStyle(textarea, style)\n  \n  debugResult(result);\n  \n  insertText(textarea, result)\n  \n  debugSelection(textarea, 'After');\n}\n\n/**\n * Toggle italic formatting\n */\nexport function toggleItalic(textarea) {\n  if (!textarea || textarea.disabled || textarea.readOnly) return\n  const style = mergeWithDefaults(FORMATS.italic)\n  const result = blockStyle(textarea, style)\n  insertText(textarea, result)\n}\n\n/**\n * Toggle code formatting\n */\nexport function toggleCode(textarea) {\n  if (!textarea || textarea.disabled || textarea.readOnly) return\n  \n  // blockStyle already handles both inline and block code correctly\n  const style = mergeWithDefaults(FORMATS.code)\n  const result = blockStyle(textarea, style)\n  insertText(textarea, result)\n}\n\n/**\n * Insert or toggle link formatting\n */\nexport function insertLink(textarea, options = {}) {\n  if (!textarea || textarea.disabled || textarea.readOnly) return\n  \n  const selectedText = textarea.value.slice(textarea.selectionStart, textarea.selectionEnd)\n  let style = mergeWithDefaults(FORMATS.link)\n  \n  // Check if selected text is a URL\n  const isURL = selectedText && selectedText.match(/^https?:\\/\\//)\n  \n  if (isURL && !options.url) {\n    // If selected text is a URL, use it as both link text and URL\n    style.suffix = `](${selectedText})`\n    style.replaceNext = ''\n    // Don't change the selected text, it becomes the link text\n  } else if (options.url) {\n    // Override with custom URL if provided\n    style.suffix = `](${options.url})`\n    style.replaceNext = ''\n  }\n  \n  // Override with custom text if provided\n  if (options.text && !selectedText) {\n    // Insert the text and select it\n    const pos = textarea.selectionStart\n    textarea.value = textarea.value.slice(0, pos) + options.text + textarea.value.slice(pos)\n    textarea.selectionStart = pos\n    textarea.selectionEnd = pos + options.text.length\n  }\n  \n  const result = blockStyle(textarea, style)\n  insertText(textarea, result)\n}\n\n/**\n * Toggle bullet list formatting\n */\nexport function toggleBulletList(textarea) {\n  if (!textarea || textarea.disabled || textarea.readOnly) return\n  const style = mergeWithDefaults(FORMATS.bulletList)\n  applyListStyle(textarea, style)\n}\n\n/**\n * Toggle numbered list formatting\n */\nexport function toggleNumberedList(textarea) {\n  if (!textarea || textarea.disabled || textarea.readOnly) return\n  const style = mergeWithDefaults(FORMATS.numberedList)\n  applyListStyle(textarea, style)\n}\n\n/**\n * Toggle quote formatting\n * Matches GitHub's implementation for quotes\n */\nexport function toggleQuote(textarea) {\n  if (!textarea || textarea.disabled || textarea.readOnly) return\n  \n  debugLog('toggleQuote', 'Starting');\n  debugSelection(textarea, 'Initial');\n  \n  const style = mergeWithDefaults(FORMATS.quote)\n  \n  // Use the reusable line operation helper\n  const result = applyLineOperation(\n    textarea,\n    (ta) => multilineStyle(ta, style),\n    { prefix: style.prefix }\n  )\n  \n  debugResult(result);\n  insertText(textarea, result)\n  debugSelection(textarea, 'Final');\n}\n\n/**\n * Toggle task list formatting\n * Matches GitHub's implementation for task lists\n */\nexport function toggleTaskList(textarea) {\n  if (!textarea || textarea.disabled || textarea.readOnly) return\n  \n  const style = mergeWithDefaults(FORMATS.taskList)\n  \n  // Use the reusable line operation helper\n  const result = applyLineOperation(\n    textarea,\n    (ta) => multilineStyle(ta, style),\n    { prefix: style.prefix }\n  )\n  \n  insertText(textarea, result)\n}\n\n/**\n * Insert or toggle header with specific level\n */\nexport function insertHeader(textarea, level = 1, toggle = false) {\n  if (!textarea || textarea.disabled || textarea.readOnly) return\n  if (level < 1 || level > 6) level = 1\n  \n  debugLog('insertHeader', `============ START ============`);\n  debugLog('insertHeader', `Level: ${level}, Toggle: ${toggle}`);\n  debugLog('insertHeader', `Initial cursor: ${textarea.selectionStart}-${textarea.selectionEnd}`);\n  \n  const headerKey = `header${level === 1 ? '1' : level}`\n  const style = mergeWithDefaults(FORMATS[headerKey] || FORMATS.header1)\n  debugLog('insertHeader', `Style prefix: \"${style.prefix}\"`);\n  \n  // Save original positions and get line info BEFORE applyLineOperation\n  const value = textarea.value\n  const originalStart = textarea.selectionStart\n  const originalEnd = textarea.selectionEnd\n  \n  // Find the current line boundaries to check existing header\n  let lineStart = originalStart\n  while (lineStart > 0 && value[lineStart - 1] !== '\\n') {\n    lineStart--\n  }\n  let lineEnd = originalEnd\n  while (lineEnd < value.length && value[lineEnd] !== '\\n') {\n    lineEnd++\n  }\n  \n  // Get current line and check for existing header\n  const currentLineContent = value.slice(lineStart, lineEnd)\n  debugLog('insertHeader', `Current line (before): \"${currentLineContent}\"`);\n  \n  const existingHeaderMatch = currentLineContent.match(/^(#{1,6})\\s*/)\n  const existingLevel = existingHeaderMatch ? existingHeaderMatch[1].length : 0\n  const existingPrefixLength = existingHeaderMatch ? existingHeaderMatch[0].length : 0\n  \n  debugLog('insertHeader', `Existing header check:`);\n  debugLog('insertHeader', `  - Match: ${existingHeaderMatch ? `\"${existingHeaderMatch[0]}\"` : 'none'}`);\n  debugLog('insertHeader', `  - Existing level: ${existingLevel}`);\n  debugLog('insertHeader', `  - Existing prefix length: ${existingPrefixLength}`);\n  debugLog('insertHeader', `  - Target level: ${level}`);\n  \n  // Determine if we're toggling off\n  const shouldToggleOff = toggle && existingLevel === level\n  debugLog('insertHeader', `Should toggle OFF: ${shouldToggleOff} (toggle=${toggle}, existingLevel=${existingLevel}, level=${level})`);\n  \n  // Use applyLineOperation for consistent behavior\n  const result = applyLineOperation(\n    textarea,\n    (ta) => {\n      const currentLine = ta.value.slice(ta.selectionStart, ta.selectionEnd)\n      debugLog('insertHeader', `Line in operation: \"${currentLine}\"`);\n      \n      // Remove any existing header formatting\n      const cleanedLine = currentLine.replace(/^#{1,6}\\s*/, '')\n      debugLog('insertHeader', `Cleaned line: \"${cleanedLine}\"`);\n      \n      let newLine\n      \n      if (shouldToggleOff) {\n        // Toggle off - just use the cleaned line\n        debugLog('insertHeader', 'ACTION: Toggling OFF - removing header');\n        newLine = cleanedLine\n      } else if (existingLevel > 0) {\n        // Replace existing header with new one\n        debugLog('insertHeader', `ACTION: Replacing H${existingLevel} with H${level}`);\n        newLine = style.prefix + cleanedLine\n      } else {\n        // Add new header\n        debugLog('insertHeader', 'ACTION: Adding new header');\n        newLine = style.prefix + cleanedLine\n      }\n      \n      debugLog('insertHeader', `New line: \"${newLine}\"`);\n      \n      return {\n        text: newLine,\n        selectionStart: ta.selectionStart,\n        selectionEnd: ta.selectionEnd\n      }\n    },\n    {\n      prefix: style.prefix,\n      // Custom selection adjustment for headers\n      adjustSelection: (isRemoving, selStart, selEnd, lineStartPos) => {\n        debugLog('insertHeader', `Adjusting selection:`);\n        debugLog('insertHeader', `  - isRemoving param: ${isRemoving}`);\n        debugLog('insertHeader', `  - shouldToggleOff: ${shouldToggleOff}`);\n        debugLog('insertHeader', `  - selStart: ${selStart}, selEnd: ${selEnd}`);\n        debugLog('insertHeader', `  - lineStartPos: ${lineStartPos}`);\n        \n        if (shouldToggleOff) {\n          // Removing the header entirely\n          const adjustment = Math.max(selStart - existingPrefixLength, lineStartPos)\n          debugLog('insertHeader', `  - Removing header, adjusting by -${existingPrefixLength}`);\n          return {\n            start: adjustment,\n            end: selStart === selEnd ? adjustment : Math.max(selEnd - existingPrefixLength, lineStartPos)\n          }\n        } else if (existingPrefixLength > 0) {\n          // Replacing existing header with new one\n          const prefixDiff = style.prefix.length - existingPrefixLength\n          debugLog('insertHeader', `  - Replacing header, adjusting by ${prefixDiff}`);\n          return {\n            start: selStart + prefixDiff,\n            end: selEnd + prefixDiff\n          }\n        } else {\n          // Adding new header\n          debugLog('insertHeader', `  - Adding header, adjusting by +${style.prefix.length}`);\n          return {\n            start: selStart + style.prefix.length,\n            end: selEnd + style.prefix.length\n          }\n        }\n      }\n    }\n  )\n  \n  debugLog('insertHeader', `Final result: text=\"${result.text}\", cursor=${result.selectionStart}-${result.selectionEnd}`);\n  debugLog('insertHeader', `============ END ============`);\n  \n  insertText(textarea, result)\n}\n\n/**\n * Toggle H1 header\n */\nexport function toggleH1(textarea) {\n  insertHeader(textarea, 1, true)\n}\n\n/**\n * Toggle H2 header\n */\nexport function toggleH2(textarea) {\n  insertHeader(textarea, 2, true)\n}\n\n/**\n * Toggle H3 header\n */\nexport function toggleH3(textarea) {\n  insertHeader(textarea, 3, true)\n}\n\n/**\n * Get active formats at cursor position\n */\nexport function getActiveFormats(textarea) {\n  return getActive(textarea)\n}\n\n/**\n * Check if format is active at cursor\n */\nexport function hasFormat(textarea, format) {\n  return has(textarea, format)\n}\n\n/**\n * Expand selection based on options\n */\nexport function expandSelection(textarea, options = {}) {\n  expand(textarea, options)\n}\n\n/**\n * Apply custom format\n */\nexport function applyCustomFormat(textarea, format) {\n  if (!textarea || textarea.disabled || textarea.readOnly) return\n  \n  const style = mergeWithDefaults(format)\n  let result\n  \n  if (style.multiline) {\n    const selectedText = textarea.value.slice(textarea.selectionStart, textarea.selectionEnd)\n    if (isMultipleLines(selectedText)) {\n      result = multilineStyle(textarea, style)\n    } else {\n      result = blockStyle(textarea, style)\n    }\n  } else {\n    result = blockStyle(textarea, style)\n  }\n  \n  insertText(textarea, result)\n}\n\n/**\n * Preserve selection during callback\n */\nexport { preserveSelection }\n\n/**\n * Configure undo method\n */\nexport { setUndoMethod }\n\n/**\n * Debug mode control\n */\nexport { setDebugMode, getDebugMode }\n\n/**\n * Default export with all functions\n */\nexport default {\n  toggleBold,\n  toggleItalic,\n  toggleCode,\n  insertLink,\n  toggleBulletList,\n  toggleNumberedList,\n  toggleQuote,\n  toggleTaskList,\n  insertHeader,\n  toggleH1,\n  toggleH2,\n  toggleH3,\n  getActiveFormats,\n  hasFormat,\n  expandSelection,\n  applyCustomFormat,\n  preserveSelection,\n  setUndoMethod,\n  setDebugMode,\n  getDebugMode\n}", "/**\r\n * Toolbar component for OverType editor\r\n * Provides markdown formatting buttons with support for custom buttons\r\n */\r\n\r\nimport * as markdownActions from 'markdown-actions';\r\n\r\nexport class Toolbar {\r\n  constructor(editor, options = {}) {\r\n    this.editor = editor;\r\n    this.container = null;\r\n    this.buttons = {};\r\n\r\n    // Get toolbar buttons array\r\n    this.toolbarButtons = options.toolbarButtons || [];\r\n  }\r\n\r\n  /**\r\n   * Create and render toolbar\r\n   */\r\n  create() {\r\n    this.container = document.createElement('div');\r\n    this.container.className = 'overtype-toolbar';\r\n    this.container.setAttribute('role', 'toolbar');\r\n    this.container.setAttribute('aria-label', 'Formatting toolbar');\r\n\r\n    // Create buttons from toolbarButtons array\r\n    this.toolbarButtons.forEach(buttonConfig => {\r\n      if (buttonConfig.name === 'separator') {\r\n        const separator = this.createSeparator();\r\n        this.container.appendChild(separator);\r\n      } else {\r\n        const button = this.createButton(buttonConfig);\r\n        this.buttons[buttonConfig.name] = button;\r\n        this.container.appendChild(button);\r\n      }\r\n    });\r\n\r\n    // Insert toolbar before the wrapper (as sibling, not child)\r\n    this.editor.container.insertBefore(this.container, this.editor.wrapper);\r\n  }\r\n\r\n  /**\r\n   * Create a toolbar separator\r\n   */\r\n  createSeparator() {\r\n    const separator = document.createElement('div');\r\n    separator.className = 'overtype-toolbar-separator';\r\n    separator.setAttribute('role', 'separator');\r\n    return separator;\r\n  }\r\n\r\n  /**\r\n   * Create a toolbar button\r\n   */\r\n  createButton(buttonConfig) {\r\n    const button = document.createElement('button');\r\n    button.className = 'overtype-toolbar-button';\r\n    button.type = 'button';\r\n    button.setAttribute('data-button', buttonConfig.name);\r\n    button.title = buttonConfig.title || '';\r\n    button.setAttribute('aria-label', buttonConfig.title || buttonConfig.name);\r\n    button.innerHTML = this.sanitizeSVG(buttonConfig.icon || '');\r\n\r\n    // Special handling for viewMode dropdown\r\n    if (buttonConfig.name === 'viewMode') {\r\n      button.classList.add('has-dropdown');\r\n      button.dataset.dropdown = 'true';\r\n      button.addEventListener('click', (e) => {\r\n        e.preventDefault();\r\n        this.toggleViewModeDropdown(button);\r\n      });\r\n      return button;\r\n    }\r\n\r\n    // Standard button click handler - delegate to performAction\r\n    button._clickHandler = (e) => {\r\n      e.preventDefault();\r\n      const actionId = buttonConfig.actionId || buttonConfig.name;\r\n      this.editor.performAction(actionId, e);\r\n    };\r\n\r\n    button.addEventListener('click', button._clickHandler);\r\n    return button;\r\n  }\r\n\r\n  /**\r\n   * Handle button action programmatically\r\n   * Accepts either an actionId string or a buttonConfig object (backwards compatible)\r\n   * @param {string|Object} actionIdOrConfig - Action identifier string or button config object\r\n   * @returns {Promise<boolean>} Whether the action was executed\r\n   */\r\n  async handleAction(actionIdOrConfig) {\r\n    // Old style: buttonConfig object with .action function - execute directly\r\n    if (actionIdOrConfig && typeof actionIdOrConfig === 'object' && typeof actionIdOrConfig.action === 'function') {\r\n      this.editor.textarea.focus();\r\n      try {\r\n        await actionIdOrConfig.action({\r\n          editor: this.editor,\r\n          getValue: () => this.editor.getValue(),\r\n          setValue: (value) => this.editor.setValue(value),\r\n          event: null\r\n        });\r\n        return true;\r\n      } catch (error) {\r\n        console.error(`Action \"${actionIdOrConfig.name}\" error:`, error);\r\n        this.editor.wrapper.dispatchEvent(new CustomEvent('button-error', {\r\n          detail: { buttonName: actionIdOrConfig.name, error }\r\n        }));\r\n        return false;\r\n      }\r\n    }\r\n\r\n    // New style: string actionId - delegate to performAction\r\n    if (typeof actionIdOrConfig === 'string') {\r\n      return this.editor.performAction(actionIdOrConfig, null);\r\n    }\r\n\r\n    return false;\r\n  }\r\n\r\n  /**\r\n   * Sanitize SVG to prevent XSS\r\n   */\r\n  sanitizeSVG(svg) {\r\n    if (typeof svg !== 'string') return '';\r\n\r\n    // Remove script tags and on* event handlers\r\n    const cleaned = svg\r\n      .replace(/<script\\b[^<]*(?:(?!<\\/script>)<[^<]*)*<\\/script>/gi, '')\r\n      .replace(/\\son\\w+\\s*=\\s*[\"'][^\"']*[\"']/gi, '')\r\n      .replace(/\\son\\w+\\s*=\\s*[^\\s>]*/gi, '');\r\n\r\n    return cleaned;\r\n  }\r\n\r\n  /**\r\n   * Toggle view mode dropdown (internal implementation)\r\n   * Not exposed to users - viewMode button behavior is fixed\r\n   */\r\n  toggleViewModeDropdown(button) {\r\n    // Close any existing dropdown\r\n    const existingDropdown = document.querySelector('.overtype-dropdown-menu');\r\n    if (existingDropdown) {\r\n      existingDropdown.remove();\r\n      button.classList.remove('dropdown-active');\r\n      return;\r\n    }\r\n\r\n    button.classList.add('dropdown-active');\r\n\r\n    const dropdown = this.createViewModeDropdown(button);\r\n\r\n    // Position dropdown relative to button\r\n    const rect = button.getBoundingClientRect();\r\n    dropdown.style.position = 'absolute';\r\n    dropdown.style.top = `${rect.bottom + 5}px`;\r\n    dropdown.style.left = `${rect.left}px`;\r\n\r\n    document.body.appendChild(dropdown);\r\n\r\n    // Click outside to close\r\n    this.handleDocumentClick = (e) => {\r\n      if (!dropdown.contains(e.target) && !button.contains(e.target)) {\r\n        dropdown.remove();\r\n        button.classList.remove('dropdown-active');\r\n        document.removeEventListener('click', this.handleDocumentClick);\r\n      }\r\n    };\r\n\r\n    setTimeout(() => {\r\n      document.addEventListener('click', this.handleDocumentClick);\r\n    }, 0);\r\n  }\r\n\r\n  /**\r\n   * Create view mode dropdown menu (internal implementation)\r\n   */\r\n  createViewModeDropdown(button) {\r\n    const dropdown = document.createElement('div');\r\n    dropdown.className = 'overtype-dropdown-menu';\r\n\r\n    const items = [\r\n      { id: 'normal', label: 'Normal Edit', icon: '\u2713' },\r\n      { id: 'plain', label: 'Plain Textarea', icon: '\u2713' },\r\n      { id: 'preview', label: 'Preview Mode', icon: '\u2713' }\r\n    ];\r\n\r\n    const currentMode = this.editor.container.dataset.mode || 'normal';\r\n\r\n    items.forEach(item => {\r\n      const menuItem = document.createElement('button');\r\n      menuItem.className = 'overtype-dropdown-item';\r\n      menuItem.type = 'button';\r\n      menuItem.textContent = item.label;\r\n\r\n      if (item.id === currentMode) {\r\n        menuItem.classList.add('active');\r\n        menuItem.setAttribute('aria-current', 'true');\r\n        const checkmark = document.createElement('span');\r\n        checkmark.className = 'overtype-dropdown-icon';\r\n        checkmark.textContent = item.icon;\r\n        menuItem.prepend(checkmark);\r\n      }\r\n\r\n      menuItem.addEventListener('click', (e) => {\r\n        e.preventDefault();\r\n\r\n        // Handle view mode changes\r\n        switch(item.id) {\r\n          case 'plain':\r\n            this.editor.showPlainTextarea();\r\n            break;\r\n          case 'preview':\r\n            this.editor.showPreviewMode();\r\n            break;\r\n          case 'normal':\r\n          default:\r\n            this.editor.showNormalEditMode();\r\n            break;\r\n        }\r\n\r\n        dropdown.remove();\r\n        button.classList.remove('dropdown-active');\r\n        document.removeEventListener('click', this.handleDocumentClick);\r\n      });\r\n\r\n      dropdown.appendChild(menuItem);\r\n    });\r\n\r\n    return dropdown;\r\n  }\r\n\r\n  /**\r\n   * Update active states of toolbar buttons\r\n   */\r\n  updateButtonStates() {\r\n    try {\r\n      const activeFormats = markdownActions.getActiveFormats?.(\r\n        this.editor.textarea,\r\n        this.editor.textarea.selectionStart\r\n      ) || [];\r\n\r\n      Object.entries(this.buttons).forEach(([name, button]) => {\r\n        if (name === 'viewMode') return; // Skip dropdown button\r\n\r\n        let isActive = false;\r\n\r\n        switch(name) {\r\n          case 'bold':\r\n            isActive = activeFormats.includes('bold');\r\n            break;\r\n          case 'italic':\r\n            isActive = activeFormats.includes('italic');\r\n            break;\r\n          case 'code':\r\n            isActive = false; // Disabled: unreliable in code blocks\r\n            break;\r\n          case 'bulletList':\r\n            isActive = activeFormats.includes('bullet-list');\r\n            break;\r\n          case 'orderedList':\r\n            isActive = activeFormats.includes('numbered-list');\r\n            break;\r\n          case 'taskList':\r\n            isActive = activeFormats.includes('task-list');\r\n            break;\r\n          case 'quote':\r\n            isActive = activeFormats.includes('quote');\r\n            break;\r\n          case 'h1':\r\n            isActive = activeFormats.includes('header');\r\n            break;\r\n          case 'h2':\r\n            isActive = activeFormats.includes('header-2');\r\n            break;\r\n          case 'h3':\r\n            isActive = activeFormats.includes('header-3');\r\n            break;\r\n        }\r\n\r\n        button.classList.toggle('active', isActive);\r\n        button.setAttribute('aria-pressed', isActive.toString());\r\n      });\r\n    } catch (error) {\r\n      // Silently fail if markdown-actions not available\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Destroy toolbar and cleanup\r\n   */\r\n  destroy() {\r\n    if (this.container) {\r\n      // Clean up event listeners\r\n      if (this.handleDocumentClick) {\r\n        document.removeEventListener('click', this.handleDocumentClick);\r\n      }\r\n\r\n      // Clean up button listeners\r\n      Object.values(this.buttons).forEach(button => {\r\n        if (button._clickHandler) {\r\n          button.removeEventListener('click', button._clickHandler);\r\n          delete button._clickHandler;\r\n        }\r\n      });\r\n\r\n      // Remove container\r\n      this.container.remove();\r\n      this.container = null;\r\n      this.buttons = {};\r\n    }\r\n  }\r\n}\r\n", "/**\r\n * Link Tooltip - CSS Anchor Positioning with Floating UI fallback\r\n * Shows a clickable tooltip when cursor is within a link\r\n * Uses CSS anchor positioning for modern browsers, Floating UI for older browsers\r\n */\r\n\r\nexport class LinkTooltip {\r\n  constructor(editor) {\r\n    this.editor = editor;\r\n    this.tooltip = null;\r\n    this.currentLink = null;\r\n    this.hideTimeout = null;\r\n    this.visibilityChangeHandler = null;\r\n    this.useFloatingUI = false;\r\n    this.floatingUI = null;\r\n    this.isTooltipHovered = false;\r\n\r\n    this.init();\r\n  }\r\n\r\n  async init() {\r\n    // Detect CSS anchor positioning support\r\n    const supportsAnchorPositioning = CSS.supports('position-anchor: --x') &&\r\n                                      CSS.supports('position-area: center');\r\n\r\n    // Load Floating UI if needed\r\n    if (!supportsAnchorPositioning) {\r\n      try {\r\n        // Use indirect eval to prevent bundler from processing the import\r\n        const importFn = new Function('url', 'return import(url)');\r\n        const { computePosition, offset, shift, flip } = await importFn(\r\n          'https://cdn.jsdelivr.net/npm/@floating-ui/dom@1.7.4/+esm'\r\n        );\r\n        this.floatingUI = { computePosition, offset, shift, flip };\r\n        this.useFloatingUI = true;\r\n      } catch (error) {\r\n        // If dynamic import fails, tooltips simply won't show\r\n        console.warn('Failed to load Floating UI fallback:', error);\r\n        this.floatingUI = null;\r\n        this.useFloatingUI = false;\r\n      }\r\n    }\r\n\r\n    // Create tooltip element\r\n    // Note: Styles are now in the main stylesheet (styles.js) with @supports wrapper\r\n    this.createTooltip();\r\n\r\n    // Listen for cursor position changes\r\n    this.editor.textarea.addEventListener('selectionchange', () => this.checkCursorPosition());\r\n    this.editor.textarea.addEventListener('keyup', e => {\r\n      if (e.key.includes('Arrow') || e.key === 'Home' || e.key === 'End') {\r\n        this.checkCursorPosition();\r\n      }\r\n    });\r\n\r\n    // Hide tooltip when typing\r\n    this.editor.textarea.addEventListener('input', () => this.hide());\r\n\r\n    // Reposition or hide tooltip when scrolling\r\n    this.editor.textarea.addEventListener('scroll', () => {\r\n      if (this.useFloatingUI && this.currentLink) {\r\n        // Reposition the tooltip for Floating UI\r\n        this.showWithFloatingUI(this.currentLink);\r\n      } else {\r\n        // Hide for CSS anchor positioning (native browser behavior handles this)\r\n        this.hide();\r\n      }\r\n    });\r\n\r\n    // Hide tooltip when textarea loses focus (unless hovering tooltip)\r\n    this.editor.textarea.addEventListener('blur', () => {\r\n      if (!this.isTooltipHovered) {\r\n        this.hide();\r\n      }\r\n    });\r\n\r\n    // Hide tooltip when page loses visibility (tab switch, minimize, etc.)\r\n    this.visibilityChangeHandler = () => {\r\n      if (document.hidden) {\r\n        this.hide();\r\n      }\r\n    };\r\n    document.addEventListener('visibilitychange', this.visibilityChangeHandler);\r\n\r\n    // Track hover state to prevent hiding when clicking tooltip\r\n    this.tooltip.addEventListener('mouseenter', () => {\r\n      this.isTooltipHovered = true;\r\n      this.cancelHide();\r\n    });\r\n    this.tooltip.addEventListener('mouseleave', () => {\r\n      this.isTooltipHovered = false;\r\n      this.scheduleHide();\r\n    });\r\n  }\r\n\r\n  createTooltip() {\r\n    // Create tooltip element\r\n    // Styles are now included in the main stylesheet (styles.js)\r\n    this.tooltip = document.createElement('div');\r\n    this.tooltip.className = 'overtype-link-tooltip';\r\n\r\n    // Add link icon and text container\r\n    this.tooltip.innerHTML = `\r\n      <span style=\"display: flex; align-items: center; gap: 6px;\">\r\n        <svg width=\"12\" height=\"12\" viewBox=\"0 0 20 20\" fill=\"currentColor\" style=\"flex-shrink: 0;\">\r\n          <path d=\"M11 3a1 1 0 100 2h2.586l-6.293 6.293a1 1 0 101.414 1.414L15 6.414V9a1 1 0 102 0V4a1 1 0 00-1-1h-5z\"></path>\r\n          <path d=\"M5 5a2 2 0 00-2 2v8a2 2 0 002 2h8a2 2 0 002-2v-3a1 1 0 10-2 0v3H5V7h3a1 1 0 000-2H5z\"></path>\r\n        </svg>\r\n        <span class=\"overtype-link-tooltip-url\"></span>\r\n      </span>\r\n    `;\r\n\r\n    // Click handler to open link\r\n    this.tooltip.addEventListener('click', e => {\r\n      e.preventDefault();\r\n      e.stopPropagation();\r\n      if (this.currentLink) {\r\n        window.open(this.currentLink.url, '_blank');\r\n        this.hide();\r\n      }\r\n    });\r\n\r\n    // Append tooltip to editor container\r\n    this.editor.container.appendChild(this.tooltip);\r\n  }\r\n\r\n  checkCursorPosition() {\r\n    const cursorPos = this.editor.textarea.selectionStart;\r\n    const text = this.editor.textarea.value;\r\n\r\n    // Find if cursor is within a markdown link\r\n    const linkInfo = this.findLinkAtPosition(text, cursorPos);\r\n\r\n    if (linkInfo) {\r\n      if (!this.currentLink || this.currentLink.url !== linkInfo.url || this.currentLink.index !== linkInfo.index) {\r\n        this.show(linkInfo);\r\n      }\r\n    } else {\r\n      this.scheduleHide();\r\n    }\r\n  }\r\n\r\n  findLinkAtPosition(text, position) {\r\n    // Regex to find markdown links: [text](url)\r\n    const linkRegex = /\\[([^\\]]+)\\]\\(([^)]+)\\)/g;\r\n    let match;\r\n    let linkIndex = 0;\r\n\r\n    while ((match = linkRegex.exec(text)) !== null) {\r\n      const start = match.index;\r\n      const end = match.index + match[0].length;\r\n\r\n      if (position >= start && position <= end) {\r\n        return {\r\n          text: match[1],\r\n          url: match[2],\r\n          index: linkIndex,\r\n          start: start,\r\n          end: end\r\n        };\r\n      }\r\n      linkIndex++;\r\n    }\r\n\r\n    return null;\r\n  }\r\n\r\n  show(linkInfo) {\r\n    this.currentLink = linkInfo;\r\n    this.cancelHide();\r\n\r\n    // Update tooltip content\r\n    const urlSpan = this.tooltip.querySelector('.overtype-link-tooltip-url');\r\n    urlSpan.textContent = linkInfo.url;\r\n\r\n    if (this.useFloatingUI) {\r\n      this.showWithFloatingUI(linkInfo);\r\n    } else {\r\n      this.showWithAnchorPositioning(linkInfo);\r\n    }\r\n\r\n    this.tooltip.classList.add('visible');\r\n  }\r\n\r\n  showWithAnchorPositioning(linkInfo) {\r\n    // Set the CSS variable to point to the correct anchor\r\n    this.tooltip.style.setProperty('--target-anchor', `--link-${linkInfo.index}`);\r\n  }\r\n\r\n  async showWithFloatingUI(linkInfo) {\r\n    // Find the <a> element in preview that corresponds to this link\r\n    const anchorElement = this.findAnchorElement(linkInfo.index);\r\n\r\n    if (!anchorElement) {\r\n      return;\r\n    }\r\n\r\n    // Check if anchor element is visible and in viewport\r\n    const rect = anchorElement.getBoundingClientRect();\r\n    if (rect.width === 0 || rect.height === 0) {\r\n      return;\r\n    }\r\n\r\n    try {\r\n      // Compute position using Floating UI\r\n      const { x, y } = await this.floatingUI.computePosition(\r\n        anchorElement,\r\n        this.tooltip,\r\n        {\r\n          placement: 'bottom',\r\n          middleware: [\r\n            this.floatingUI.offset(8),\r\n            this.floatingUI.shift({ padding: 8 }),\r\n            this.floatingUI.flip()\r\n          ]\r\n        }\r\n      );\r\n\r\n      // Apply position\r\n      Object.assign(this.tooltip.style, {\r\n        left: `${x}px`,\r\n        top: `${y}px`,\r\n        position: 'absolute'\r\n      });\r\n    } catch (error) {\r\n      // If Floating UI computation fails, don't show tooltip\r\n      console.warn('Floating UI positioning failed:', error);\r\n      return;\r\n    }\r\n  }\r\n\r\n  findAnchorElement(linkIndex) {\r\n    // Find the <a> element with the matching anchor-name style\r\n    const preview = this.editor.preview;\r\n    // Direct query for the specific link - more efficient than iterating\r\n    return preview.querySelector(`a[style*=\"--link-${linkIndex}\"]`);\r\n  }\r\n\r\n  hide() {\r\n    this.tooltip.classList.remove('visible');\r\n    this.currentLink = null;\r\n    this.isTooltipHovered = false;\r\n  }\r\n\r\n  scheduleHide() {\r\n    this.cancelHide();\r\n    this.hideTimeout = setTimeout(() => this.hide(), 300);\r\n  }\r\n\r\n  cancelHide() {\r\n    if (this.hideTimeout) {\r\n      clearTimeout(this.hideTimeout);\r\n      this.hideTimeout = null;\r\n    }\r\n  }\r\n\r\n  destroy() {\r\n    this.cancelHide();\r\n\r\n    // Remove visibility change listener\r\n    if (this.visibilityChangeHandler) {\r\n      document.removeEventListener('visibilitychange', this.visibilityChangeHandler);\r\n      this.visibilityChangeHandler = null;\r\n    }\r\n\r\n    if (this.tooltip && this.tooltip.parentNode) {\r\n      this.tooltip.parentNode.removeChild(this.tooltip);\r\n    }\r\n    this.tooltip = null;\r\n    this.currentLink = null;\r\n    this.floatingUI = null;\r\n    this.useFloatingUI = false;\r\n    this.isTooltipHovered = false;\r\n  }\r\n}\r\n", "/**\r\n * SVG icons for OverType toolbar\r\n * Quill-style icons with inline styles\r\n */\r\n\r\nexport const boldIcon = `<svg viewBox=\"0 0 18 18\">\r\n  <path stroke=\"currentColor\" fill=\"none\" stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M5,4H9.5A2.5,2.5,0,0,1,12,6.5v0A2.5,2.5,0,0,1,9.5,9H5A0,0,0,0,1,5,9V4A0,0,0,0,1,5,4Z\"></path>\r\n  <path stroke=\"currentColor\" fill=\"none\" stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M5,9h5.5A2.5,2.5,0,0,1,13,11.5v0A2.5,2.5,0,0,1,10.5,14H5a0,0,0,0,1,0,0V9A0,0,0,0,1,5,9Z\"></path>\r\n</svg>`;\r\n\r\nexport const italicIcon = `<svg viewBox=\"0 0 18 18\">\r\n  <line stroke=\"currentColor\" fill=\"none\" stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" x1=\"7\" x2=\"13\" y1=\"4\" y2=\"4\"></line>\r\n  <line stroke=\"currentColor\" fill=\"none\" stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" x1=\"5\" x2=\"11\" y1=\"14\" y2=\"14\"></line>\r\n  <line stroke=\"currentColor\" fill=\"none\" stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" x1=\"8\" x2=\"10\" y1=\"14\" y2=\"4\"></line>\r\n</svg>`;\r\n\r\nexport const h1Icon = `<svg viewBox=\"0 0 18 18\">\r\n  <path fill=\"currentColor\" d=\"M10,4V14a1,1,0,0,1-2,0V10H3v4a1,1,0,0,1-2,0V4A1,1,0,0,1,3,4V8H8V4a1,1,0,0,1,2,0Zm6.06787,9.209H14.98975V7.59863a.54085.54085,0,0,0-.605-.60547h-.62744a1.01119,1.01119,0,0,0-.748.29688L11.645,8.56641a.5435.5435,0,0,0-.022.8584l.28613.30762a.53861.53861,0,0,0,.84717.0332l.09912-.08789a1.2137,1.2137,0,0,0,.2417-.35254h.02246s-.01123.30859-.01123.60547V13.209H12.041a.54085.54085,0,0,0-.605.60547v.43945a.54085.54085,0,0,0,.605.60547h4.02686a.54085.54085,0,0,0,.605-.60547v-.43945A.54085.54085,0,0,0,16.06787,13.209Z\"></path>\r\n</svg>`;\r\n\r\nexport const h2Icon = `<svg viewBox=\"0 0 18 18\">\r\n  <path fill=\"currentColor\" d=\"M16.73975,13.81445v.43945a.54085.54085,0,0,1-.605.60547H11.855a.58392.58392,0,0,1-.64893-.60547V14.0127c0-2.90527,3.39941-3.42187,3.39941-4.55469a.77675.77675,0,0,0-.84717-.78125,1.17684,1.17684,0,0,0-.83594.38477c-.2749.26367-.561.374-.85791.13184l-.4292-.34082c-.30811-.24219-.38525-.51758-.1543-.81445a2.97155,2.97155,0,0,1,2.45361-1.17676,2.45393,2.45393,0,0,1,2.68408,2.40918c0,2.45312-3.1792,2.92676-3.27832,3.93848h2.79443A.54085.54085,0,0,1,16.73975,13.81445ZM9,3A.99974.99974,0,0,0,8,4V8H3V4A1,1,0,0,0,1,4V14a1,1,0,0,0,2,0V10H8v4a1,1,0,0,0,2,0V4A.99974.99974,0,0,0,9,3Z\"></path>\r\n</svg>`;\r\n\r\nexport const h3Icon = `<svg viewBox=\"0 0 18 18\">\r\n  <path fill=\"currentColor\" d=\"M16.65186,12.30664a2.6742,2.6742,0,0,1-2.915,2.68457,3.96592,3.96592,0,0,1-2.25537-.6709.56007.56007,0,0,1-.13232-.83594L11.64648,13c.209-.34082.48389-.36328.82471-.1543a2.32654,2.32654,0,0,0,1.12256.33008c.71484,0,1.12207-.35156,1.12207-.78125,0-.61523-.61621-.86816-1.46338-.86816H13.2085a.65159.65159,0,0,1-.68213-.41895l-.05518-.10937a.67114.67114,0,0,1,.14307-.78125l.71533-.86914a8.55289,8.55289,0,0,1,.68213-.7373V8.58887a3.93913,3.93913,0,0,1-.748.05469H11.9873a.54085.54085,0,0,1-.605-.60547V7.59863a.54085.54085,0,0,1,.605-.60547h3.75146a.53773.53773,0,0,1,.60547.59375v.17676a1.03723,1.03723,0,0,1-.27539.748L14.74854,10.0293A2.31132,2.31132,0,0,1,16.65186,12.30664ZM9,3A.99974.99974,0,0,0,8,4V8H3V4A1,1,0,0,0,1,4V14a1,1,0,0,0,2,0V10H8v4a1,1,0,0,0,2,0V4A.99974.99974,0,0,0,9,3Z\"></path>\r\n</svg>`;\r\n\r\nexport const linkIcon = `<svg viewBox=\"0 0 18 18\">\r\n  <line stroke=\"currentColor\" fill=\"none\" stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" x1=\"7\" x2=\"11\" y1=\"7\" y2=\"11\"></line>\r\n  <path stroke=\"currentColor\" fill=\"none\" stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M8.9,4.577a3.476,3.476,0,0,1,.36,4.679A3.476,3.476,0,0,1,4.577,8.9C3.185,7.5,2.035,6.4,4.217,4.217S7.5,3.185,8.9,4.577Z\"></path>\r\n  <path stroke=\"currentColor\" fill=\"none\" stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M13.423,9.1a3.476,3.476,0,0,0-4.679-.36,3.476,3.476,0,0,0,.36,4.679c1.392,1.392,2.5,2.542,4.679.36S14.815,10.5,13.423,9.1Z\"></path>\r\n</svg>`;\r\n\r\nexport const codeIcon = `<svg viewBox=\"0 0 18 18\">\r\n  <polyline stroke=\"currentColor\" fill=\"none\" stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" points=\"5 7 3 9 5 11\"></polyline>\r\n  <polyline stroke=\"currentColor\" fill=\"none\" stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" points=\"13 7 15 9 13 11\"></polyline>\r\n  <line stroke=\"currentColor\" fill=\"none\" stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" x1=\"10\" x2=\"8\" y1=\"5\" y2=\"13\"></line>\r\n</svg>`;\r\n\r\n\r\nexport const bulletListIcon = `<svg viewBox=\"0 0 18 18\">\r\n  <line stroke=\"currentColor\" fill=\"none\" stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" x1=\"6\" x2=\"15\" y1=\"4\" y2=\"4\"></line>\r\n  <line stroke=\"currentColor\" fill=\"none\" stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" x1=\"6\" x2=\"15\" y1=\"9\" y2=\"9\"></line>\r\n  <line stroke=\"currentColor\" fill=\"none\" stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" x1=\"6\" x2=\"15\" y1=\"14\" y2=\"14\"></line>\r\n  <line stroke=\"currentColor\" fill=\"none\" stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" x1=\"3\" x2=\"3\" y1=\"4\" y2=\"4\"></line>\r\n  <line stroke=\"currentColor\" fill=\"none\" stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" x1=\"3\" x2=\"3\" y1=\"9\" y2=\"9\"></line>\r\n  <line stroke=\"currentColor\" fill=\"none\" stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" x1=\"3\" x2=\"3\" y1=\"14\" y2=\"14\"></line>\r\n</svg>`;\r\n\r\nexport const orderedListIcon = `<svg viewBox=\"0 0 18 18\">\r\n  <line stroke=\"currentColor\" fill=\"none\" stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" x1=\"7\" x2=\"15\" y1=\"4\" y2=\"4\"></line>\r\n  <line stroke=\"currentColor\" fill=\"none\" stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" x1=\"7\" x2=\"15\" y1=\"9\" y2=\"9\"></line>\r\n  <line stroke=\"currentColor\" fill=\"none\" stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" x1=\"7\" x2=\"15\" y1=\"14\" y2=\"14\"></line>\r\n  <line stroke=\"currentColor\" fill=\"none\" stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"1\" x1=\"2.5\" x2=\"4.5\" y1=\"5.5\" y2=\"5.5\"></line>\r\n  <path fill=\"currentColor\" d=\"M3.5,6A0.5,0.5,0,0,1,3,5.5V3.085l-0.276.138A0.5,0.5,0,0,1,2.053,3c-0.124-.247-0.023-0.324.224-0.447l1-.5A0.5,0.5,0,0,1,4,2.5v3A0.5,0.5,0,0,1,3.5,6Z\"></path>\r\n  <path stroke=\"currentColor\" fill=\"none\" stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"1\" d=\"M4.5,10.5h-2c0-.234,1.85-1.076,1.85-2.234A0.959,0.959,0,0,0,2.5,8.156\"></path>\r\n  <path stroke=\"currentColor\" fill=\"none\" stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"1\" d=\"M2.5,14.846a0.959,0.959,0,0,0,1.85-.109A0.7,0.7,0,0,0,3.75,14a0.688,0.688,0,0,0,.6-0.736,0.959,0.959,0,0,0-1.85-.109\"></path>\r\n</svg>`;\r\n\r\nexport const quoteIcon = `<svg viewBox=\"2 2 20 20\">\r\n  <path stroke=\"currentColor\" stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M10 10.8182L9 10.8182C8.80222 10.8182 8.60888 10.7649 8.44443 10.665C8.27998 10.5651 8.15181 10.4231 8.07612 10.257C8.00043 10.0909 7.98063 9.90808 8.01922 9.73174C8.0578 9.55539 8.15304 9.39341 8.29289 9.26627C8.43275 9.13913 8.61093 9.05255 8.80491 9.01747C8.99889 8.98239 9.19996 9.00039 9.38268 9.0692C9.56541 9.13801 9.72159 9.25453 9.83147 9.40403C9.94135 9.55353 10 9.72929 10 9.90909L10 12.1818C10 12.664 9.78929 13.1265 9.41421 13.4675C9.03914 13.8084 8.53043 14 8 14\"></path>\r\n  <path stroke=\"currentColor\" stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M16 10.8182L15 10.8182C14.8022 10.8182 14.6089 10.7649 14.4444 10.665C14.28 10.5651 14.1518 10.4231 14.0761 10.257C14.0004 10.0909 13.9806 9.90808 14.0192 9.73174C14.0578 9.55539 14.153 9.39341 14.2929 9.26627C14.4327 9.13913 14.6109 9.05255 14.8049 9.01747C14.9989 8.98239 15.2 9.00039 15.3827 9.0692C15.5654 9.13801 15.7216 9.25453 15.8315 9.40403C15.9414 9.55353 16 9.72929 16 9.90909L16 12.1818C16 12.664 15.7893 13.1265 15.4142 13.4675C15.0391 13.8084 14.5304 14 14 14\"></path>\r\n</svg>`;\r\n\r\nexport const taskListIcon = `<svg viewBox=\"0 0 18 18\">\r\n  <line stroke=\"currentColor\" fill=\"none\" stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" x1=\"8\" x2=\"16\" y1=\"4\" y2=\"4\"></line>\r\n  <line stroke=\"currentColor\" fill=\"none\" stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" x1=\"8\" x2=\"16\" y1=\"9\" y2=\"9\"></line>\r\n  <line stroke=\"currentColor\" fill=\"none\" stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" x1=\"8\" x2=\"16\" y1=\"14\" y2=\"14\"></line>\r\n  <rect stroke=\"currentColor\" fill=\"none\" stroke-width=\"1.5\" x=\"2\" y=\"3\" width=\"3\" height=\"3\" rx=\"0.5\"></rect>\r\n  <rect stroke=\"currentColor\" fill=\"none\" stroke-width=\"1.5\" x=\"2\" y=\"13\" width=\"3\" height=\"3\" rx=\"0.5\"></rect>\r\n  <polyline stroke=\"currentColor\" fill=\"none\" stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"1.5\" points=\"2.65 9.5 3.5 10.5 5 8.5\"></polyline>\r\n</svg>`;\r\n\r\nexport const eyeIcon = `<svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\">\r\n  <path d=\"M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z\" fill=\"none\"></path>\r\n  <circle cx=\"12\" cy=\"12\" r=\"3\" fill=\"none\"></circle>\r\n</svg>`;", "/**\r\n * Toolbar button definitions for OverType editor\r\n * Export built-in buttons that can be used in custom toolbar configurations\r\n */\r\n\r\nimport * as icons from './icons.js';\r\nimport * as markdownActions from 'markdown-actions';\r\n\r\n/**\r\n * Built-in toolbar button definitions\r\n * Each button has: name, actionId, icon, title, action\r\n * - name: DOM identifier for the button element\r\n * - actionId: Canonical action identifier used by performAction\r\n * Action signature: ({ editor, getValue, setValue, event }) => void\r\n */\r\nexport const toolbarButtons = {\r\n  bold: {\r\n    name: 'bold',\r\n    actionId: 'toggleBold',\r\n    icon: icons.boldIcon,\r\n    title: 'Bold (Ctrl+B)',\r\n    action: ({ editor }) => {\r\n      markdownActions.toggleBold(editor.textarea);\r\n      editor.textarea.dispatchEvent(new Event('input', { bubbles: true }));\r\n    }\r\n  },\r\n\r\n  italic: {\r\n    name: 'italic',\r\n    actionId: 'toggleItalic',\r\n    icon: icons.italicIcon,\r\n    title: 'Italic (Ctrl+I)',\r\n    action: ({ editor }) => {\r\n      markdownActions.toggleItalic(editor.textarea);\r\n      editor.textarea.dispatchEvent(new Event('input', { bubbles: true }));\r\n    }\r\n  },\r\n\r\n  code: {\r\n    name: 'code',\r\n    actionId: 'toggleCode',\r\n    icon: icons.codeIcon,\r\n    title: 'Inline Code',\r\n    action: ({ editor }) => {\r\n      markdownActions.toggleCode(editor.textarea);\r\n      editor.textarea.dispatchEvent(new Event('input', { bubbles: true }));\r\n    }\r\n  },\r\n\r\n  separator: {\r\n    name: 'separator'\r\n    // No icon, title, or action - special separator element\r\n  },\r\n\r\n  link: {\r\n    name: 'link',\r\n    actionId: 'insertLink',\r\n    icon: icons.linkIcon,\r\n    title: 'Insert Link',\r\n    action: ({ editor }) => {\r\n      markdownActions.insertLink(editor.textarea);\r\n      editor.textarea.dispatchEvent(new Event('input', { bubbles: true }));\r\n    }\r\n  },\r\n\r\n  h1: {\r\n    name: 'h1',\r\n    actionId: 'toggleH1',\r\n    icon: icons.h1Icon,\r\n    title: 'Heading 1',\r\n    action: ({ editor }) => {\r\n      markdownActions.toggleH1(editor.textarea);\r\n      editor.textarea.dispatchEvent(new Event('input', { bubbles: true }));\r\n    }\r\n  },\r\n\r\n  h2: {\r\n    name: 'h2',\r\n    actionId: 'toggleH2',\r\n    icon: icons.h2Icon,\r\n    title: 'Heading 2',\r\n    action: ({ editor }) => {\r\n      markdownActions.toggleH2(editor.textarea);\r\n      editor.textarea.dispatchEvent(new Event('input', { bubbles: true }));\r\n    }\r\n  },\r\n\r\n  h3: {\r\n    name: 'h3',\r\n    actionId: 'toggleH3',\r\n    icon: icons.h3Icon,\r\n    title: 'Heading 3',\r\n    action: ({ editor }) => {\r\n      markdownActions.toggleH3(editor.textarea);\r\n      editor.textarea.dispatchEvent(new Event('input', { bubbles: true }));\r\n    }\r\n  },\r\n\r\n  bulletList: {\r\n    name: 'bulletList',\r\n    actionId: 'toggleBulletList',\r\n    icon: icons.bulletListIcon,\r\n    title: 'Bullet List',\r\n    action: ({ editor }) => {\r\n      markdownActions.toggleBulletList(editor.textarea);\r\n      editor.textarea.dispatchEvent(new Event('input', { bubbles: true }));\r\n    }\r\n  },\r\n\r\n  orderedList: {\r\n    name: 'orderedList',\r\n    actionId: 'toggleNumberedList',\r\n    icon: icons.orderedListIcon,\r\n    title: 'Numbered List',\r\n    action: ({ editor }) => {\r\n      markdownActions.toggleNumberedList(editor.textarea);\r\n      editor.textarea.dispatchEvent(new Event('input', { bubbles: true }));\r\n    }\r\n  },\r\n\r\n  taskList: {\r\n    name: 'taskList',\r\n    actionId: 'toggleTaskList',\r\n    icon: icons.taskListIcon,\r\n    title: 'Task List',\r\n    action: ({ editor }) => {\r\n      if (markdownActions.toggleTaskList) {\r\n        markdownActions.toggleTaskList(editor.textarea);\r\n        editor.textarea.dispatchEvent(new Event('input', { bubbles: true }));\r\n      }\r\n    }\r\n  },\r\n\r\n  quote: {\r\n    name: 'quote',\r\n    actionId: 'toggleQuote',\r\n    icon: icons.quoteIcon,\r\n    title: 'Quote',\r\n    action: ({ editor }) => {\r\n      markdownActions.toggleQuote(editor.textarea);\r\n      editor.textarea.dispatchEvent(new Event('input', { bubbles: true }));\r\n    }\r\n  },\r\n\r\n  viewMode: {\r\n    name: 'viewMode',\r\n    icon: icons.eyeIcon,\r\n    title: 'View mode'\r\n    // Special: handled internally by Toolbar class as dropdown\r\n    // No action property - dropdown behavior is internal\r\n  }\r\n};\r\n\r\n/**\r\n * Default toolbar button layout with separators\r\n * This is used when toolbar: true but no toolbarButtons provided\r\n */\r\nexport const defaultToolbarButtons = [\r\n  toolbarButtons.bold,\r\n  toolbarButtons.italic,\r\n  toolbarButtons.code,\r\n  toolbarButtons.separator,\r\n  toolbarButtons.link,\r\n  toolbarButtons.separator,\r\n  toolbarButtons.h1,\r\n  toolbarButtons.h2,\r\n  toolbarButtons.h3,\r\n  toolbarButtons.separator,\r\n  toolbarButtons.bulletList,\r\n  toolbarButtons.orderedList,\r\n  toolbarButtons.taskList,\r\n  toolbarButtons.separator,\r\n  toolbarButtons.quote,\r\n  toolbarButtons.separator,\r\n  toolbarButtons.viewMode\r\n];\r\n", "/**\r\n * OverType - A lightweight markdown editor library with perfect WYSIWYG alignment\r\n * @version 1.0.0\r\n * @license MIT\r\n */\r\n\r\nimport { MarkdownParser } from './parser.js';\r\nimport { ShortcutsManager } from './shortcuts.js';\r\nimport { generateStyles } from './styles.js';\r\nimport { getTheme, mergeTheme, solar, themeToCSSVars, resolveAutoTheme } from './themes.js';\r\nimport { Toolbar } from './toolbar.js';\r\nimport { LinkTooltip } from './link-tooltip.js';\r\nimport { defaultToolbarButtons } from './toolbar-buttons.js';\r\n\r\n/**\r\n * Build action map from toolbar button configurations\r\n * @param {Array} buttons - Array of button config objects\r\n * @returns {Object} Map of actionId -> action function\r\n */\r\nfunction buildActionsMap(buttons) {\r\n  const map = {};\r\n  (buttons || []).forEach((btn) => {\r\n    if (!btn || btn.name === 'separator') return;\r\n    const id = btn.actionId || btn.name;\r\n    if (btn.action) {\r\n      map[id] = btn.action;\r\n    }\r\n  });\r\n  return map;\r\n}\r\n\r\n/**\r\n * Normalize toolbar buttons for comparison\r\n * @param {Array|null} buttons\r\n * @returns {Array|null}\r\n */\r\nfunction normalizeButtons(buttons) {\r\n  const list = buttons || defaultToolbarButtons;\r\n  if (!Array.isArray(list)) return null;\r\n  return list.map((btn) => ({\r\n    name: btn?.name || null,\r\n    actionId: btn?.actionId || btn?.name || null,\r\n    icon: btn?.icon || null,\r\n    title: btn?.title || null\r\n  }));\r\n}\r\n\r\n/**\r\n * Determine if toolbar button configuration changed\r\n * @param {Array|null} prevButtons\r\n * @param {Array|null} nextButtons\r\n * @returns {boolean}\r\n */\r\nfunction toolbarButtonsChanged(prevButtons, nextButtons) {\r\n  const prev = normalizeButtons(prevButtons);\r\n  const next = normalizeButtons(nextButtons);\r\n\r\n  if (prev === null || next === null) return prev !== next;\r\n  if (prev.length !== next.length) return true;\r\n\r\n  for (let i = 0; i < prev.length; i++) {\r\n    const a = prev[i];\r\n    const b = next[i];\r\n    if (a.name !== b.name ||\r\n        a.actionId !== b.actionId ||\r\n        a.icon !== b.icon ||\r\n        a.title !== b.title) {\r\n      return true;\r\n    }\r\n  }\r\n  return false;\r\n}\r\n\r\n/**\r\n * OverType Editor Class\r\n */\r\nclass OverType {\r\n    // Static properties\r\n    static instances = new WeakMap();\r\n    static stylesInjected = false;\r\n    static globalListenersInitialized = false;\r\n    static instanceCount = 0;\r\n    static autoThemeMediaQuery = null;  // Media query for auto theme switching\r\n    static autoThemeListener = null;     // Listener function for auto theme changes\r\n\r\n    /**\r\n     * Constructor - Always returns an array of instances\r\n     * @param {string|Element|NodeList|Array} target - Target element(s)\r\n     * @param {Object} options - Configuration options\r\n     * @returns {Array} Array of OverType instances\r\n     */\r\n    constructor(target, options = {}) {\r\n      // Convert target to array of elements\r\n      let elements;\r\n      \r\n      if (typeof target === 'string') {\r\n        elements = document.querySelectorAll(target);\r\n        if (elements.length === 0) {\r\n          throw new Error(`No elements found for selector: ${target}`);\r\n        }\r\n        elements = Array.from(elements);\r\n      } else if (target instanceof Element) {\r\n        elements = [target];\r\n      } else if (target instanceof NodeList) {\r\n        elements = Array.from(target);\r\n      } else if (Array.isArray(target)) {\r\n        elements = target;\r\n      } else {\r\n        throw new Error('Invalid target: must be selector string, Element, NodeList, or Array');\r\n      }\r\n\r\n      // Initialize all elements and return array\r\n      const instances = elements.map(element => {\r\n        // Check for existing instance\r\n        if (element.overTypeInstance) {\r\n          // Re-init existing instance\r\n          element.overTypeInstance.reinit(options);\r\n          return element.overTypeInstance;\r\n        }\r\n\r\n        // Create new instance\r\n        const instance = Object.create(OverType.prototype);\r\n        instance._init(element, options);\r\n        element.overTypeInstance = instance;\r\n        OverType.instances.set(element, instance);\r\n        return instance;\r\n      });\r\n\r\n      return instances;\r\n    }\r\n\r\n    /**\r\n     * Internal initialization\r\n     * @private\r\n     */\r\n    _init(element, options = {}) {\r\n      this.element = element;\r\n      \r\n      // Store the original theme option before merging\r\n      this.instanceTheme = options.theme || null;\r\n      \r\n      // Auto theme tracking for instance-level theme\r\n      this.autoThemeMediaQuery = null;\r\n      this.autoThemeListener = null;\r\n      \r\n      this.options = this._mergeOptions(options);\r\n      this.instanceId = ++OverType.instanceCount;\r\n      this.initialized = false;\r\n\r\n      // Inject styles if needed\r\n      OverType.injectStyles();\r\n\r\n      // Initialize global listeners\r\n      OverType.initGlobalListeners();\r\n\r\n      // Check for existing OverType DOM structure\r\n      const container = element.querySelector('.overtype-container');\r\n      const wrapper = element.querySelector('.overtype-wrapper');\r\n      if (container || wrapper) {\r\n        this._recoverFromDOM(container, wrapper);\r\n      } else {\r\n        this._buildFromScratch();\r\n      }\r\n\r\n      // Set up instance theme if provided (including auto theme listener)\r\n      if (this.instanceTheme) {\r\n        this.setTheme(this.instanceTheme);\r\n      }\r\n\r\n      // Setup shortcuts manager\r\n      this.shortcuts = new ShortcutsManager(this);\r\n\r\n      // Build action map from toolbar buttons (works whether or not toolbar UI is shown)\r\n      this._rebuildActionsMap();\r\n\r\n      // Setup link tooltip\r\n      this.linkTooltip = new LinkTooltip(this);\r\n\r\n      // Sync scroll positions on initial render\r\n      // This ensures textarea matches preview scroll if page is reloaded while scrolled\r\n      // Double requestAnimationFrame waits for browser to restore scroll position\r\n      requestAnimationFrame(() => {\r\n        requestAnimationFrame(() => {\r\n          this.textarea.scrollTop = this.preview.scrollTop;\r\n          this.textarea.scrollLeft = this.preview.scrollLeft;\r\n        });\r\n      });\r\n\r\n      // Mark as initialized\r\n      this.initialized = true;\r\n\r\n      // Call onChange if provided\r\n      if (this.options.onChange) {\r\n        this.options.onChange(this.getValue(), this);\r\n      }\r\n    }\r\n\r\n    /**\r\n     * Merge user options with defaults\r\n     * @private\r\n     */\r\n    _mergeOptions(options) {\r\n      const defaults = {\r\n        // Typography\r\n        fontSize: '14px',\r\n        lineHeight: 1.6,\r\n        /* System-first, guaranteed monospaced; avoids Android 'ui-monospace' pitfalls */\r\n        fontFamily: '\"SF Mono\", SFMono-Regular, Menlo, Monaco, \"Cascadia Code\", Consolas, \"Roboto Mono\", \"Noto Sans Mono\", \"Droid Sans Mono\", \"Ubuntu Mono\", \"DejaVu Sans Mono\", \"Liberation Mono\", \"Courier New\", Courier, monospace',\r\n        padding: '16px',\r\n        \r\n        // Mobile styles\r\n        mobile: {\r\n          fontSize: '16px',  // Prevent zoom on iOS\r\n          padding: '12px',\r\n          lineHeight: 1.5\r\n        },\r\n        \r\n        // Native textarea properties\r\n        textareaProps: {},\r\n        \r\n        // Behavior\r\n        autofocus: false,\r\n        autoResize: false,  // Auto-expand height with content\r\n        minHeight: '100px', // Minimum height for autoResize mode\r\n        maxHeight: null,    // Maximum height for autoResize mode (null = unlimited)\r\n        placeholder: 'Start typing...',\r\n        value: '',\r\n        \r\n        // Callbacks\r\n        onChange: null,\r\n        onKeydown: null,\r\n        \r\n        // Features\r\n        showActiveLineRaw: false,\r\n        showStats: false,\r\n        toolbar: false,\r\n        toolbarButtons: null,  // Defaults to defaultToolbarButtons if toolbar: true\r\n        statsFormatter: null,\r\n        smartLists: true,  // Enable smart list continuation\r\n        codeHighlighter: null  // Per-instance code highlighter\r\n      };\r\n      \r\n      // Remove theme and colors from options - these are now global\r\n      const { theme, colors, ...cleanOptions } = options;\r\n      \r\n      return {\r\n        ...defaults,\r\n        ...cleanOptions\r\n      };\r\n    }\r\n\r\n    /**\r\n     * Recover from existing DOM structure\r\n     * @private\r\n     */\r\n    _recoverFromDOM(container, wrapper) {\r\n      // Handle old structure (wrapper only) or new structure (container + wrapper)\r\n      if (container && container.classList.contains('overtype-container')) {\r\n        this.container = container;\r\n        this.wrapper = container.querySelector('.overtype-wrapper');\r\n      } else if (wrapper) {\r\n        // Old structure - just wrapper, no container\r\n        this.wrapper = wrapper;\r\n        // Wrap it in a container for consistency\r\n        this.container = document.createElement('div');\r\n        this.container.className = 'overtype-container';\r\n        // Use instance theme if provided, otherwise use global theme\r\n        const themeToUse = this.instanceTheme || OverType.currentTheme || solar;\r\n        const themeName = typeof themeToUse === 'string' ? themeToUse : themeToUse.name;\r\n        if (themeName) {\r\n          this.container.setAttribute('data-theme', themeName);\r\n        }\r\n        \r\n        // If using instance theme, apply CSS variables to container\r\n        if (this.instanceTheme) {\r\n          const themeObj = typeof this.instanceTheme === 'string' ? getTheme(this.instanceTheme) : this.instanceTheme;\r\n          if (themeObj && themeObj.colors) {\r\n            const cssVars = themeToCSSVars(themeObj.colors);\r\n            this.container.style.cssText += cssVars;\r\n          }\r\n        }\r\n        wrapper.parentNode.insertBefore(this.container, wrapper);\r\n        this.container.appendChild(wrapper);\r\n      }\r\n      \r\n      if (!this.wrapper) {\r\n        // No valid structure found\r\n        if (container) container.remove();\r\n        if (wrapper) wrapper.remove();\r\n        this._buildFromScratch();\r\n        return;\r\n      }\r\n      \r\n      this.textarea = this.wrapper.querySelector('.overtype-input');\r\n      this.preview = this.wrapper.querySelector('.overtype-preview');\r\n\r\n      if (!this.textarea || !this.preview) {\r\n        // Partial DOM - clear and rebuild\r\n        this.container.remove();\r\n        this._buildFromScratch();\r\n        return;\r\n      }\r\n\r\n      // Store reference on wrapper\r\n      this.wrapper._instance = this;\r\n      \r\n      // Apply instance-specific styles via CSS custom properties\r\n      if (this.options.fontSize) {\r\n        this.wrapper.style.setProperty('--instance-font-size', this.options.fontSize);\r\n      }\r\n      if (this.options.lineHeight) {\r\n        this.wrapper.style.setProperty('--instance-line-height', String(this.options.lineHeight));\r\n      }\r\n      if (this.options.padding) {\r\n        this.wrapper.style.setProperty('--instance-padding', this.options.padding);\r\n      }\r\n\r\n      // Disable autofill, spellcheck, and extensions\r\n      this._configureTextarea();\r\n\r\n      // Apply any new options\r\n      this._applyOptions();\r\n    }\r\n\r\n    /**\r\n     * Build editor from scratch\r\n     * @private\r\n     */\r\n    _buildFromScratch() {\r\n      // Extract any existing content\r\n      const content = this._extractContent();\r\n\r\n      // Clear element\r\n      this.element.innerHTML = '';\r\n\r\n      // Create DOM structure\r\n      this._createDOM();\r\n\r\n      // Set initial content\r\n      if (content || this.options.value) {\r\n        this.setValue(content || this.options.value);\r\n      }\r\n\r\n      // Apply options\r\n      this._applyOptions();\r\n    }\r\n\r\n    /**\r\n     * Extract content from element\r\n     * @private\r\n     */\r\n    _extractContent() {\r\n      // Look for existing OverType textarea\r\n      const textarea = this.element.querySelector('.overtype-input');\r\n      if (textarea) return textarea.value;\r\n\r\n      // Use element's text content as fallback\r\n      return this.element.textContent || '';\r\n    }\r\n\r\n    /**\r\n     * Create DOM structure\r\n     * @private\r\n     */\r\n    _createDOM() {\r\n      // Create container that will hold toolbar and editor\r\n      this.container = document.createElement('div');\r\n      this.container.className = 'overtype-container';\r\n      \r\n      // Set theme on container - use instance theme if provided\r\n      const themeToUse = this.instanceTheme || OverType.currentTheme || solar;\r\n      const themeName = typeof themeToUse === 'string' ? themeToUse : themeToUse.name;\r\n      if (themeName) {\r\n        this.container.setAttribute('data-theme', themeName);\r\n      }\r\n      \r\n      // If using instance theme, apply CSS variables to container\r\n      if (this.instanceTheme) {\r\n        const themeObj = typeof this.instanceTheme === 'string' ? getTheme(this.instanceTheme) : this.instanceTheme;\r\n        if (themeObj && themeObj.colors) {\r\n          const cssVars = themeToCSSVars(themeObj.colors);\r\n          this.container.style.cssText += cssVars;\r\n        }\r\n      }\r\n      \r\n      // Create wrapper for editor\r\n      this.wrapper = document.createElement('div');\r\n      this.wrapper.className = 'overtype-wrapper';\r\n      \r\n      \r\n      // Apply instance-specific styles via CSS custom properties\r\n      if (this.options.fontSize) {\r\n        this.wrapper.style.setProperty('--instance-font-size', this.options.fontSize);\r\n      }\r\n      if (this.options.lineHeight) {\r\n        this.wrapper.style.setProperty('--instance-line-height', String(this.options.lineHeight));\r\n      }\r\n      if (this.options.padding) {\r\n        this.wrapper.style.setProperty('--instance-padding', this.options.padding);\r\n      }\r\n      \r\n      this.wrapper._instance = this;\r\n\r\n      // Create textarea\r\n      this.textarea = document.createElement('textarea');\r\n      this.textarea.className = 'overtype-input';\r\n      this.textarea.placeholder = this.options.placeholder;\r\n      this._configureTextarea();\r\n      \r\n      // Apply any native textarea properties\r\n      if (this.options.textareaProps) {\r\n        Object.entries(this.options.textareaProps).forEach(([key, value]) => {\r\n          if (key === 'className' || key === 'class') {\r\n            this.textarea.className += ' ' + value;\r\n          } else if (key === 'style' && typeof value === 'object') {\r\n            Object.assign(this.textarea.style, value);\r\n          } else {\r\n            this.textarea.setAttribute(key, value);\r\n          }\r\n        });\r\n      }\r\n\r\n      // Create preview div\r\n      this.preview = document.createElement('div');\r\n      this.preview.className = 'overtype-preview';\r\n      this.preview.setAttribute('aria-hidden', 'true');\r\n\r\n      // Assemble DOM\r\n      this.wrapper.appendChild(this.textarea);\r\n      this.wrapper.appendChild(this.preview);\r\n      \r\n      // No need to prevent link clicks - pointer-events handles this\r\n      \r\n      // Add wrapper to container first\r\n      this.container.appendChild(this.wrapper);\r\n      \r\n      // Add stats bar at the end (bottom) if enabled\r\n      if (this.options.showStats) {\r\n        this.statsBar = document.createElement('div');\r\n        this.statsBar.className = 'overtype-stats';\r\n        this.container.appendChild(this.statsBar);\r\n        this._updateStats();\r\n      }\r\n      \r\n      // Add container to element\r\n      this.element.appendChild(this.container);\r\n      \r\n      // Setup auto-resize if enabled\r\n      if (this.options.autoResize) {\r\n        this._setupAutoResize();\r\n      } else {\r\n        // Ensure auto-resize class is removed if not using auto-resize\r\n        this.container.classList.remove('overtype-auto-resize');\r\n      }\r\n    }\r\n\r\n    /**\r\n     * Configure textarea attributes\r\n     * @private\r\n     */\r\n    _configureTextarea() {\r\n      this.textarea.setAttribute('autocomplete', 'off');\r\n      this.textarea.setAttribute('autocorrect', 'off');\r\n      this.textarea.setAttribute('autocapitalize', 'off');\r\n      this.textarea.setAttribute('spellcheck', 'false');\r\n      this.textarea.setAttribute('data-gramm', 'false');\r\n      this.textarea.setAttribute('data-gramm_editor', 'false');\r\n      this.textarea.setAttribute('data-enable-grammarly', 'false');\r\n    }\r\n\r\n    /**\r\n     * Create and setup toolbar\r\n     * @private\r\n     */\r\n    _createToolbar() {\r\n      // Use provided toolbarButtons or default to defaultToolbarButtons\r\n      const toolbarButtons = this.options.toolbarButtons || defaultToolbarButtons;\r\n\r\n      this.toolbar = new Toolbar(this, { toolbarButtons });\r\n      this.toolbar.create();\r\n\r\n      // Store listener references for cleanup\r\n      this._toolbarSelectionListener = () => {\r\n        if (this.toolbar) {\r\n          this.toolbar.updateButtonStates();\r\n        }\r\n      };\r\n      this._toolbarInputListener = () => {\r\n        if (this.toolbar) {\r\n          this.toolbar.updateButtonStates();\r\n        }\r\n      };\r\n\r\n      // Add listeners\r\n      this.textarea.addEventListener('selectionchange', this._toolbarSelectionListener);\r\n      this.textarea.addEventListener('input', this._toolbarInputListener);\r\n    }\r\n\r\n    /**\r\n     * Cleanup toolbar event listeners\r\n     * @private\r\n     */\r\n    _cleanupToolbarListeners() {\r\n      if (this._toolbarSelectionListener) {\r\n        this.textarea.removeEventListener('selectionchange', this._toolbarSelectionListener);\r\n        this._toolbarSelectionListener = null;\r\n      }\r\n      if (this._toolbarInputListener) {\r\n        this.textarea.removeEventListener('input', this._toolbarInputListener);\r\n        this._toolbarInputListener = null;\r\n      }\r\n    }\r\n\r\n    /**\r\n     * Rebuild the action map from current toolbar button configuration\r\n     * Called during init and reinit to keep shortcuts in sync with toolbar buttons\r\n     * @private\r\n     */\r\n    _rebuildActionsMap() {\r\n      // Always start with default actions (shortcuts always work regardless of toolbar config)\r\n      this.actionsById = buildActionsMap(defaultToolbarButtons);\r\n\r\n      // Overlay custom toolbar actions (can add/override, but never remove core actions)\r\n      if (this.options.toolbarButtons) {\r\n        Object.assign(this.actionsById, buildActionsMap(this.options.toolbarButtons));\r\n      }\r\n    }\r\n\r\n    /**\r\n     * Apply options to the editor\r\n     * @private\r\n     */\r\n    _applyOptions() {\r\n      // Apply autofocus\r\n      if (this.options.autofocus) {\r\n        this.textarea.focus();\r\n      }\r\n\r\n      // Setup or remove auto-resize\r\n      if (this.options.autoResize) {\r\n        if (!this.container.classList.contains('overtype-auto-resize')) {\r\n          this._setupAutoResize();\r\n        }\r\n      } else {\r\n        // Ensure auto-resize class is removed\r\n        this.container.classList.remove('overtype-auto-resize');\r\n      }\r\n\r\n      // Handle toolbar option changes\r\n      if (this.options.toolbar && !this.toolbar) {\r\n        // Create toolbar if enabled and doesn't exist\r\n        this._createToolbar();\r\n      } else if (!this.options.toolbar && this.toolbar) {\r\n        // Destroy toolbar if disabled and exists\r\n        this._cleanupToolbarListeners();\r\n        this.toolbar.destroy();\r\n        this.toolbar = null;\r\n      }\r\n\r\n      // Update preview with initial content\r\n      this.updatePreview();\r\n    }\r\n\r\n    /**\r\n     * Update preview with parsed markdown\r\n     */\r\n    updatePreview() {\r\n      const text = this.textarea.value;\r\n      const cursorPos = this.textarea.selectionStart;\r\n      const activeLine = this._getCurrentLine(text, cursorPos);\r\n\r\n      // Detect if we're in preview mode\r\n      const isPreviewMode = this.container.dataset.mode === 'preview';\r\n\r\n      // Parse markdown\r\n      const html = MarkdownParser.parse(text, activeLine, this.options.showActiveLineRaw, this.options.codeHighlighter, isPreviewMode);\r\n      this.preview.innerHTML = html || '<span style=\"color: #808080;\">Start typing...</span>';\r\n      \r\n      // Apply code block backgrounds\r\n      this._applyCodeBlockBackgrounds();\r\n      \r\n      // Links always have real hrefs now - no need to update them\r\n      \r\n      // Update stats if enabled\r\n      if (this.options.showStats && this.statsBar) {\r\n        this._updateStats();\r\n      }\r\n      \r\n      // Trigger onChange callback\r\n      if (this.options.onChange && this.initialized) {\r\n        this.options.onChange(text, this);\r\n      }\r\n    }\r\n\r\n    /**\r\n     * Apply background styling to code blocks\r\n     * @private\r\n     */\r\n    _applyCodeBlockBackgrounds() {\r\n      // Find all code fence elements\r\n      const codeFences = this.preview.querySelectorAll('.code-fence');\r\n      \r\n      // Process pairs of code fences\r\n      for (let i = 0; i < codeFences.length - 1; i += 2) {\r\n        const openFence = codeFences[i];\r\n        const closeFence = codeFences[i + 1];\r\n        \r\n        // Get parent divs\r\n        const openParent = openFence.parentElement;\r\n        const closeParent = closeFence.parentElement;\r\n        \r\n        if (!openParent || !closeParent) continue;\r\n        \r\n        // Make fences display: block\r\n        openFence.style.display = 'block';\r\n        closeFence.style.display = 'block';\r\n        \r\n        // Apply class to parent divs\r\n        openParent.classList.add('code-block-line');\r\n        closeParent.classList.add('code-block-line');\r\n        \r\n        // With the new structure, there's a <pre> block between fences, not DIVs\r\n        // We don't need to process anything between the fences anymore\r\n        // The <pre><code> structure already handles the content correctly\r\n      }\r\n    }\r\n\r\n    /**\r\n     * Get current line number from cursor position\r\n     * @private\r\n     */\r\n    _getCurrentLine(text, cursorPos) {\r\n      const lines = text.substring(0, cursorPos).split('\\n');\r\n      return lines.length - 1;\r\n    }\r\n\r\n    /**\r\n     * Handle input events\r\n     * @private\r\n     */\r\n    handleInput(event) {\r\n      this.updatePreview();\r\n    }\r\n\r\n    /**\r\n     * Handle keydown events\r\n     * @private\r\n     */\r\n    handleKeydown(event) {\r\n      // Handle Tab key to prevent focus loss and insert spaces\r\n      if (event.key === 'Tab') {\r\n        const start = this.textarea.selectionStart;\r\n        const end = this.textarea.selectionEnd;\r\n        const value = this.textarea.value;\r\n\r\n        // If Shift+Tab without a selection, allow default behavior (navigate to previous element)\r\n        if (event.shiftKey && start === end) {\r\n          return;\r\n        }\r\n\r\n        event.preventDefault();\r\n\r\n        // If there's a selection, indent/outdent based on shift key\r\n        if (start !== end && event.shiftKey) {\r\n          // Outdent: remove 2 spaces from start of each selected line\r\n          const before = value.substring(0, start);\r\n          const selection = value.substring(start, end);\r\n          const after = value.substring(end);\r\n          \r\n          const lines = selection.split('\\n');\r\n          const outdented = lines.map(line => line.replace(/^  /, '')).join('\\n');\r\n          \r\n          // Try to use execCommand first to preserve undo history\r\n          if (document.execCommand) {\r\n            // Select the text that needs to be replaced\r\n            this.textarea.setSelectionRange(start, end);\r\n            document.execCommand('insertText', false, outdented);\r\n          } else {\r\n            // Fallback to direct manipulation\r\n            this.textarea.value = before + outdented + after;\r\n            this.textarea.selectionStart = start;\r\n            this.textarea.selectionEnd = start + outdented.length;\r\n          }\r\n        } else if (start !== end) {\r\n          // Indent: add 2 spaces to start of each selected line\r\n          const before = value.substring(0, start);\r\n          const selection = value.substring(start, end);\r\n          const after = value.substring(end);\r\n          \r\n          const lines = selection.split('\\n');\r\n          const indented = lines.map(line => '  ' + line).join('\\n');\r\n          \r\n          // Try to use execCommand first to preserve undo history\r\n          if (document.execCommand) {\r\n            // Select the text that needs to be replaced\r\n            this.textarea.setSelectionRange(start, end);\r\n            document.execCommand('insertText', false, indented);\r\n          } else {\r\n            // Fallback to direct manipulation\r\n            this.textarea.value = before + indented + after;\r\n            this.textarea.selectionStart = start;\r\n            this.textarea.selectionEnd = start + indented.length;\r\n          }\r\n        } else {\r\n          // No selection: just insert 2 spaces\r\n          // Use execCommand to preserve undo history\r\n          if (document.execCommand) {\r\n            document.execCommand('insertText', false, '  ');\r\n          } else {\r\n            // Fallback to direct manipulation\r\n            this.textarea.value = value.substring(0, start) + '  ' + value.substring(end);\r\n            this.textarea.selectionStart = this.textarea.selectionEnd = start + 2;\r\n          }\r\n        }\r\n        \r\n        // Trigger input event to update preview\r\n        this.textarea.dispatchEvent(new Event('input', { bubbles: true }));\r\n        return;\r\n      }\r\n      \r\n      // Handle Enter key for smart list continuation\r\n      if (event.key === 'Enter' && !event.shiftKey && !event.metaKey && !event.ctrlKey && this.options.smartLists) {\r\n        if (this.handleSmartListContinuation()) {\r\n          event.preventDefault();\r\n          return;\r\n        }\r\n      }\r\n      \r\n      // Let shortcuts manager handle other keys\r\n      const handled = this.shortcuts.handleKeydown(event);\r\n      \r\n      // Call user callback if provided\r\n      if (!handled && this.options.onKeydown) {\r\n        this.options.onKeydown(event, this);\r\n      }\r\n    }\r\n\r\n    /**\r\n     * Handle smart list continuation\r\n     * @returns {boolean} Whether the event was handled\r\n     */\r\n    handleSmartListContinuation() {\r\n      const textarea = this.textarea;\r\n      const cursorPos = textarea.selectionStart;\r\n      const context = MarkdownParser.getListContext(textarea.value, cursorPos);\r\n      \r\n      if (!context || !context.inList) return false;\r\n      \r\n      // Handle empty list item (exit list)\r\n      if (context.content.trim() === '' && cursorPos >= context.markerEndPos) {\r\n        this.deleteListMarker(context);\r\n        return true;\r\n      }\r\n      \r\n      // Handle text splitting if cursor is in middle of content\r\n      if (cursorPos > context.markerEndPos && cursorPos < context.lineEnd) {\r\n        this.splitListItem(context, cursorPos);\r\n      } else {\r\n        // Just add new item after current line\r\n        this.insertNewListItem(context);\r\n      }\r\n      \r\n      // Handle numbered list renumbering\r\n      if (context.listType === 'numbered') {\r\n        this.scheduleNumberedListUpdate();\r\n      }\r\n      \r\n      return true;\r\n    }\r\n    \r\n    /**\r\n     * Delete list marker and exit list\r\n     * @private\r\n     */\r\n    deleteListMarker(context) {\r\n      // Select from line start to marker end\r\n      this.textarea.setSelectionRange(context.lineStart, context.markerEndPos);\r\n      document.execCommand('delete');\r\n      \r\n      // Trigger input event\r\n      this.textarea.dispatchEvent(new Event('input', { bubbles: true }));\r\n    }\r\n    \r\n    /**\r\n     * Insert new list item\r\n     * @private\r\n     */\r\n    insertNewListItem(context) {\r\n      const newItem = MarkdownParser.createNewListItem(context);\r\n      document.execCommand('insertText', false, '\\n' + newItem);\r\n      \r\n      // Trigger input event\r\n      this.textarea.dispatchEvent(new Event('input', { bubbles: true }));\r\n    }\r\n    \r\n    /**\r\n     * Split list item at cursor position\r\n     * @private\r\n     */\r\n    splitListItem(context, cursorPos) {\r\n      // Get text after cursor\r\n      const textAfterCursor = context.content.substring(cursorPos - context.markerEndPos);\r\n      \r\n      // Delete text after cursor\r\n      this.textarea.setSelectionRange(cursorPos, context.lineEnd);\r\n      document.execCommand('delete');\r\n      \r\n      // Insert new list item with remaining text\r\n      const newItem = MarkdownParser.createNewListItem(context);\r\n      document.execCommand('insertText', false, '\\n' + newItem + textAfterCursor);\r\n      \r\n      // Position cursor after new list marker\r\n      const newCursorPos = this.textarea.selectionStart - textAfterCursor.length;\r\n      this.textarea.setSelectionRange(newCursorPos, newCursorPos);\r\n      \r\n      // Trigger input event\r\n      this.textarea.dispatchEvent(new Event('input', { bubbles: true }));\r\n    }\r\n    \r\n    /**\r\n     * Schedule numbered list renumbering\r\n     * @private\r\n     */\r\n    scheduleNumberedListUpdate() {\r\n      // Clear any pending update\r\n      if (this.numberUpdateTimeout) {\r\n        clearTimeout(this.numberUpdateTimeout);\r\n      }\r\n      \r\n      // Schedule update after current input cycle\r\n      this.numberUpdateTimeout = setTimeout(() => {\r\n        this.updateNumberedLists();\r\n      }, 10);\r\n    }\r\n    \r\n    /**\r\n     * Update/renumber all numbered lists\r\n     * @private\r\n     */\r\n    updateNumberedLists() {\r\n      const value = this.textarea.value;\r\n      const cursorPos = this.textarea.selectionStart;\r\n      \r\n      const newValue = MarkdownParser.renumberLists(value);\r\n      \r\n      if (newValue !== value) {\r\n        // Calculate cursor offset\r\n        let offset = 0;\r\n        const oldLines = value.split('\\n');\r\n        const newLines = newValue.split('\\n');\r\n        let charCount = 0;\r\n        \r\n        for (let i = 0; i < oldLines.length && charCount < cursorPos; i++) {\r\n          if (oldLines[i] !== newLines[i]) {\r\n            const diff = newLines[i].length - oldLines[i].length;\r\n            if (charCount + oldLines[i].length < cursorPos) {\r\n              offset += diff;\r\n            }\r\n          }\r\n          charCount += oldLines[i].length + 1; // +1 for newline\r\n        }\r\n        \r\n        // Update textarea\r\n        this.textarea.value = newValue;\r\n        const newCursorPos = cursorPos + offset;\r\n        this.textarea.setSelectionRange(newCursorPos, newCursorPos);\r\n        \r\n        // Trigger update\r\n        this.textarea.dispatchEvent(new Event('input', { bubbles: true }));\r\n      }\r\n    }\r\n\r\n    /**\r\n     * Handle scroll events\r\n     * @private\r\n     */\r\n    handleScroll(event) {\r\n      // Sync preview scroll with textarea\r\n      this.preview.scrollTop = this.textarea.scrollTop;\r\n      this.preview.scrollLeft = this.textarea.scrollLeft;\r\n    }\r\n\r\n    /**\r\n     * Get editor content\r\n     * @returns {string} Current markdown content\r\n     */\r\n    getValue() {\r\n      return this.textarea.value;\r\n    }\r\n\r\n    /**\r\n     * Set editor content\r\n     * @param {string} value - Markdown content to set\r\n     */\r\n    setValue(value) {\r\n      this.textarea.value = value;\r\n      this.updatePreview();\r\n\r\n      // Update height if auto-resize is enabled\r\n      if (this.options.autoResize) {\r\n        this._updateAutoHeight();\r\n      }\r\n    }\r\n\r\n    /**\r\n     * Execute an action by ID\r\n     * Central dispatcher used by toolbar clicks, keyboard shortcuts, and programmatic calls\r\n     * @param {string} actionId - The action identifier (e.g., 'toggleBold', 'insertLink')\r\n     * @param {Event|null} event - Optional event that triggered the action\r\n     * @returns {Promise<boolean>} Whether the action was executed successfully\r\n     */\r\n    async performAction(actionId, event = null) {\r\n      const textarea = this.textarea;\r\n      if (!textarea) return false;\r\n\r\n      const action = this.actionsById?.[actionId];\r\n      if (!action) {\r\n        console.warn(`OverType: Unknown action \"${actionId}\"`);\r\n        return false;\r\n      }\r\n\r\n      textarea.focus();\r\n\r\n      try {\r\n        await action({\r\n          editor: this,\r\n          getValue: () => this.getValue(),\r\n          setValue: (value) => this.setValue(value),\r\n          event\r\n        });\r\n        // Note: actions are responsible for dispatching input event\r\n        // This preserves behavior for direct consumers of toolbarButtons.*.action\r\n        return true;\r\n      } catch (error) {\r\n        console.error(`OverType: Action \"${actionId}\" error:`, error);\r\n        this.wrapper.dispatchEvent(new CustomEvent('button-error', {\r\n          detail: { actionId, error }\r\n        }));\r\n        return false;\r\n      }\r\n    }\r\n\r\n    /**\r\n     * Get the rendered HTML of the current content\r\n     * @param {Object} options - Rendering options\r\n     * @param {boolean} options.cleanHTML - If true, removes syntax markers and OverType-specific classes\r\n     * @returns {string} Rendered HTML\r\n     */\r\n    getRenderedHTML(options = {}) {\r\n      const markdown = this.getValue();\r\n      let html = MarkdownParser.parse(markdown, -1, false, this.options.codeHighlighter);\r\n\r\n      if (options.cleanHTML) {\r\n        // Remove all syntax marker spans for clean HTML export\r\n        html = html.replace(/<span class=\"syntax-marker[^\"]*\">.*?<\\/span>/g, '');\r\n        // Remove OverType-specific classes\r\n        html = html.replace(/\\sclass=\"(bullet-list|ordered-list|code-fence|hr-marker|blockquote|url-part)\"/g, '');\r\n        // Clean up empty class attributes\r\n        html = html.replace(/\\sclass=\"\"/g, '');\r\n      }\r\n      \r\n      return html;\r\n    }\r\n\r\n    /**\r\n     * Get the current preview element's HTML\r\n     * This includes all syntax markers and OverType styling\r\n     * @returns {string} Current preview HTML (as displayed)\r\n     */\r\n    getPreviewHTML() {\r\n      return this.preview.innerHTML;\r\n    }\r\n    \r\n    /**\r\n     * Get clean HTML without any OverType-specific markup\r\n     * Useful for exporting to other formats or storage\r\n     * @returns {string} Clean HTML suitable for export\r\n     */\r\n    getCleanHTML() {\r\n      return this.getRenderedHTML({ cleanHTML: true });\r\n    }\r\n\r\n    /**\r\n     * Focus the editor\r\n     */\r\n    focus() {\r\n      this.textarea.focus();\r\n    }\r\n\r\n    /**\r\n     * Blur the editor\r\n     */\r\n    blur() {\r\n      this.textarea.blur();\r\n    }\r\n\r\n    /**\r\n     * Check if editor is initialized\r\n     * @returns {boolean}\r\n     */\r\n    isInitialized() {\r\n      return this.initialized;\r\n    }\r\n\r\n    /**\r\n     * Re-initialize with new options\r\n     * @param {Object} options - New options to apply\r\n     */\r\n    reinit(options = {}) {\r\n      const prevToolbarButtons = this.options?.toolbarButtons;\r\n      this.options = this._mergeOptions({ ...this.options, ...options });\r\n      const toolbarNeedsRebuild = this.toolbar &&\r\n        this.options.toolbar &&\r\n        toolbarButtonsChanged(prevToolbarButtons, this.options.toolbarButtons);\r\n\r\n      // Rebuild action map in case toolbarButtons changed\r\n      this._rebuildActionsMap();\r\n\r\n      if (toolbarNeedsRebuild) {\r\n        this._cleanupToolbarListeners();\r\n        this.toolbar.destroy();\r\n        this.toolbar = null;\r\n        this._createToolbar();\r\n      }\r\n\r\n      this._applyOptions();\r\n      this.updatePreview();\r\n    }\r\n\r\n    /**\r\n     * Set theme for this instance\r\n     * @param {string|Object} theme - Theme name or custom theme object\r\n     * @returns {this} Returns this for chaining\r\n     */\r\n    setTheme(theme) {\r\n      // Clean up existing auto theme listener if any\r\n      this._cleanupAutoThemeListener();\r\n\r\n      // Update instance theme\r\n      this.instanceTheme = theme;\r\n\r\n      // Handle auto theme\r\n      if (theme === 'auto') {\r\n        this._setupAutoThemeListener();\r\n        // Apply the initial resolved theme\r\n        const resolvedTheme = resolveAutoTheme('auto');\r\n        this._applyResolvedTheme(resolvedTheme);\r\n      } else {\r\n        // Get theme object for non-auto themes\r\n        const themeObj = typeof theme === 'string' ? getTheme(theme) : theme;\r\n        const themeName = typeof themeObj === 'string' ? themeObj : themeObj.name;\r\n\r\n        // Update container theme attribute\r\n        if (themeName) {\r\n          this.container.setAttribute('data-theme', themeName);\r\n        }\r\n\r\n        // Apply CSS variables to container for instance override\r\n        if (themeObj && themeObj.colors) {\r\n          const cssVars = themeToCSSVars(themeObj.colors);\r\n          this.container.style.cssText += cssVars;\r\n        }\r\n\r\n        // Update preview to reflect new theme\r\n        this.updatePreview();\r\n      }\r\n\r\n      return this;\r\n    }\r\n\r\n    /**\r\n     * Apply a resolved theme name (used by auto theme)\r\n     * @private\r\n     * @param {string} themeName - Resolved theme name\r\n     */\r\n    _applyResolvedTheme(themeName) {\r\n      const themeObj = getTheme(themeName);\r\n      \r\n      // Update container with resolved theme, but keep auto in data-theme for tracking\r\n      this.container.setAttribute('data-theme', 'auto');\r\n      this.container.setAttribute('data-resolved-theme', themeName);\r\n\r\n      // Apply CSS variables\r\n      if (themeObj && themeObj.colors) {\r\n        const cssVars = themeToCSSVars(themeObj.colors);\r\n        this.container.style.cssText += cssVars;\r\n      }\r\n\r\n      // Update preview to reflect new theme\r\n      this.updatePreview();\r\n    }\r\n\r\n    /**\r\n     * Setup auto theme listener for instance\r\n     * @private\r\n     */\r\n    _setupAutoThemeListener() {\r\n      if (!window.matchMedia) return;\r\n\r\n      this.autoThemeMediaQuery = window.matchMedia('(prefers-color-scheme: dark)');\r\n      this.autoThemeListener = (event) => {\r\n        const resolvedTheme = event.matches ? 'cave' : 'solar';\r\n        this._applyResolvedTheme(resolvedTheme);\r\n      };\r\n\r\n      // Use addEventListener if available (modern browsers)\r\n      if (this.autoThemeMediaQuery.addEventListener) {\r\n        this.autoThemeMediaQuery.addEventListener('change', this.autoThemeListener);\r\n      } else if (this.autoThemeMediaQuery.addListener) {\r\n        // Fallback for older browsers\r\n        this.autoThemeMediaQuery.addListener(this.autoThemeListener);\r\n      }\r\n    }\r\n\r\n    /**\r\n     * Clean up auto theme listener for instance\r\n     * @private\r\n     */\r\n    _cleanupAutoThemeListener() {\r\n      if (this.autoThemeMediaQuery && this.autoThemeListener) {\r\n        if (this.autoThemeMediaQuery.removeEventListener) {\r\n          this.autoThemeMediaQuery.removeEventListener('change', this.autoThemeListener);\r\n        } else if (this.autoThemeMediaQuery.removeListener) {\r\n          // Fallback for older browsers\r\n          this.autoThemeMediaQuery.removeListener(this.autoThemeListener);\r\n        }\r\n        this.autoThemeMediaQuery = null;\r\n        this.autoThemeListener = null;\r\n      }\r\n    }\r\n\r\n    /**\r\n     * Set instance-specific code highlighter\r\n     * @param {Function|null} highlighter - Function that takes (code, language) and returns highlighted HTML\r\n     */\r\n    setCodeHighlighter(highlighter) {\r\n      this.options.codeHighlighter = highlighter;\r\n      this.updatePreview();\r\n    }\r\n\r\n    /**\r\n     * Update stats bar\r\n     * @private\r\n     */\r\n    _updateStats() {\r\n      if (!this.statsBar) return;\r\n      \r\n      const value = this.textarea.value;\r\n      const lines = value.split('\\n');\r\n      const chars = value.length;\r\n      const words = value.split(/\\s+/).filter(w => w.length > 0).length;\r\n      \r\n      // Calculate line and column\r\n      const selectionStart = this.textarea.selectionStart;\r\n      const beforeCursor = value.substring(0, selectionStart);\r\n      const linesBeforeCursor = beforeCursor.split('\\n');\r\n      const currentLine = linesBeforeCursor.length;\r\n      const currentColumn = linesBeforeCursor[linesBeforeCursor.length - 1].length + 1;\r\n      \r\n      // Use custom formatter if provided\r\n      if (this.options.statsFormatter) {\r\n        this.statsBar.innerHTML = this.options.statsFormatter({\r\n          chars,\r\n          words,\r\n          lines: lines.length,\r\n          line: currentLine,\r\n          column: currentColumn\r\n        });\r\n      } else {\r\n        // Default format with live dot\r\n        this.statsBar.innerHTML = `\r\n          <div class=\"overtype-stat\">\r\n            <span class=\"live-dot\"></span>\r\n            <span>${chars} chars, ${words} words, ${lines.length} lines</span>\r\n          </div>\r\n          <div class=\"overtype-stat\">Line ${currentLine}, Col ${currentColumn}</div>\r\n        `;\r\n      }\r\n    }\r\n    \r\n    /**\r\n     * Setup auto-resize functionality\r\n     * @private\r\n     */\r\n    _setupAutoResize() {\r\n      // Add auto-resize class for styling\r\n      this.container.classList.add('overtype-auto-resize');\r\n      \r\n      // Store previous height for comparison\r\n      this.previousHeight = null;\r\n      \r\n      // Initial height update\r\n      this._updateAutoHeight();\r\n      \r\n      // Listen for input events\r\n      this.textarea.addEventListener('input', () => this._updateAutoHeight());\r\n      \r\n      // Listen for window resize\r\n      window.addEventListener('resize', () => this._updateAutoHeight());\r\n    }\r\n    \r\n    /**\r\n     * Update height based on scrollHeight\r\n     * @private\r\n     */\r\n    _updateAutoHeight() {\r\n      if (!this.options.autoResize) return;\r\n      \r\n      const textarea = this.textarea;\r\n      const preview = this.preview;\r\n      const wrapper = this.wrapper;\r\n      \r\n      // Get computed styles\r\n      const computed = window.getComputedStyle(textarea);\r\n      const paddingTop = parseFloat(computed.paddingTop);\r\n      const paddingBottom = parseFloat(computed.paddingBottom);\r\n      \r\n      // Store scroll positions\r\n      const scrollTop = textarea.scrollTop;\r\n      \r\n      // Reset height to get accurate scrollHeight\r\n      textarea.style.setProperty('height', 'auto', 'important');\r\n      \r\n      // Calculate new height based on scrollHeight\r\n      let newHeight = textarea.scrollHeight;\r\n      \r\n      // Apply min height constraint\r\n      if (this.options.minHeight) {\r\n        const minHeight = parseInt(this.options.minHeight);\r\n        newHeight = Math.max(newHeight, minHeight);\r\n      }\r\n      \r\n      // Apply max height constraint\r\n      let overflow = 'hidden';\r\n      if (this.options.maxHeight) {\r\n        const maxHeight = parseInt(this.options.maxHeight);\r\n        if (newHeight > maxHeight) {\r\n          newHeight = maxHeight;\r\n          overflow = 'auto';\r\n        }\r\n      }\r\n      \r\n      // Apply the new height to all elements with !important to override base styles\r\n      const heightPx = newHeight + 'px';\r\n      textarea.style.setProperty('height', heightPx, 'important');\r\n      textarea.style.setProperty('overflow-y', overflow, 'important');\r\n      \r\n      preview.style.setProperty('height', heightPx, 'important');\r\n      preview.style.setProperty('overflow-y', overflow, 'important');\r\n      \r\n      wrapper.style.setProperty('height', heightPx, 'important');\r\n      \r\n      // Restore scroll position\r\n      textarea.scrollTop = scrollTop;\r\n      preview.scrollTop = scrollTop;\r\n      \r\n      // Track if height changed\r\n      if (this.previousHeight !== newHeight) {\r\n        this.previousHeight = newHeight;\r\n        // Could dispatch a custom event here if needed\r\n      }\r\n    }\r\n    \r\n    /**\r\n     * Show or hide stats bar\r\n     * @param {boolean} show - Whether to show stats\r\n     */\r\n    showStats(show) {\r\n      this.options.showStats = show;\r\n\r\n      if (show && !this.statsBar) {\r\n        // Create stats bar (add to container, not wrapper)\r\n        this.statsBar = document.createElement('div');\r\n        this.statsBar.className = 'overtype-stats';\r\n        this.container.appendChild(this.statsBar);\r\n        this._updateStats();\r\n      } else if (show && this.statsBar) {\r\n        // Already visible - refresh stats (useful after changing statsFormatter)\r\n        this._updateStats();\r\n      } else if (!show && this.statsBar) {\r\n        // Remove stats bar\r\n        this.statsBar.remove();\r\n        this.statsBar = null;\r\n      }\r\n    }\r\n    \r\n    /**\r\n     * Show normal edit mode (overlay with markdown preview)\r\n     * @returns {this} Returns this for chaining\r\n     */\r\n    showNormalEditMode() {\r\n      this.container.dataset.mode = 'normal';\r\n      this.updatePreview(); // Re-render with normal mode (e.g., show syntax markers)\r\n\r\n      // Always sync scroll from preview to textarea\r\n      requestAnimationFrame(() => {\r\n        this.textarea.scrollTop = this.preview.scrollTop;\r\n        this.textarea.scrollLeft = this.preview.scrollLeft;\r\n      });\r\n\r\n      return this;\r\n    }\r\n\r\n    /**\r\n     * Show plain textarea mode (no overlay)\r\n     * @returns {this} Returns this for chaining\r\n     */\r\n    showPlainTextarea() {\r\n      this.container.dataset.mode = 'plain';\r\n\r\n      // Update toolbar button if exists\r\n      if (this.toolbar) {\r\n        const toggleBtn = this.container.querySelector('[data-action=\"toggle-plain\"]');\r\n        if (toggleBtn) {\r\n          toggleBtn.classList.remove('active');\r\n          toggleBtn.title = 'Show markdown preview';\r\n        }\r\n      }\r\n\r\n      return this;\r\n    }\r\n\r\n    /**\r\n     * Show preview mode (read-only view)\r\n     * @returns {this} Returns this for chaining\r\n     */\r\n    showPreviewMode() {\r\n      this.container.dataset.mode = 'preview';\r\n      this.updatePreview(); // Re-render with preview mode (e.g., checkboxes)\r\n      return this;\r\n    }\r\n\r\n    /**\r\n     * Destroy the editor instance\r\n     */\r\n    destroy() {\r\n      // Clean up auto theme listener\r\n      this._cleanupAutoThemeListener();\r\n\r\n      // Remove instance reference\r\n      this.element.overTypeInstance = null;\r\n      OverType.instances.delete(this.element);\r\n\r\n      // Cleanup shortcuts\r\n      if (this.shortcuts) {\r\n        this.shortcuts.destroy();\r\n      }\r\n\r\n      // Remove DOM if created by us\r\n      if (this.wrapper) {\r\n        const content = this.getValue();\r\n        this.wrapper.remove();\r\n        \r\n        // Restore original content\r\n        this.element.textContent = content;\r\n      }\r\n\r\n      this.initialized = false;\r\n    }\r\n\r\n    // ===== Static Methods =====\r\n\r\n    /**\r\n     * Initialize multiple editors (static convenience method)\r\n     * @param {string|Element|NodeList|Array} target - Target element(s)\r\n     * @param {Object} options - Configuration options\r\n     * @returns {Array} Array of OverType instances\r\n     */\r\n    static init(target, options = {}) {\r\n      return new OverType(target, options);\r\n    }\r\n\r\n    /**\r\n     * Initialize editors with options from data-ot-* attributes\r\n     * @param {string} selector - CSS selector for target elements\r\n     * @param {Object} defaults - Default options (data attrs override these)\r\n     * @returns {Array<OverType>} Array of OverType instances\r\n     * @example\r\n     * // HTML: <div class=\"editor\" data-ot-toolbar=\"true\" data-ot-theme=\"cave\"></div>\r\n     * OverType.initFromData('.editor', { fontSize: '14px' });\r\n     */\r\n    static initFromData(selector, defaults = {}) {\r\n      const elements = document.querySelectorAll(selector);\r\n      return Array.from(elements).map(el => {\r\n        const options = { ...defaults };\r\n\r\n        // Parse data-ot-* attributes (kebab-case to camelCase)\r\n        for (const attr of el.attributes) {\r\n          if (attr.name.startsWith('data-ot-')) {\r\n            const kebab = attr.name.slice(8); // Remove 'data-ot-'\r\n            const key = kebab.replace(/-([a-z])/g, (_, c) => c.toUpperCase());\r\n            options[key] = OverType._parseDataValue(attr.value);\r\n          }\r\n        }\r\n\r\n        return new OverType(el, options);\r\n      });\r\n    }\r\n\r\n    /**\r\n     * Parse a data attribute value to the appropriate type\r\n     * @private\r\n     */\r\n    static _parseDataValue(value) {\r\n      if (value === 'true') return true;\r\n      if (value === 'false') return false;\r\n      if (value === 'null') return null;\r\n      if (value !== '' && !isNaN(Number(value))) return Number(value);\r\n      return value;\r\n    }\r\n\r\n    /**\r\n     * Get instance from element\r\n     * @param {Element} element - DOM element\r\n     * @returns {OverType|null} OverType instance or null\r\n     */\r\n    static getInstance(element) {\r\n      return element.overTypeInstance || OverType.instances.get(element) || null;\r\n    }\r\n\r\n    /**\r\n     * Destroy all instances\r\n     */\r\n    static destroyAll() {\r\n      const elements = document.querySelectorAll('[data-overtype-instance]');\r\n      elements.forEach(element => {\r\n        const instance = OverType.getInstance(element);\r\n        if (instance) {\r\n          instance.destroy();\r\n        }\r\n      });\r\n    }\r\n\r\n    /**\r\n     * Inject styles into the document\r\n     * @param {boolean} force - Force re-injection\r\n     */\r\n    static injectStyles(force = false) {\r\n      if (OverType.stylesInjected && !force) return;\r\n\r\n      // Remove any existing OverType styles\r\n      const existing = document.querySelector('style.overtype-styles');\r\n      if (existing) {\r\n        existing.remove();\r\n      }\r\n\r\n      // Generate and inject new styles with current theme\r\n      const theme = OverType.currentTheme || solar;\r\n      const styles = generateStyles({ theme });\r\n      const styleEl = document.createElement('style');\r\n      styleEl.className = 'overtype-styles';\r\n      styleEl.textContent = styles;\r\n      document.head.appendChild(styleEl);\r\n\r\n      OverType.stylesInjected = true;\r\n    }\r\n    \r\n    /**\r\n     * Set global theme for all OverType instances\r\n     * @param {string|Object} theme - Theme name or custom theme object\r\n     * @param {Object} customColors - Optional color overrides\r\n     */\r\n    static setTheme(theme, customColors = null) {\r\n      // Clean up existing auto theme listener\r\n      OverType._cleanupGlobalAutoThemeListener();\r\n\r\n      // Handle auto theme at global level\r\n      if (theme === 'auto') {\r\n        OverType._setupGlobalAutoThemeListener();\r\n        // Apply the initial resolved theme\r\n        const resolvedTheme = resolveAutoTheme('auto');\r\n        OverType._applyGlobalResolvedTheme(resolvedTheme, customColors);\r\n      } else {\r\n        // Process theme\r\n        let themeObj = typeof theme === 'string' ? getTheme(theme) : theme;\r\n\r\n        // Apply custom colors if provided\r\n        if (customColors) {\r\n          themeObj = mergeTheme(themeObj, customColors);\r\n        }\r\n\r\n        // Store as current theme\r\n        OverType.currentTheme = themeObj;\r\n\r\n        // Re-inject styles with new theme\r\n        OverType.injectStyles(true);\r\n\r\n        // Update all existing instances - update container theme attribute\r\n        document.querySelectorAll('.overtype-container').forEach(container => {\r\n          const themeName = typeof themeObj === 'string' ? themeObj : themeObj.name;\r\n          if (themeName) {\r\n            container.setAttribute('data-theme', themeName);\r\n          }\r\n        });\r\n\r\n        // Also handle any old-style wrappers without containers\r\n        document.querySelectorAll('.overtype-wrapper').forEach(wrapper => {\r\n          if (!wrapper.closest('.overtype-container')) {\r\n            const themeName = typeof themeObj === 'string' ? themeObj : themeObj.name;\r\n            if (themeName) {\r\n              wrapper.setAttribute('data-theme', themeName);\r\n            }\r\n          }\r\n\r\n          // Trigger preview update for the instance\r\n          const instance = wrapper._instance;\r\n          if (instance) {\r\n            instance.updatePreview();\r\n          }\r\n        });\r\n\r\n        // Update web components (shadow DOM instances)\r\n        const themeName = typeof themeObj === 'string' ? themeObj : themeObj.name;\r\n        document.querySelectorAll('overtype-editor').forEach(webComponent => {\r\n          // Set the theme attribute to update the theme name\r\n          if (themeName && typeof webComponent.setAttribute === 'function') {\r\n            webComponent.setAttribute('theme', themeName);\r\n          }\r\n          // Also call refreshTheme() to handle cases where the theme name stays the same\r\n          // but the theme object's properties have changed\r\n          if (typeof webComponent.refreshTheme === 'function') {\r\n            webComponent.refreshTheme();\r\n          }\r\n        });\r\n      }\r\n    }\r\n\r\n    /**\r\n     * Apply a resolved theme globally (used by auto theme)\r\n     * @private\r\n     * @param {string} themeName - Resolved theme name\r\n     * @param {Object} customColors - Optional color overrides\r\n     */\r\n    static _applyGlobalResolvedTheme(themeName, customColors = null) {\r\n      let themeObj = getTheme(themeName);\r\n\r\n      // Apply custom colors if provided\r\n      if (customColors) {\r\n        themeObj = mergeTheme(themeObj, customColors);\r\n      }\r\n\r\n      // Store as current theme\r\n      OverType.currentTheme = themeObj;\r\n\r\n      // Re-inject styles with new theme\r\n      OverType.injectStyles(true);\r\n\r\n      // Update all containers with resolved theme, but keep 'auto' for tracking\r\n      document.querySelectorAll('.overtype-container').forEach(container => {\r\n        container.setAttribute('data-theme', 'auto');\r\n        container.setAttribute('data-resolved-theme', themeName);\r\n      });\r\n\r\n      // Also handle any old-style wrappers without containers\r\n      document.querySelectorAll('.overtype-wrapper').forEach(wrapper => {\r\n        if (!wrapper.closest('.overtype-container')) {\r\n          wrapper.setAttribute('data-theme', 'auto');\r\n          wrapper.setAttribute('data-resolved-theme', themeName);\r\n        }\r\n\r\n        // Trigger preview update for the instance\r\n        const instance = wrapper._instance;\r\n        if (instance) {\r\n          instance.updatePreview();\r\n        }\r\n      });\r\n\r\n      // Update web components\r\n      document.querySelectorAll('overtype-editor').forEach(webComponent => {\r\n        if (typeof webComponent.setAttribute === 'function') {\r\n          webComponent.setAttribute('theme', 'auto');\r\n          webComponent.setAttribute('data-resolved-theme', themeName);\r\n        }\r\n        if (typeof webComponent.refreshTheme === 'function') {\r\n          webComponent.refreshTheme();\r\n        }\r\n      });\r\n    }\r\n\r\n    /**\r\n     * Setup global auto theme listener\r\n     * @private\r\n     */\r\n    static _setupGlobalAutoThemeListener() {\r\n      if (!window.matchMedia) return;\r\n\r\n      OverType.autoThemeMediaQuery = window.matchMedia('(prefers-color-scheme: dark)');\r\n      OverType.autoThemeListener = (event) => {\r\n        const resolvedTheme = event.matches ? 'cave' : 'solar';\r\n        OverType._applyGlobalResolvedTheme(resolvedTheme);\r\n      };\r\n\r\n      // Use addEventListener if available (modern browsers)\r\n      if (OverType.autoThemeMediaQuery.addEventListener) {\r\n        OverType.autoThemeMediaQuery.addEventListener('change', OverType.autoThemeListener);\r\n      } else if (OverType.autoThemeMediaQuery.addListener) {\r\n        // Fallback for older browsers\r\n        OverType.autoThemeMediaQuery.addListener(OverType.autoThemeListener);\r\n      }\r\n    }\r\n\r\n    /**\r\n     * Clean up global auto theme listener\r\n     * @private\r\n     */\r\n    static _cleanupGlobalAutoThemeListener() {\r\n      if (OverType.autoThemeMediaQuery && OverType.autoThemeListener) {\r\n        if (OverType.autoThemeMediaQuery.removeEventListener) {\r\n          OverType.autoThemeMediaQuery.removeEventListener('change', OverType.autoThemeListener);\r\n        } else if (OverType.autoThemeMediaQuery.removeListener) {\r\n          // Fallback for older browsers\r\n          OverType.autoThemeMediaQuery.removeListener(OverType.autoThemeListener);\r\n        }\r\n        OverType.autoThemeMediaQuery = null;\r\n        OverType.autoThemeListener = null;\r\n      }\r\n    }\r\n\r\n    /**\r\n     * Set global code highlighter for all OverType instances\r\n     * @param {Function|null} highlighter - Function that takes (code, language) and returns highlighted HTML\r\n     */\r\n    static setCodeHighlighter(highlighter) {\r\n      MarkdownParser.setCodeHighlighter(highlighter);\r\n\r\n      // Update all existing instances in light DOM\r\n      document.querySelectorAll('.overtype-wrapper').forEach(wrapper => {\r\n        const instance = wrapper._instance;\r\n        if (instance && instance.updatePreview) {\r\n          instance.updatePreview();\r\n        }\r\n      });\r\n\r\n      // Update web components (shadow DOM instances)\r\n      document.querySelectorAll('overtype-editor').forEach(webComponent => {\r\n        if (typeof webComponent.getEditor === 'function') {\r\n          const instance = webComponent.getEditor();\r\n          if (instance && instance.updatePreview) {\r\n            instance.updatePreview();\r\n          }\r\n        }\r\n      });\r\n    }\r\n\r\n    /**\r\n     * Set custom syntax processor for extending markdown parsing\r\n     * @param {Function|null} processor - Function that takes (html) and returns modified HTML\r\n     * @example\r\n     * OverType.setCustomSyntax((html) => {\r\n     *   // Highlight footnote references [^1]\r\n     *   return html.replace(/\\[\\^(\\w+)\\]/g, '<span class=\"footnote-ref\">$&</span>');\r\n     * });\r\n     */\r\n    static setCustomSyntax(processor) {\r\n      MarkdownParser.setCustomSyntax(processor);\r\n\r\n      // Update all existing instances\r\n      document.querySelectorAll('.overtype-wrapper').forEach(wrapper => {\r\n        const instance = wrapper._instance;\r\n        if (instance && instance.updatePreview) {\r\n          instance.updatePreview();\r\n        }\r\n      });\r\n\r\n      document.querySelectorAll('overtype-editor').forEach(webComponent => {\r\n        if (typeof webComponent.getEditor === 'function') {\r\n          const instance = webComponent.getEditor();\r\n          if (instance && instance.updatePreview) {\r\n            instance.updatePreview();\r\n          }\r\n        }\r\n      });\r\n    }\r\n\r\n    /**\r\n     * Initialize global event listeners\r\n     */\r\n    static initGlobalListeners() {\r\n      if (OverType.globalListenersInitialized) return;\r\n\r\n      // Input event\r\n      document.addEventListener('input', (e) => {\r\n        if (e.target && e.target.classList && e.target.classList.contains('overtype-input')) {\r\n          const wrapper = e.target.closest('.overtype-wrapper');\r\n          const instance = wrapper?._instance;\r\n          if (instance) instance.handleInput(e);\r\n        }\r\n      });\r\n\r\n      // Keydown event\r\n      document.addEventListener('keydown', (e) => {\r\n        if (e.target && e.target.classList && e.target.classList.contains('overtype-input')) {\r\n          const wrapper = e.target.closest('.overtype-wrapper');\r\n          const instance = wrapper?._instance;\r\n          if (instance) instance.handleKeydown(e);\r\n        }\r\n      });\r\n\r\n      // Scroll event\r\n      document.addEventListener('scroll', (e) => {\r\n        if (e.target && e.target.classList && e.target.classList.contains('overtype-input')) {\r\n          const wrapper = e.target.closest('.overtype-wrapper');\r\n          const instance = wrapper?._instance;\r\n          if (instance) instance.handleScroll(e);\r\n        }\r\n      }, true);\r\n\r\n      // Selection change event\r\n      document.addEventListener('selectionchange', (e) => {\r\n        const activeElement = document.activeElement;\r\n        if (activeElement && activeElement.classList.contains('overtype-input')) {\r\n          const wrapper = activeElement.closest('.overtype-wrapper');\r\n          const instance = wrapper?._instance;\r\n          if (instance) {\r\n            // Update stats bar for cursor position\r\n            if (instance.options.showStats && instance.statsBar) {\r\n              instance._updateStats();\r\n            }\r\n            // Debounce updates\r\n            clearTimeout(instance._selectionTimeout);\r\n            instance._selectionTimeout = setTimeout(() => {\r\n              instance.updatePreview();\r\n            }, 50);\r\n          }\r\n        }\r\n      });\r\n\r\n      OverType.globalListenersInitialized = true;\r\n    }\r\n}\r\n\r\n// Export classes for advanced usage\r\nOverType.MarkdownParser = MarkdownParser;\r\nOverType.ShortcutsManager = ShortcutsManager;\r\n\r\n// Export theme utilities\r\nOverType.themes = { solar, cave: getTheme('cave') };\r\nOverType.getTheme = getTheme;\r\n\r\n// Set default theme\r\nOverType.currentTheme = solar;\r\n\r\n// Export for module systems\r\nexport default OverType;\r\nexport { OverType };\r\n\r\n// Export toolbar buttons for custom toolbar configurations\r\nexport { toolbarButtons, defaultToolbarButtons } from './toolbar-buttons.js';\r\n"],
  "mappings": "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A;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,qBAmO3B,UAAU;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,qBAmaV,UAAU;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,qBAiCV,UAAU;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,MAgEzB,YAAY;AAAA;AAElB;;;;;;;;;;;;;;;;;;;AC92BO,IAAM,UAA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",
  "names": ["result", "debugMode", "getActiveFormats", "toolbarButtons", "themeName"]
}
